(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{106:function(e,t,i){"use strict";var n,s;i(10),i(23),i(18),n=[i(2),i(0),i(1),i(3),i(15),i(68),i(47),i(56),i(185),i(80)],void 0===(s=function(o,f,m,g,e,p,t,v){f.fn.select2.amd.define("select2/selectAllAdapter",["select2/utils","select2/dropdown","select2/dropdown/attachBody"],function(l,e,t){function i(){}return i.prototype.render=function(e){var t=this,i=e.call(this),n=f(['<button class="btn btn-secondary btn-sm" type="button"',' style="width: 49%;margin: 0 0.5%;">','<i class="fa fa-check-square-o"></i>','<span style="padding: 0px 5px;">',o("Select All"),"</span></button>"].join("")),s=f(['<button class="btn btn-secondary btn-sm" type="button"',' style="width: 49%;margin: 0 0.5%;">','<i class="fa fa-square-o"></i><span style="padding: 0px 5px;">',o("Unselect All"),"</span></button>"].join("")),a=f('<div class="select2-select-all-adapter-container">').append(n).append(s);return this.$element.prop("multiple")&&(i.find(".select2-dropdown").prepend(a),n.on("click",function(){i.find(".select2-results__option[aria-selected=false]").each(function(){var e=l.GetData(f(this)[0],"data");t.trigger("select",{data:e})}),t.trigger("close")}),s.on("click",function(){i.find(".select2-results__option[aria-selected=true]").each(function(){var e=l.GetData(f(this)[0],"data");t.trigger("unselect",{data:e})}),t.trigger("close")})),i},l.Decorate(l.Decorate(e,t),i)});function i(e){if(!e.id)return e.text;var t=f(e.element).data("image");return t?f("<span></span>").append(f("<span></span>",{class:"wcTabIcon "+t})).append(f("<span></span>").text(e.text)):e.text}var n=p.NodeAjaxOptionsControl=p.Select2Control.extend({defaults:m.extend(p.Select2Control.prototype.defaults,{url:void 0,transform:void 0,url_with_id:!1,select2:{allowClear:!0,placeholder:"Select an item...",width:"style"}}),initialize:function(){p.Select2Control.prototype.initialize.apply(this,arguments);var e=this,t=e.field.get("url")||e.defaults.url,i=e.model.top||e.model;if(t){var n,s=this.field.get("schema_node"),a=this.field.get("node_info"),l=this.field.get("url_with_id")||!1,o=s.generate_url.apply(s,[null,t,this.field.get("node_data"),l,a]),r=this.field.get("cache_node");r=r&&g.Browser.Nodes[r]||s,n=this.field.has("cache_level")?this.field.get("cache_level"):r.cache_level(a,l);var d=r.cache(s.type+"#"+t,a,n);this.field.get("version_compatible")&&(m.isUndefined(d)||m.isNull(d))&&(i.trigger("pgadmin:view:fetching",i,e.field),f.ajax({async:!1,url:o}).done(function(e){d=r.cache(s.type+"#"+t,a,n,e.data)}).fail(function(){i.trigger("pgadmin:view:fetch:error",i,e.field)}),i.trigger("pgadmin:view:fetched",i,e.field)),d=d&&d.data||[];var c=this.field.get("transform")||e.defaults.transform;c&&m.isFunction(c)?e.field.set("options",c.bind(e,d)):e.field.set("options",d)}}}),s=p.NodeListByIdControl=n.extend({controlClassName:"pgadmin-node-select form-control",defaults:m.extend({},n.prototype.defaults,{url:"nodes",filter:void 0,transform:function(e){var n=this,s=n.field.get("schema_node"),a=[],l=n.field.get("filter")||function(){return!0};return l=l.bind(n),m.each(e,function(e){if(l(e)){var t=m.isFunction(s.node_label)?s.node_label.apply(s,[e,n.model,n]):e.label,i=m.isFunction(s.node_image)?s.node_image.apply(s,[e,n.model,n]):s.node_image||"icon-"+s.type;a.push({value:e._id,image:i,label:t})}}),a},select2:{allowClear:!0,placeholder:"Select an item...",width:"style",templateResult:i,templateSelection:i}})});p.NodeListByNameControl=s.extend({defaults:m.extend({},s.prototype.defaults,{transform:function(e){var n=this,s=n.field.get("schema_node"),a=[],l=n.field.get("filter")||function(){return!0};return l=l.bind(n),m.each(e,function(e){if(l(e)){var t=m.isFunction(s.node_label)?s.node_label.apply(s,[e,n.model,n]):e.label,i=m.isFunction(s.node_image)?s.node_image.apply(s,[e,n.model,n]):s.node_image||"icon-"+s.type;a.push({value:e.label,image:i,label:t})}}),a}})}),f.fn.pgMakeVisible=function(n){return this.each(function(){if(this&&f(this.length))for(var e,t,i=f(this);i&&0<i.length;)if(e=i.get(0).offsetTop+i.height(),i=i.parent(),(t=i)&&0<t.length&&t.get(0).scrollHeight>t.height()&&i.scrollTop(e),i.hasClass(n))return})},f.fn.pgMakeBackgridVisible=function(l){return this.each(function(){if(this&&f(this.length)){var e=f(this),t=f(this).offsetParent().parent(),i=t.offset().top,n=t.height(),s=f(this).closest(l);if(s[0].offsetHeight-i<n){var a=e.get(0).offsetTop+e.height();s.find(".tab-content").scrollTop(a)}}})};var a=v.Extension.NodeAjaxOptionsCell=v.Extension.Select2Cell.extend({defaults:m.extend({},v.Extension.Select2Cell.prototype.defaults,{url:void 0,transform:void 0,url_with_id:!1,select2:{allowClear:!0,placeholder:"Select an item...",width:"style"},opt:{label:null,value:null,image:null,selected:!1}}),template:m.template('<option <% if (image) { %> data-image=<%= image %> <% } %> value="<%- value %>" <%= selected ? \'selected="selected"\' : "" %>><%- label %></option>'),initialize:function(){v.Extension.Select2Cell.prototype.initialize.apply(this,arguments);var t=this.column.get("url")||this.defaults.url,e=m.has(this.column.attributes,"options_cached"),i=e&&this.column.get("options_cached");if(t&&!i){var n,s=this.model,a=this.column,l=s.top||s,o=a.get("schema_node"),r=a.get("node_info"),d=a.get("url_with_id")||!1,c=o.generate_url.apply(o,[null,t,a.get("node_data"),d,r]),p=a.get("cache_node");p=p&&g.Browser.Nodes[p]||o,n=a.has("cache_level")?a.get("cache_level"):p.cache_level(r,d);var u=p.cache(o.type+"#"+t,r,n);a.get("version_compatible")&&(m.isUndefined(u)||m.isNull(u))&&(l.trigger("pgadmin:view:fetching",s,a),f.ajax({async:!1,url:c}).done(function(e){u=p.cache(o.type+"#"+t,r,n,e.data)}).fail(function(){l.trigger("pgadmin:view:fetch:error",s,a)}),l.trigger("pgadmin:view:fetched",s,a)),u=u&&u.data||[];var h=a.get("transform")||this.defaults.transform;h&&m.isFunction(h)?a.set("options",h.bind(a,u)):a.set("options",u),e&&a.set("options_cached",!0)}}});return v.Extension.NodeListByIdCell=a.extend({controlClassName:"pgadmin-node-select backgrid-cell",defaults:m.extend({},a.prototype.defaults,{url:"nodes",filter:void 0,transform:function(e,t){var n=t||this,s=n.column.get("schema_node"),a=[],l=n.column.get("filter")||function(){return!0};return l=l.bind(n),m.each(e,function(e){if(l(e)){var t=m.isFunction(s.node_label)?s.node_label.apply(s,[e,n.model,n]):e.label,i=m.isFunction(s.node_image)?s.node_image.apply(s,[e,n.model,n]):s.node_image||"icon-"+s.type;a.push({value:e._id,image:i,label:t})}}),a},select2:{placeholder:"Select an item...",width:"style",templateResult:i,templateSelection:i}})}),v.Extension.NodeListByNameCell=a.extend({controlClassName:"pgadmin-node-select backgrid-cell",defaults:m.extend({},a.prototype.defaults,{url:"nodes",filter:void 0,transform:function(e,t){var n=t||this,s=n.column.get("schema_node"),a=[],l=n.column.get("filter")||function(){return!0};return l=l.bind(n),m.each(e,function(e){if(l(e)){var t=m.isFunction(s.node_label)?s.node_label.apply(s,[e,n.model,n]):e.label,i=m.isFunction(s.node_image)?s.node_image.apply(s,[e,n.model,n]):s.node_image||"icon-"+s.type;a.push({value:e.label,image:i,label:t})}}),a},select2:{placeholder:"Select an item...",width:"style",templateResult:i,templateSelection:i}})}),v.Extension.MultiSelectAjaxCell=v.Extension.NodeAjaxOptionsCell.extend({defaults:m.extend({},a.prototype.defaults,{transform:void 0,url_with_id:!1,select2:{allowClear:!0,placeholder:"Select an item...",width:"style",multiple:!0},opt:{label:null,value:null,image:null,selected:!1}}),getValueFromDOM:function(){var e=[];return this.$el.find("select").find(":selected").each(function(){e.push(f(this).attr("value"))}),e}}),p.MultiSelectAjaxControl=n.extend({defaults:m.extend({},n.prototype.defaults,{select2:{multiple:!0,allowClear:!0,width:"style"}})}),p}.apply(t,n))||(e.exports=s)},13:function(n,s,a){"use strict";(function(e){var t,i;a(36),a(10),a(16),a(23),a(40),a(117),a(30),a(18),a(11),a(48),a(37),a(4),a(8),a(29),a(87),a(6),a(31),t=[a(2),a(1),a(0),a(15),a(68),a(56),a(42),a(69),a(74),a(41),a(340),a(28),a(185),a(184)],void 0===(i=function(y,C,g,o,_,v,u,i,b,w){var x=window.pgAdmin=window.pgAdmin||{},k=x.Browser;x.editableCell=function(){if(this.attributes&&!C.isUndefined(this.attributes.disabled)&&!C.isNull(this.attributes.disabled)){if(C.isFunction(this.attributes.disabled))return!this.attributes.disabled.apply(this,arguments);if(C.isBoolean(this.attributes.disabled))return!this.attributes.disabled}},C.extend(_,{controlLabelClassName:"control-label pg-el-sm-3 pg-el-12",controlsClassName:"pgadmin-controls pg-el-sm-9 pg-el-12",controlContainerClassName:"pgadmin-controls pg-el-sm-9 pg-el-12",groupClassName:"pgadmin-control-group form-group row pg-el-12",setGroupClassName:"set-group pg-el-12",tabClassName:"backform-tab pg-el-12",setGroupContentClassName:"fieldset-content pg-el-12",accordianGroupClassName:"accordian-group pg-el-12",accordianContentClassName:"accordian-content pg-el-12",hiddenClassName:"d-none",helpMessageClassName:"form-text text-muted help-block",helpBlockControlClass:"pgadmin-controls offset-sm-3 pg-el-sm-9 pg-el-12"}),_.controlMapper={int:["uneditable-input","numeric","integer"],text:["uneditable-input","input","string"],numeric:["uneditable-input","numeric","numeric"],date:"datepicker",datetime:"datetimepicker",boolean:"boolean",options:["readonly-option","select",v.Extension.PGSelectCell],multiline:["textarea","textarea","string"],collection:["sub-node-collection","sub-node-collection","string"],uniqueColCollection:["unique-col-collection","unique-col-collection","string"],switch:"switch",select2:"select2",note:"note",color:"color",radioModern:"radioModern"},_.getMappedControl=function(e,t){if(e in _.controlMapper){var i=_.controlMapper[e];if(!C.isArray(i))return i;var n=1,s=C.size(i);switch(t){case"properties":n=0;break;case"edit":case"create":case"control":n=1;break;case"cell":n=2;break;default:n=0}return i[s<n?0:n]}return e};var e=_.RawFormatter=function(){};C.extend(e.prototype,{fromRaw:function(e){return e},toRaw:function(e){return e}});var t=_.Control.prototype.initialize,n=_.Control.prototype.remove;C.extend(_.Control.prototype,{defaults:C.extend(_.Control.prototype.defaults,{helpMessage:null}),initialize:function(){t.apply(this,arguments);var e=this.field.get("deps"),i=this;e&&C.isArray(e)&&C.each(e,function(e){var t=e.split(".").shift();i.listenTo(i.model,"change:"+t,i.render)})},remove:function(){var i=this,e=i.field.get("deps"),t=this.field.get("name").split(".").shift();i.stopListening(i.model,"change:"+t,i.render),i.model.errorModel instanceof o.Model&&i.stopListening(i.model.errorModel,"change:"+t,i.updateInvalid),e&&C.isArray(e)&&C.each(e,function(e){var t=e.split(".").shift();i.stopListening(i.model,"change:"+t,i.render)}),this.cleanup&&this.cleanup.apply(this),n?n.apply(i,arguments):o.View.prototype.remove.apply(i,arguments)},template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','  <input class="<%=Backform.controlClassName%> uneditable-input" <%=disabled ? "disabled readonly" : ""%> id="<%=cId%>" value="<%-value%>" />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),clearInvalid:function(){return this.$el.removeClass(_.errorClassName),this.$el.find(".pgadmin-control-error-message").remove(),this},updateInvalid:function(){var n=this,s=this.model.errorModel;if(!(s instanceof o.Model))return this;this.clearInvalid(),this.$el.find(":input[name]").not("button").each(function(e,t){var i=n.keyPathAccessor(s.toJSON(),g(t).attr("name"));C.isEmpty(i)||n.$el.addClass(_.errorClassName)})},render:function(){function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});return C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model)}),o.cId=o.cId||C.uniqueId("pgC_"),this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),this.$el.html(this.template(o)).addClass(t.name),this.updateInvalid(),this}}),C.extend(_.InputControl.prototype,{template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlContainerClassName%>">','  <input type="<%=type%>" id="<%=cId%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" maxlength="<%=maxlength%>" value="<%-value%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),events:{"change input":"onChange","blur input":"onChange","keyup input":"onKeyUp","focus input":"clearInvalid"},onKeyUp:function(e){this.key_timeout&&clearTimeout(this.key_timeout),this.keyup_timeout=setTimeout(function(){this.onChange(e)}.bind(this),400)}}),C.extend(_.TextareaControl.prototype,{defaults:C.extend(_.TextareaControl.prototype.defaults,{rows:5,helpMessage:null,maxlength:null}),events:{"change textarea":"onChange","keyup textarea":"onKeyUp","paste textarea":"onChange","selectionchange textarea":"onChange","focus textarea":"clearInvalid"},template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','  <textarea id="<%=cId%>"','    class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>"',"  <% if (maxlength) { %>",'    maxlength="<%=maxlength%>"',"  <% } %>",'    placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%>','    rows=<%=rows ? rows : ""%>','    <%=required ? "required" : ""%>><%-value%></textarea>',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),onKeyUp:function(e){this.key_timeout&&clearTimeout(this.key_timeout),this.keyup_timeout=setTimeout(function(){this.onChange(e)}.bind(this),400)}}),_.SelectControl.prototype.render=function(){function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});if(C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model)}),C.isFunction(o.options))try{o.options=o.options(this)}catch(e){o.options=[],this.model.trigger("pgadmin-view:transform:error",this.model,this.field,e)}return o.cId=o.cId||C.uniqueId("pgC_"),this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),this.$el.html(this.template(o)).addClass(t.name),this.updateInvalid(),this},_.SelectControl.prototype.template=C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlContainerClassName%>">','  <select id="<%=cId%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" value="<%-value%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> >',"    <% for (var i=0; i < options.length; i++) { %>","      <% var option = options[i]; %>",'      <option value="<%-formatter.fromRaw(option.value)%>" <%=option.value === rawValue ? "selected=\'selected\'" : ""%> <%=option.disabled ? "disabled=\'disabled\'" : ""%>><%-option.label%></option>',"    <% } %>","  </select>","</div>"].join("\n")),C.extend(_.SelectControl.prototype.defaults,{helpMessage:null}),_.ReadonlyOptionControl=_.SelectControl.extend({template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">',"<% for (var i=0; i < options.length; i++) { %>"," <% var option = options[i]; %>"," <% if (option.value === rawValue) { %>",' <input id="<%=cId%>" class="<%=Backform.controlClassName%> uneditable-input" disabled readonly value="<%-option.label%>"></span>'," <% } %>","<% } %>","<% if (helpMessage && helpMessage.length) { %>",'  <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"<% } %>","</div>"].join("\n")),events:{},getValueFromDOM:function(){return this.formatter.toRaw(this.$el.find("span").text(),this.model)}}),C.extend(_.RadioControl.prototype,{updateInvalid:function(){var n=this,s=this.model.errorModel;if(!(s instanceof o.Model))return this;this.clearInvalid(),this.$el.find(":input[name]").not("button").each(function(e,t){var i=n.keyPathAccessor(s.toJSON(),g(t).attr("name"));C.isEmpty(i)||n.$el.addClass(_.errorClassName).find('[type="radio"]').append(g("<div></div>").addClass("pgadmin-control-error-message pg-el-offset-4 pg-el-8 pg-el-8 help-block").text(i))})}}),_.RadioModernControl=_.RadioControl.extend({defaults:{controlLabelClassName:_.controlLabelClassName,controlsClassName:_.controlsClassName,extraClasses:[],helpMessage:"",name:""},template:C.template(['<label class="<%=controlLabelClassName%>"><%=label%></label>',"<div class=\"<%=controlsClassName%> <%=extraClasses.join(' ')%>\">",' <div class="btn-group pgadmin-controls-radio-none<% if (disabled) {%> disabled <%}%>"  data-toggle="buttons">',"  <% for (var i=0; i < options.length; i++) { %>","  <% var option = options[i]; %>",'  <label class="btn btn-primary<% if (option.value == value) { %> active<%}%><% if (!option.disabled && !disabled) { %>" tabindex="0"<% } else { %> disabled"<% } %>>','   <input type="radio" name="<%=name%>" autocomplete="off" value=<%-formatter.fromRaw(option.value)%> <% if (option.value == value) { %> checked<%}%> <% if (option.disabled || disabled) { %> disabled <%}%>> <%-option.label%>',"  </label>","  <% } %>"," </div>"," <% if (helpMessage && helpMessage.length) { %>",'  <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>'," <% } %>","</div>"].join("\n")),formatter:e,getValueFromDOM:function(){return this.formatter.toRaw(this.$el.find('input[type="radio"]:checked').attr("value"),this.model)},render:function(){function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});return C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model)}),o.options=C.isFunction(o.options)?o.options.apply(o,[this.model]):o.options,this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),this.$el.html(this.template(o)).addClass(t.name),this.updateInvalid(),this.$el.find(".btn").on("keyup",function(e){switch(e.keyCode){case 32:g(e.currentTarget).trigger("click")}}),this}}),_.SwitchControl=_.InputControl.extend({defaults:{label:"",options:{onText:y("Yes"),offText:y("No"),onColor:"success",offColor:"primary",size:"mini",width:null,height:null},controlLabelClassName:_.controlLabelClassName,controlsClassName:_.controlsClassName,extraClasses:[],helpMessage:null,extraToggleClasses:null},template:C.template(['<label class="<%=controlLabelClassName%>"><%=label%></label>','<label class="sr-value sr-only" for="<%=cId%>"></label>',"<div class=\"<%=controlsClassName%> <%=extraClasses.join(' ')%>\">",'      <input tabindex="-1" type="checkbox" aria-hidden="true" aria-label="Toggle button" data-style="quick" data-toggle="toggle"','      data-size="<%=options.size%>" data-height="<%=options.height%>"  ','      data-on="<%=options.onText%>" data-off="<%=options.offText%>" ','      data-onstyle="<%=options.onColor%>" data-offstyle="<%=options.offColor%>" data-width="<%=options.width%>" ','      name="<%=name%>" <%=value ? "checked=\'checked\'" : ""%> <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),getValueFromDOM:function(){return this.formatter.toRaw(this.$input.prop("checked"),this.model)},events:{"change input":"onChange",keyup:"toggleSwitch"},setSrValue:function(){var e=C.defaults(this.field.get("options"),this.defaults.options),t=e.onText,i=e.offText,n=this.field.get("label");this.$el.find(".toggle.btn").hasClass("off")?this.$el.find(".sr-value").text("\n          ".concat(n,". ").concat(i,". ").concat(y("Toggle button"),"\n        ")):this.$el.find(".sr-value").text("\n          ".concat(n,". ").concat(t,". ").concat(y("Toggle button"),"\n        "))},onChange:function(){_.InputControl.prototype.onChange.apply(this,arguments),this.setSrValue()},toggleSwitch:function(e){32==e.keyCode&&(this.$el.find("input[type=checkbox]").bootstrapToggle("toggle"),e.preventDefault(),this.setSrValue())},render:function(){function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});return C.extend(o,{disabled:e(t.disabled,t,this.model),visible:e(o.visible,t,this.model),required:e(o.required,t,this.model)}),o.cId=o.cId||C.uniqueId("pgC_"),this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),_.requiredInputClassName&&this.$el.removeClass(_.requiredInputClassName),o.required&&this.$el.addClass(_.requiredInputClassName),o.options=C.defaults({disabled:e(t.disabled,t,this.model)},this.field.get("options"),this.defaults.options,g.fn.bootstrapToggle.defaults),this.$el.html(this.template(o)).addClass(t.name),C.isNull(t.extraToggleClasses)||this.$el.addClass(t.extraToggleClasses),this.$input=this.$el.find("input[type=checkbox]").first(),this.$input.bootstrapToggle(),this.$el.find(".toggle.btn").attr("tabindex",o.options.disabled?"-1":"0").attr("id",o.cId),this.$el.find(".toggle.btn .toggle-group .btn").attr("aria-hidden",!0),this.setSrValue(),this.updateInvalid(),this}}),_.Dialog=_.Form.extend({schema:void 0,tagName:"div",legend:!0,className:function(){return"pg-el-sm-12 pg-el-md-12 pg-el-lg-12 pg-el-12"},tabPanelClassName:function(){return _.tabClassName},tabIndex:0,initialize:function(t){var e=t.schema;e&&C.isArray(e)&&(this.schema=C.each(e,function(e){!e.fields||e.fields instanceof o.Collection||(e.fields=new _.Fields(e.fields)),e.cId=e.cId||C.uniqueId("pgC_"),e.hId=e.hId||C.uniqueId("pgH_"),e.disabled=e.disabled||!1,e.legend=t.legend}),t.tabPanelClassName&&C.isFunction(t.tabPanelClassName)&&(this.tabPanelClassName=t.tabPanelClassName)),this.model.errorModel=t.errorModel||this.model.errorModel||new o.Model,this.controls=[]},template:{header:C.template(['<li class="nav-item" role="presentation" <%=disabled ? "disabled" : ""%>>',' <a class="nav-link" data-toggle="tab" tabindex="-1" data-tab-index="<%=tabIndex%>" href="#<%=cId%>"','  id="<%=hId%>" aria-controls="<%=cId%>">',"<%=label%></a></li>"].join(" ")),panel:C.template('<div role="tabpanel" tabindex="-1" class="tab-pane <%=label%> <%=tabPanelCodeClass%> pg-el-sm-12 pg-el-md-12 pg-el-lg-12 pg-el-12 fade" id="<%=cId%>" aria-labelledby="<%=hId%>"></div>')},render:function(){this.cleanup();var e=this.$el.children().first().children(".active").first().attr("id"),n=this.model,s=this.controls,t=this.template,a=this,l=100*this.tabIndex;this.$el.empty().attr("role","tabpanel").attr("class",C.result(this,"tabPanelClassName")),n.panelEl=this.$el;var o=g('<ul class="nav nav-tabs" role="tablist"></ul>').appendTo(this.$el),r=g('<div class="tab-content pg-el-sm-12 pg-el-md-12 pg-el-lg-12 pg-el-12"></div>').appendTo(this.$el);C.each(this.schema,function(e){if(l++,e.version_compatible&&function(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}(e.visible,e,n)){var i=g(t.panel(C.extend(e,{tabIndex:l,tabPanelCodeClass:e.tabPanelCodeClass?e.tabPanelCodeClass:""}))).appendTo(r).removeClass("collapse").addClass("collapse");g(t.header(e)).appendTo(o),e.fields.each(function(e){var t=new(e.get("control"))({field:e,model:n,dialog:a,tabIndex:l});i.append(t.render().$el),s.push(t)}),o.find('a[data-toggle="tab"]').off("shown.bs.tab").off("hidden.bs.tab").on("hidden.bs.tab",function(){a.hidden_tab=g(this).data("tabIndex")}).on("shown.bs.tab",function(){var e=this;e.shown_tab=g(e).data("tabIndex"),n.trigger("pg-property-tab-changed",{model:n,shown:e.shown_tab,hidden:e.hidden_tab,tab:e})})}});var i=o.find('[id="'+e+'"]').first();return 1==i.length?(i.addClass("active show"),r.find("#"+i.attr("aria-controls")).addClass("active show")):(o.find(".nav-link").first().addClass("active show"),r.find(".tab-pane").first().addClass("active show")),this},remove:function(e){e&&e.data&&(this.model&&(this.model.reset&&this.model.reset({validate:!1,silent:!0,stop:!0}),this.model.clear({validate:!1,silent:!0,stop:!0}),delete this.model),this.errorModel&&(this.errorModel.clear({validate:!1,silent:!0,stop:!0}),delete this.errorModel)),this.cleanup(),_.Form.prototype.remove.apply(this,arguments)}}),_.Accordian=_.Dialog.extend({className:function(){return"set-group pg-el-12"},tabPanelClassName:function(){return _.tabClassName},legendClass:"badge",contentClass:_.accordianContentClassName+" collapse show",template:{header:C.template(['<div class="<%=Backform.accordianGroupClassName%>" <%=disabled ? "disabled" : ""%>>'," <% if (legend != false) { %>",'  <div class="<%=legendClass%>" <%=collapse ? "data-toggle=\'collapse\'" : ""%> data-target="#<%=cId%>"><%=collapse ? "<span class=\'caret\'></span>" : "" %><%=label%></legend>'," <% } %>","</div>"].join("\n")),content:C.template('  <div id="<%= cId %>" class="<%=contentClass%>"></div>')},collapse:!0,render:function(){this.cleanup();var s=this.model,a=this.$el,l=this.template,o=this.controls,r={className:C.result(this,"className"),legendClass:C.result(this,"legendClass"),contentClass:C.result(this,"contentClass"),collapse:C.result(this,"collapse")},d=100*this.tabIndex;return this.$el.empty(),C.each(this.schema,function(e){if(d++,e.version_compatible&&function(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}(e.visible,e,s)&&e.fields){var t=C.extend({},r,e),i=g(l.header(t)).appendTo(a),n=g(l.content(t)).appendTo(i);e.fields.each(function(e){var t=new(e.get("control"))({field:e,model:s,tabIndex:d});n.append(t.render().$el),o.push(t)})}}),this},getValueFromDOM:function(){return""},events:{}}),_.Fieldset=_.Dialog.extend({className:function(){return"set-group pg-el-12"},tabPanelClassName:function(){return _.tabClassName},fieldsetClass:_.setGroupClassName,legendClass:"badge",contentClass:_.setGroupContentClassName+" collapse show",template:{header:C.template(['<fieldset class="<%=fieldsetClass%>" <%=disabled ? "disabled" : ""%>>'," <% if (legend != false) { %>",'  <legend class="<%=legendClass%>" <%=collapse ? "data-toggle=\'collapse\'" : ""%> data-target="#<%=cId%>"><%=collapse ? "<span class=\'caret\'></span>" : "" %><%=label%></legend>'," <% } %>","</fieldset>"].join("\n")),content:C.template('  <div id="<%= cId %>" class="<%=contentClass%>"></div>')},collapse:!0,render:function(){this.cleanup();var s=this.model,a=this.$el,l=this.template,o=this.controls,r={className:C.result(this,"className"),fieldsetClass:C.result(this,"fieldsetClass"),legendClass:C.result(this,"legendClass"),contentClass:C.result(this,"contentClass"),collapse:C.result(this,"collapse")},d=100*this.tabIndex;return this.$el.empty(),C.each(this.schema,function(e){if(d++,e.version_compatible&&function(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}(e.visible,e,s)&&e.fields){var t=C.extend({},r,e),i=g(l.header(t)).appendTo(a),n=g(l.content(t)).appendTo(i);e.fields.each(function(e){var t=new(e.get("control"))({field:e,model:s,tabIndex:d});n.append(t.render().$el),o.push(t)})}}),this},getValueFromDOM:function(){return""},events:{}}),_.generateGridColumnsFromModel=function(e,t,i,n,s){var a,l=_.generateViewSchema(e,t,i,s,!0,!0),o=[],r=[],d=0;if(C.isNull(n)||C.isUndefined(n))a=function(e){e.cell_priority=d,d+=1,!e.headerCell&&e.cellHeaderClasses&&(e.headerCell=v.Extension.CustomHeaderCell)};else if(C.isArray(n))a=function(e){e.cell_priority=C.indexOf(n,e.name),!e.headerCell&&e.cellHeaderClasses&&(e.headerCell=v.Extension.CustomHeaderCell)};else if(C.isObject(n)){var c=Object.keys(n);a=function(e){var t,i=e.name in n&&n[e.name];C.isNull(i)||C.isUndefined(i)?e.cell_priority=-1:(C.isObject(i)&&("index"in i?(e.cell_priority=i.index,d=d>i.index?d+1:i.index):(t=C.indexOf(c,e.name),e.cell_priority=d=d<t?t:d,d+=1),e.headerCell||(e.cellHeaderClasses&&(e.headerCell=v.Extension.CustomHeaderCell),"class"in i&&C.isString(i.class)&&(e.headerCell=v.Extension.CustomHeaderCell,e.cellHeaderClasses=(e.cellHeaderClasses||"")+" "+i.class))),C.isString(i)&&(t=C.indexOf(c,e.name),e.cell_priority=d=d<t?t:d,d+=1,e.headerCell||(e.headerCell=v.Extension.CustomHeaderCell),e.cellHeaderClasses=(e.cellHeaderClasses||"")+" "+i))}}return C.each(l,function(e){C.each(e.fields,function(e){e.cell&&(a(e),-1!=e.cell_priority&&r.push(e))}),o.push(e)}),{columns:C.sortBy(r,function(e){return e.cell_priority}),schema:o}},_.UniqueColCollectionControl=_.Control.extend({initialize:function(){_.Control.prototype.initialize.apply(this,arguments);var e=this.field.get("uniqueCol")||[],t=this.field.get("model"),i=t.prototype.schema||t.__super__.schema,n=[],s=this;if(C.each(i,function(e){n.push(e.id)}),e.length>C.intersection(n,e).length){var a="Developer: Unique columns [ "+C.difference(e,n)+" ] not found in collection model [ "+n+" ].";alert(a)}var l=s.collection=s.model.get(s.field.get("name"));l||(l=s.collection=new x.Browser.Node.Collection(null,{model:s.field.get("model"),silent:!0,handler:s.model,top:s.model.top||s.model,attrName:s.field.get("name")}),s.model.set(s.field.get("name"),l,{silent:!0})),this.field.get("version_compatible")&&(s.listenTo(l,"add",s.collectionChanged),s.listenTo(l,"change",s.collectionChanged))},cleanup:function(){this.stopListening(this.collection,"change",this.collectionChanged),this.field.get("version_compatible")&&(this.stopListening(self.collection,"add",this.collectionChanged),this.stopListening(self.collection,"change",this.collectionChanged)),this.grid&&(this.grid.remove(),delete this.grid),this.$el.empty()},collectionChanged:function(s,e,t){var a=this.field.get("uniqueCol")||[],i=[];if(s.attributes&&(C.each(a,function(e){C.has(s.attributes,e)&&i.push(e)}),0!=i.length)){var n=this.model.get(this.field.get("name"));this.stopListening(n,"change",this.collectionChanged);var l=void 0,o=void 0;if(n.each(function(i){if(s!=i){var n=[];C.each(a,function(e){var t=s.get(e);C.isUndefined(t)||t!=i.get(e)||n.push(t)}),n.length==a.length&&(l=s,o=i)}}),l&&(t&&t.add?setTimeout(function(){n.remove(l)},0):l.set(i[0],l.previous(i[0])),o)){var r=n.indexOf(o);if(-1<r){var d=this.grid.body.rows[r].$el;d.addClass("new"),g(d).pgMakeVisible("backform-tab"),setTimeout(function(){d.removeClass("new")},3e3)}}this.listenTo(n,"change",this.collectionChanged)}},render:function(){this.undelegateEvents(),this.$el.empty();function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});if(C.extend(o,{disabled:t.version_compatible&&e.apply(this.field,[o.disabled,o,this.model]),visible:e.apply(this.field,[o.visible,o,this.model]),required:e.apply(this.field,[o.required,o,this.model]),canAdd:t.version_compatible&&e.apply(this.field,[o.canAdd,o,this.model]),canAddRow:o.canAddRow,canDelete:e.apply(this.field,[o.canDelete,o,this.model]),canEdit:e.apply(this.field,[o.canEdit,o,this.model])}),C.extend(o,{add_label:""}),!o.visible)return this;this.control_data=C.clone(o);var r=this.showGridControl(o);return this.$el.html(r).addClass(t.name),this.updateInvalid(),this.delegateEvents(),this},showGridControl:function(a){var l=this,e=C.template(['<div class="subnode-header">','  <label class="control-label pg-el-sm-10"><%-label%></label>','  <button class="btn btn-sm-sq btn-secondary add fa fa-plus" <%=canAdd ? "" : "disabled=\'disabled\'"%> title="'+C("Add new row")+'"><%-add_label%></button>',"</div>"].join("\n")),t=g('<div class="pgadmin-control-group backgrid form-group pg-el-12 object subnode "></div>').append(e(a));if(l.grid&&l.grid.remove(),!a.subnode)return"";var i=a.subnode.schema?a.subnode:a.subnode.prototype,n=_.generateGridColumnsFromModel(a.node_info,i,this.field.get("mode"),a.columns);if("properties"==a.mode&&g(t).find("button.add").remove(),!a.disabled&&a.canDelete&&n.columns.unshift({name:"pg-backform-delete",label:"",cell:v.Extension.DeleteCell,editable:!1,cell_priority:-1,canDeleteRow:a.canDeleteRow}),0==a.disabled&&a.canEdit){var s=v.Extension.ObjectCell.extend({schema:n.schema});n.columns.unshift({name:"pg-backform-edit",label:"",cell:s,cell_priority:-2,canEditRow:a.canEditRow})}var o=this.model.get(a.name);o.on("enteringEditMode",function(e){var s=this,a=e[0];this.each(function(e){if(a.model!=e){var t=s.indexOf(e);if(-1<t){var i=l.grid.body.rows[t].$el.find(".subnode-edit-in-process").parent();if(0<i.length){var n=new Event("click");i[0].dispatchEvent(n)}}}})},o),l.grid=new v.Grid({columns:n.columns,collection:o,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});var r=l.grid.render().$el;a.canDelete&&a.canEdit&&(g(r).find("th.pg-backform-delete").remove(),g(r).find("th.pg-backform-edit").attr("colspan","2"));var d=t.append(r),c=k;0==k.preferences_cache.length&&(c=w.default.pgAdmin.Browser);var p=c.get_preferences_for_module("browser");if(p){var u=d.find(".add");g(u).attr("title",b.shortcut_title(y("Add new row"),p.add_grid_row))}return a.disabled||0==a.canAdd||d.find("button.add").first().on("click",function(e){if(e.preventDefault(),!C.isFunction(a.canAddRow)||a.canAddRow.apply(l,[l.model])){if(C.each(l.grid.body.rows,function(e){var t=e.$el.find(".subnode-edit-in-process").parent();if(0<t.length){var i=new Event("click");t[0].dispatchEvent(i)}}),!!!l.field.get("allowMultipleEmptyRows")&&o){var i=!1;if(o.each(function(e){var t=[];C.each(e.attributes,function(e){t.push(e)}),C.some(t,C.identity)||(i=!0)}),i)return!1}g(l.grid.body.$el.find(g("tr.new"))).removeClass("new");var t=new a.model(null,{silent:!0,handler:o,top:l.model.top||l.model,collection:o,node_info:l.model.node_info});o.add(t);var n=o.indexOf(t),s=l.grid.body.rows[n].$el;s.addClass("new");try{g(s).pgMakeBackgridVisible(".backform-tab")}catch(e){g(s).pgMakeBackgridVisible(".set-group")}return!1}}),d},clearInvalid:function(){return this.$el.removeClass("subnode-error"),this.$el.find(".pgadmin-control-error-message").remove(),this},updateInvalid:function(){var t=this,i=this.model.errorModel;if(!(i instanceof o.Model))return this;this.clearInvalid(),this.$el.find(".subnode-body").each(function(){var e=t.keyPathAccessor(i.toJSON(),t.field.get("name"));C.isEmpty(e)||t.$el.addClass("subnode-error").append(g("<div></div>").addClass("pgadmin-control-error-message pg-el-offset-4 pg-el-8 help-block").text(e))})}}),_.SubNodeCollectionControl=_.Control.extend({row:v.Row,render:function(){function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model),canAdd:e(o.canAdd,o,this.model),canAddRow:o.canAddRow,canEdit:e(o.canEdit,o,this.model),canDelete:e(o.canDelete,o,this.model),showError:o.showError||!0});var r=null==o.subnode?"":this.showGridControl(o);return this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),this.$el.html(r).addClass(t.name),this.updateInvalid(),this},updateInvalid:function(){var e=this.model.errorModel;if(!(e instanceof o.Model))return this;this.clearInvalid();var t=this.field.get("name").split(".").join("."),i=this.keyPathAccessor(e.toJSON(),t);C.isEmpty(i)||this.field.get("showError")&&this.$el.addClass("subnode-error").append(g("<div></div>").addClass("pgadmin-control-error-message pg-el-offset-4 pg-el-8 help-block").text(i))},cleanup:function(){this.grid&&this.grid.remove(),this.collection&&this.collection.off("enteringEditMode")},clearInvalid:function(){return this.field.get("showError")&&(this.$el.removeClass("subnode-error"),this.$el.find(".pgadmin-control-error-message").remove()),this},showGridControl:function(i){var n=this,s=this,e=["<div class='subnode-header'>","  <label class='control-label pg-el-sm-10'>"+i.label+"</label>","  <button class='btn btn-sm-sq btn-secondary add fa fa-plus' title='"+C("Add new row")+"'></button>","</div>"].join("\n"),t=g("<div class='pgadmin-control-group backgrid form-group pg-el-12 object subnode'></div>").append(e),a=i.subnode.schema?i.subnode:i.subnode.prototype,l=_.generateGridColumnsFromModel(i.node_info,a,this.field.get("mode"),i.columns,i.schema_node);if(s.grid&&s.grid.remove(),!i.disabled&&0!=i.canAdd||g(t).find("button.add").remove(),0==i.disabled&&i.canDelete&&l.columns.unshift({name:"pg-backform-delete",label:"",cell:v.Extension.DeleteCell,editable:!1,cell_priority:-1,canDeleteRow:i.canDeleteRow,customDeleteMsg:i.customDeleteMsg,customDeleteTitle:i.customDeleteTitle}),0==i.disabled&&i.canEdit){var o=v.Extension.ObjectCell.extend({schema:l.schema}),r=s.field.has("canEdit")&&s.field.get("canEdit")||!0;l.columns.unshift({name:"pg-backform-edit",label:"",cell:o,cell_priority:-2,editable:r,canEditRow:i.canEditRow})}var d=s.model.get(i.name);d||(d=new k.Node.Collection(null,{handler:s.model.handler||s.model,model:i.model,top:s.model.top||s.model,silent:!0}),s.model.set(i.name,d,{silent:!0}));d.on("enteringEditMode",function(e){var s=this,a=e[0];this.each(function(e){if(a.model!=e){var t=s.indexOf(e);if(-1<t){var i=c.body.rows[t].$el.find(".subnode-edit-in-process").parent();if(0<i.length){var n=new Event("click");i[0].dispatchEvent(n)}}}})},d);var c=s.grid=new v.Grid({columns:l.columns,collection:d,row:this.row,className:"backgrid table presentation table-bordered table-noouter-border table-hover"}),p=c.render().$el;i.canDelete&&i.canEdit&&(g(p).find("th.pg-backform-delete").remove(),g(p).find("th.pg-backform-edit").attr("colspan","2"));var u=t.append(p),h=k;0==k.preferences_cache.length&&(h=w.default.pgAdmin.Browser);var f=h.get_preferences_for_module("browser");if(f){var m=u.find(".add");g(m).attr("title",b.shortcut_title(y("Add new row"),f.add_grid_row))}return u.find("button.add").on("click",function(e){if(e.preventDefault(),!C.isFunction(i.canAddRow)||i.canAddRow.apply(s,[s.model])){C.each(c.body.rows,function(e){var t=e.$el.find(".subnode-edit-in-process").parent();if(0<t.length){var i=new Event("click");t[0].dispatchEvent(i)}}),c.insertRow({});var t=g(c.body.rows[d.length-1].$el);t.attr("class","new").on("click",function(){g(n).attr("class","editable")});try{g(t).pgMakeBackgridVisible(".backform-tab")}catch(e){g(t).pgMakeBackgridVisible(".set-group")}return!1}}),u}}),_.SqlTabControl=_.Control.extend({defaults:{label:"",controlsClassName:"pgadmin-controls pg-el-sm-12 SQL",extraClasses:[],helpMessage:null},template:C.template(['<div class="<%=controlsClassName%>">','  <textarea class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%>><%-value%></textarea>',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),initialize:function(e){_.Control.prototype.initialize.apply(this,arguments),this.dialog=e.dialog,this.tabIndex=e.tabIndex,C.bindAll(this,"onTabChange","onPanelResized")},getValueFromDOM:function(){return this.formatter.toRaw(this.$el.find("textarea").val(),this.model)},reflectPreferences:function(){var e=this;if(e.sqlCtrl){var t=x.Browser.get_preferences_for_module("sqleditor");g(e.sqlCtrl.getWrapperElement()).css("font-size",i.calcFontSize(t.sql_font_size)),e.sqlCtrl.setOption("tabSize",t.tab_size),e.sqlCtrl.setOption("lineWrapping",t.wrap_code),e.sqlCtrl.setOption("autoCloseBrackets",t.insert_pair_brackets),e.sqlCtrl.setOption("matchBrackets",t.brace_matching),e.sqlCtrl.refresh()}},render:function(){this.sqlCtrl&&(this.sqlCtrl.toTextArea(),delete this.sqlCtrl,this.sqlCtrl=null,this.$el.empty(),this.model.off("pg-property-tab-changed",this.onTabChange,this),this.model.off("pg-browser-resized",this.onPanelResized,this)),_.Control.prototype.render.apply(this,arguments),this.sqlCtrl=u.fromTextArea(this.$el.find("textarea")[0],{lineNumbers:!0,mode:"text/x-pgsql",readOnly:!0,extraKeys:x.Browser.editor_shortcut_keys}),this.reflectPreferences();var e=this;return k.onPreferencesChange("sqleditor",function(){e.reflectPreferences()}),this.model.on("pg-property-tab-changed",this.onTabChange,this),this.model.on("pg-browser-resized",this.onPanelResized,this),this},onTabChange:function(e){if(this.dialog&&e.shown==this.tabIndex){if(this.model.sessChanged())if(0==C.size(this.model.errorModel.attributes)){var t=this,i=t.field.get("schema_node"),n=i.generate_url.apply(i,[null,"msql",this.field.get("node_data"),!t.model.isNew(),this.field.get("node_info")]);t.model.trigger("pgadmin-view:msql:fetching",t.method,i),g.ajax({url:n,type:"GET",cache:!1,data:t.model.toJSON(!0,"GET"),dataType:"json",contentType:"application/json"}).done(function(e){t.sqlCtrl.clearHistory(),t.sqlCtrl.setValue(e.data)}).fail(function(){t.model.trigger("pgadmin-view:msql:error",t.method,i,arguments)}).always(function(){t.model.trigger("pgadmin-view:msql:fetched",t.method,i,arguments)})}else this.sqlCtrl.clearHistory(),this.sqlCtrl.setValue("-- "+y("Definition incomplete."));else this.sqlCtrl.clearHistory(),this.sqlCtrl.setValue("-- "+y("No updates."));this.sqlCtrl.refresh.apply(this.sqlCtrl)}},onPanelResized:function(e){if(e&&e.container){var t=e.container.find(".backform-tab > .tab-content").first(),i=t.find("div[role=tabpanel].tab-pane.SQL");i.hasClass("active")&&i.find(".CodeMirror").css("cssText","height: "+(t.height()+8)+"px !important;")}},remove:function(){this.sqlCtrl&&(this.sqlCtrl.toTextArea(),delete this.sqlCtrl,this.sqlCtrl=null,this.$el.empty()),this.model.off("pg-property-tab-changed",this.onTabChange,this),this.model.off("pg-browser-resized",this.onPanelResized,this),_.Control.__super__.remove.apply(this,arguments)}}),_.NumericControl=_.InputControl.extend({defaults:{type:"number",label:"",min:void 0,max:void 0,maxlength:255,extraClasses:[],helpMessage:null},template:C.template(['<label for="<%=cId%>" class="<%=Backform.controlLabelClassName%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','  <input type="<%=type%>" id="<%=cId%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" min="<%=min%>" max="<%=max%>"maxlength="<%=maxlength%>" value="<%-value%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n"))}),_.generateViewSchema=function(r,d,c,p,u,e,t){var i=d&&d.prototype||d,n=t||i&&i.schema,s=[],h={};if(n&&C.isArray(n)){var f,m=m=function(e){return e&&i[e]&&"function"==typeof i[e]?i[e]:e},g={},v=r&&"server"in r&&k.serverInfo&&k.serverInfo[r.server._id],b=r&&"catalog"in r;if(C.each(n,function(e){if("group"==e.type){var t=!0;return f=!!C.isUndefined(v)||(!!C.isUndefined(e.server_type)||v.type in e.server_type)&&(!!C.isUndefined(e.min_version)||v.version>=e.min_version)&&(!!C.isUndefined(e.max_version)||v.version<=e.max_version),e.mode&&C.isObject(e.mode)&&(t=-1<C.indexOf(e.mode,c)),t=t&&m(e.visible),void(h[e.id]={label:e.label||e.id,version_compatible:f,visible:t,tabPanelCodeClass:""})}if(!e.mode||e&&e.mode&&C.isObject(e.mode)&&-1!=C.indexOf(e.mode,c)){var i=e.group||y("General"),n=e.control||_.getMappedControl(e.type,c),s=e.cell||_.getMappedControl(e.type,"cell");if(null==n)return;g[i]=g[i]||[],f=!!C.isUndefined(v)||(!!C.isUndefined(e.server_type)||v.type in e.server_type)&&(!!C.isUndefined(e.min_version)||v.version>=e.min_version)&&(!!C.isUndefined(e.max_version)||v.version<=e.max_version);var a="properties"==c||!f||b,l=e.node&&C.isString(e.node)&&e.node in k.Nodes&&k.Nodes[e.node]||p,o=C.extend(C.clone(e),{name:e.id,disabled:!!a||m(e.disabled),editable:C.isUndefined(e.editable)?x.editableCell:m(e.editable),subnode:C.isString(e.model)&&e.model in k.Nodes?k.Nodes[e.model].model:e.model,canAdd:!a&&m(e.canAdd),canAddRow:!a&&m(e.canAddRow),canEdit:!a&&m(e.canEdit),canDelete:!a&&m(e.canDelete),canEditRow:!a&&m(e.canEditRow),canDeleteRow:!a&&m(e.canDeleteRow),transform:m(e.transform),mode:c,control:n,cell:s,node_info:r,schema_node:l,visible:m(e.visible),node:p,node_data:u,version_compatible:f});delete o.id,g[i].push(o),"nested"==e.type&&(delete o.name,delete o.cell,o.schema=_.generateViewSchema(r,d,c,p,u,!0,e.schema),o.control=o.control||"tab")}}),C.isEmpty(g))return null;e||!p||!p.hasSQL||"create"!=c&&"edit"!=c||(g[y("SQL")]=[{name:"sql",visible:!0,disabled:!1,type:"text",control:"sql-tab",node_info:r,schema_node:p,node_data:u}]),C.each(g,function(e,t){var i=C.pluck(e,"tabPanelCodeClass");i=i&&i.join(" ").trim(),s.push(C.extend(C.defaults(h[t]||{label:t,tabPanelCodeClass:i},{version_compatible:!0,visible:!0}),{fields:e}))})}return s};function s(){}C.extend(s.prototype,{fromRaw:function(e){return encodeURIComponent(e)},toRaw:function(e,t,i){return C.isArray(e)?i&&i.tags?e:C.map(e,decodeURIComponent):C.isNull(e)||C.isUndefined(e)?null:decodeURIComponent(e)}}),_.Select2Control=_.SelectControl.extend({defaults:C.extend({},_.SelectControl.prototype.defaults,{select2:{first_empty:!0,multiple:!1,emptyOptions:!1,preserveSelectionOrder:!1,isDropdownParent:!1}}),events:function(){return C.extend({},_.SelectControl.prototype.events,{"select2:select":"onSelect"})},onSelect:function(e){var t=this.field.get("select2");if(!C.isUndefined(t)&&!C.isNull(t)&&t.multiple&&t.preserveSelectionOrder){var i=e.params.data.element,n=g(i);n.detach(),g(this.$sel).append(n),g(this.$sel).trigger("change")}var s=C.findWhere(this.field.get("options"),{value:e.params.data.id});s&&!C.isUndefined(s.preview_src)&&s.preview_src&&this.$el.find(".preview-img img").attr("src",s.preview_src)},formatter:s,template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">',' <select id="<%=cId%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>"','  name="<%=name%>" value="<%-value%>" <%=disabled ? "disabled" : ""%>','  <%=required ? "required" : ""%><%= select2.multiple ? " multiple>" : ">" %>','  <%=select2.first_empty ? " <option></option>" : ""%>',"  <% for (var i=0; i < options.length; i++) {%>","   <% var option = options[i]; %>","   <option ","    <% if (option.image) { %> data-image=<%=option.image%> <%}%>","    value=<%- formatter.fromRaw(option.value) %>",'    <% if (option.selected) {%>selected="selected"<%} else {%>','    <% if (!select2.multiple && option.value === rawValue) {%>selected="selected"<%}%>','    <% if (select2.multiple && rawValue && rawValue.indexOf(option.value) != -1){%>selected="selected" data-index="rawValue.indexOf(option.value)"<%}%>',"    <%}%>",'    <%= disabled ? "disabled" : ""%>><%-option.label%></option>',"  <%}%>"," </select>"," <% if (helpMessage && helpMessage.length) { %>",' <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>'," <% } %>"," <% for (var i=0; i < options.length; i++) {%>","   <% var option = options[i]; %>","     <% if (option.preview_src && option.value === rawValue) { %>",'       <div class="preview-img mt-2">','         <img src="<%=option.preview_src%>" class="img-fluid mx-auto d-block w-50 border" alt="'+y("Preview not available...")+'">',"       </div>","    <%}%>"," <%}%>","</div>"].join("\n")),render:function(){this.$sel&&this.$sel.select2&&this.$sel.select2.hasOwnProperty("destroy")&&this.$sel.select2("destroy");function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});if(o.select2=o.select2||{},C.defaults(o.select2,this.defaults.select2,{first_empty:!0,multiple:!1,emptyOptions:!1,preserveSelectionOrder:!1,isDropdownParent:!1}),C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model)}),C.isFunction(o.options))try{o.options=o.options(this)}catch(e){o.options=[],this.model.trigger("pgadmin-view:transform:error",this.model,this.field,e)}o.cId=o.cId||C.uniqueId("pgC_"),this.$el.removeClass(_.hiddenClassName),o.visible||this.$el.addClass(_.hiddenClassName),this.$el.html(this.template(o)).addClass(t.name);var r=C.extend({disabled:o.disabled},t.select2,{options:this.field.get("options")||this.defaults.options});return o.select2.isDropdownParent&&(r.dropdownParent=o.select2.dropdownParent||this.$el),!o.disabled&&"properties"!==o.mode||(r.placeholder=""),o.select2.tags&&o.select2.emptyOptions&&(r.data=o.rawValue),this.$sel=this.$el.find("select").select2(r),o.select2.tags&&o.select2.emptyOptions&&(this.$sel.val(o.rawValue),this.$sel.trigger("change.select2"),this.$sel.on("select2:unselect",function(e){g(this).find('option[value="'+e.params.data.text.replace("'","\\'").replace('"','\\"')+'"]').remove(),g(this).trigger("change.select2"),null==g(this).val()&&g(this).empty()})),this.$sel&&this.$sel.data("select2").on("keypress",function(e){9===e.which&&this.isOpen()&&(e.preventDefault(),this.trigger("results:select",{}))}),this.updateInvalid(),this},getValueFromDOM:function(){var e=C.extend({},this.field.get("select2")||this.defaults.select2),t=this.formatter.toRaw(this.$sel.val(),this.model,e);return e.multiple&&null==t?[]:t}}),_.FieldsetControl=_.Fieldset.extend({initialize:function(e){_.Control.prototype.initialize.apply(this,arguments),_.Dialog.prototype.initialize.apply(this,[{schema:e.field.get("schema")}]),this.dialog=e.dialog,this.tabIndex=e.tabIndex,this.contentClass=e.field.get("contentClass")?e.field.get("contentClass"):"";var t=this.field.get("deps"),i=this;t&&C.isArray(t)&&C.each(t,function(e){var t=e.split(".").shift();i.listenTo(i.model,"change:"+t,i.render)})},orig_render:_.Fieldset.prototype.render,render:function(){var e,t,i,n=C.defaults(this.field.toJSON(),this.defaults);return n.version_compatible&&(e=n.visible,t=n,i=this.model,C.isFunction(e)?e.apply(t,[i]):e)?this.orig_render.apply(this,arguments):(this.cleanup(),this.$el.empty()),this},formatter:function(){},cleanup:function(){_.Fieldset.prototype.cleanup.apply(this)},remove:function(){_.Control.prototype.remove.apply(this,arguments),_.Dialog.prototype.remove.apply(this,arguments)},className:function(){return"set-group"},tabPanelClassName:function(){return _.tabClassName},fieldsetClass:"inline-fieldset",legendClass:"",collapse:!1}),_.TabControl=_.FieldsetControl.extend({tagName:"div",className:"inline-tab-panel",tabPanelClassName:"inline-tab-panel",tabPanelExtraClasses:"",initialize:function(e){_.FieldsetControl.prototype.initialize.apply(this,arguments),this.tabIndex=(e.tabIndex||parseInt(1e3*Math.random()))+1,e.field.get("tabPanelExtraClasses")&&(this.tabPanelExtraClasses=e.field.get("tabPanelExtraClasses")),this.tabPanelClassName=this.tabPanelClassName+" "+this.tabPanelExtraClasses},orig_render:_.Dialog.prototype.render,template:_.Dialog.prototype.template}),_.PlainFieldsetControl=_.FieldsetControl.extend({initialize:function(){_.FieldsetControl.prototype.initialize.apply(this,arguments)},template:{header:C.template(['<fieldset class="<%=fieldsetClass%>" <%=disabled ? "disabled" : ""%>>'," <% if (legend != false) { %>",'  <div><legend class="<%=legendClass%>" <%=collapse ? "data-toggle=\'collapse\'" : ""%> data-target="#<%=cId%>"><%=collapse ? "<span class=\'caret\'></span>" : "" %></legend></div>'," <% } %>","</fieldset>"].join("\n")),content:C.template('  <div id="<%= cId %>" class="<%=contentClass%>"></div>')},fieldsetClass:"inline-fieldset-without-border",legend:!1}),_.SqlFieldControl=_.TextareaControl.extend({defaults:{label:"",extraClasses:[],helpMessage:null,maxlength:4096,rows:void 0},template:C.template(['<label class="<%=Backform.controlLabelClassName%>"><%=label%></label>',"<div class=\"<%=Backform.controlsClassName%> sql_field_layout <%=extraClasses.join(' ')%>\">","  <textarea ",'    class="<%=Backform.controlClassName%> " name="<%=name%>"','    maxlength="<%=maxlength%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%>',"    rows=<%=rows%>",'    <%=required ? "required" : ""%>><%-value%></textarea>',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),initialize:function(){_.TextareaControl.prototype.initialize.apply(this,arguments),this.sqlCtrl=null,C.bindAll(this,"onFocus","onBlur","refreshTextArea")},getValueFromDOM:function(){return this.sqlCtrl.getValue()},reflectPreferences:function(){var e=this;if(e.sqlCtrl){var t=w.default.pgAdmin.Browser.get_preferences_for_module("sqleditor");g(e.sqlCtrl.getWrapperElement()).css("font-size",i.calcFontSize(t.sql_font_size)),e.sqlCtrl.setOption("indentWithTabs",!t.use_spaces),e.sqlCtrl.setOption("indentUnit",t.tab_size),e.sqlCtrl.setOption("tabSize",t.tab_size),e.sqlCtrl.setOption("lineWrapping",t.wrap_code),e.sqlCtrl.setOption("autoCloseBrackets",t.insert_pair_brackets),e.sqlCtrl.setOption("matchBrackets",t.brace_matching),setTimeout(function(){e.sqlCtrl.refresh()},500)}},render:function(){this.sqlCtrl&&(this.model.off("pg-property-tab-changed",this.refreshTextArea,this),this.sqlCtrl.off("focus",this.onFocus),this.sqlCtrl.off("blur",this.onBlur),this.sqlCtrl.toTextArea(),delete this.sqlCtrl,this.sqlCtrl=null,this.$el.empty()),_.TextareaControl.prototype.render.apply(this,arguments);function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter}),r=e(o.disabled,o,this.model),d=e(o.visible,o,this.model),c=this;if(c.sqlCtrl=u.fromTextArea(c.$el.find("textarea")[0],{lineNumbers:!0,mode:"text/x-pgsql",extraKeys:x.Browser.editor_shortcut_keys}),c.reflectPreferences(),k.onPreferencesChange("sqleditor",function(){c.reflectPreferences()}),r){c.sqlCtrl.setOption("readOnly",!0);var p=c.sqlCtrl.getWrapperElement();p&&(p.className+=" cm_disabled hide-cursor-workaround")}return d||c.$el.addClass(_.hiddenClassName),c.model.on("pg-property-tab-changed",this.refreshTextArea,this),this.sqlCtrl.on("focus",this.onFocus),this.sqlCtrl.on("blur",this.onBlur),setTimeout(function(){c.refreshTextArea.apply(c)},0),c},onFocus:function(){var e=this.$el.find(".pgadmin-controls").first();e.hasClass("focused")||e.addClass("focused")},onBlur:function(){this.$el.find(".pgadmin-controls").first().removeClass("focused")},refreshTextArea:function(){this.sqlCtrl&&this.sqlCtrl.refresh()},remove:function(){this.sqlCtrl&&(this.sqlCtrl.off("focus",this.onFocus),this.sqlCtrl.off("blur",this.onBlur),delete this.sqlCtrl,this.sqlCtrl=null,this.$el.empty()),this.model.off("pg-property-tab-changed",this.refreshTextArea,this),_.TextareaControl.prototype.remove.apply(this,arguments)}}),_.SqlCodeControl=_.SqlFieldControl.extend({template:C.template(["<div class=\"pgadmin-controls pg-el-12 <%=extraClasses.join(' ')%>\">","  <textarea ",'    class="<%=Backform.controlClassName%> " name="<%=name%>"','    maxlength="<%=maxlength%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%>',"    rows=<%=rows%>",'    <%=required ? "required" : ""%>><%-value%></textarea>',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n"))}),_.NoteControl=_.Control.extend({defaults:{label:y("Note"),text:"",extraClasses:["pg-el-12","d-flex"],noteClass:"backform-note",faIcon:"fa-file-text-o",faExtraClass:"fa-rotate-180 fa-flip-vertical",iconWidthClass:"col-0 pr-2",textWidthClass:"col-sm"},template:C.template(["<div class=\"<%=noteClass%> <%=extraClasses.join(' ')%>\">",'  <div class="icon <%=iconWidthClass%>">','    <i class="fa <%=faIcon%> <%=faExtraClass%>" aria-hidden="true"></i>',"  </div>",'  <div class="<%=textWidthClass%>">',"    <span><%=text%></span>","  </div>","</div>"].join("\n"))}),_.FileControl=_.InputControl.extend({defaults:{type:"text",label:"",min:void 0,max:void 0,maxlength:255,extraClasses:[],dialog_title:"",btn_primary:"",helpMessage:null,dialog_type:"select_file"},initialize:function(){_.InputControl.prototype.initialize.apply(this,arguments)},template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','<div class="input-group">','<input type="<%=type%>" id="<%=cId%>" class="form-control <%=extraClasses.join(\' \')%>" name="<%=name%>" min="<%=min%>" max="<%=max%>"maxlength="<%=maxlength%>" value="<%-value%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />','<div class="input-group-append">','<button class="btn btn-secondary fa fa-ellipsis-h select_item" <%=disabled ? "disabled" : ""%> aria-hidden="true" aria-label="Select file" title="Select file"></button>',"</div>","</div>","<% if (helpMessage && helpMessage.length) { %>",'<span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"<% } %>","</div>"].join("\n")),events:function(){return C.extend({},_.InputControl.prototype.events,{"click .select_item":"onSelect"})},onSelect:function(){var e=this.field.get("dialog_type"),t=this.field.get("supp_types"),i=this.field.get("btn_primary"),n={supported_types:t,dialog_type:e,dialog_title:this.field.get("dialog_title"),btn_primary:i};x.FileManager.init(),x.FileManager.show_dialog(n),this.listen_file_dlg_events()},storage_dlg_hander:function(e){var t=this.field.get("name").split(".").shift();this.remove_file_dlg_event_listeners(),this.model.set(t,decodeURI(e)),this.$el.find("input[type=text]").focus()},storage_close_dlg_hander:function(){this.remove_file_dlg_event_listeners()},listen_file_dlg_events:function(){x.Browser.Events.on("pgadmin-storage:finish_btn:"+this.field.get("dialog_type"),this.storage_dlg_hander,this),x.Browser.Events.on("pgadmin-storage:cancel_btn:"+this.field.get("dialog_type"),this.storage_close_dlg_hander,this)},remove_file_dlg_event_listeners:function(){x.Browser.Events.off("pgadmin-storage:finish_btn:"+this.field.get("dialog_type"),this.storage_dlg_hander,this),x.Browser.Events.off("pgadmin-storage:cancel_btn:"+this.field.get("dialog_type"),this.storage_close_dlg_hander,this)},clearInvalid:function(){return _.InputControl.prototype.clearInvalid.apply(this,arguments),this.$el.removeClass("pgadmin-file-has-error"),this},updateInvalid:function(){_.InputControl.prototype.updateInvalid.apply(this,arguments),this.$el.addClass("pgadmin-file-has-error")},disable_button:function(){this.$el.find("button.select_item").attr("disabled","disabled")},enable_button:function(){this.$el.find("button.select_item").removeAttr("disabled")}}),_.DatetimepickerControl=_.InputControl.extend({defaults:{type:"text",label:"",options:{format:"YYYY-MM-DD HH:mm:ss Z",icons:{clear:"fa fa-trash"},buttons:{showToday:!0},toolbarPlacement:"top",widgetPositioning:{horizontal:"auto",vertical:"bottom"},keepOpen:!1},placeholder:"YYYY-MM-DD HH:mm:ss Z",extraClasses:[],helpMessage:null},events:{"blur input":"onChange","change input":"onChange","changeDate input":"onChange","focus input":"clearInvalid","focusout input":"closePicker","change.datetimepicker":"onChange","click .input-group":"togglePicker"},togglePicker:function(){this.has_datepicker&&this.$el.find("input").datetimepicker("toggle")},closePicker:function(){this.has_datepicker&&this.$el.find("input").datetimepicker("hide")},template:C.template(['<label class="<%=Backform.controlLabelClassName%>"><%=label%></label>','<div class="input-group  <%=Backform.controlsClassName%>">',' <input type="text" class="<%=Backform.controlClassName%> datetimepicker-input <%=extraClasses.join(\' \')%>" name="<%=name%>" value="<%-value%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> data-toggle="datetimepicker"/>',' <div class="input-group-append">','   <span class="input-group-text fa fa-calendar"></span>'," </div>","</div>","<% if (helpMessage && helpMessage.length) { %>",'<div class="<%=Backform.helpBlockControlClass%>">',' <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"</div>","<% } %>"].join("\n")),render:function(){function e(e,t){return C.isFunction(e)?!!e(t):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});if(C.extend(o,{disabled:e(o.disabled,this.model),visible:e(o.visible,this.model),required:e(o.required,this.model)}),o.disabled||(o.placeholder=o.placeholder||this.defaults.placeholder),this.has_datepicker&&this.$el.find("input").datetimepicker("destroy"),this.$el.empty(),this.$el.removeClass(_.hiddenClassName),this.$el.html(this.template(o)).addClass(t.name),o.visible){this.has_datepicker=!0;var r=this;C.isUndefined(o.value)||C.isNull(o.value)||"infinity"!==o.value.toLowerCase()||(o.value=null),this.$el.find("input").first().datetimepicker(C.extend({keyBinds:{enter:function(e){var t=this;e?setTimeout(function(){t.toggle(),r.$el.find("input").first().trigger("blur")},10):setTimeout(function(){t.toggle()},10)},tab:function(e){e||setTimeout(function(){r.$el.find("input").first().trigger("blur")},10)},escape:function(e){if(e){var t=this;setTimeout(function(){t.toggle(),r.$el.find("input").first().trigger("blur")},10)}}}},this.defaults.options,this.field.get("options"),{date:o.value,minDate:o.value}))}else this.has_datepicker=!1,this.$el.addClass(_.hiddenClassName);return this.updateInvalid(),this},clearInvalid:function(){return _.InputControl.prototype.clearInvalid.apply(this,arguments),this.$el.removeClass("pgadmin-datepicker-has-error"),this},updateInvalid:function(){_.InputControl.prototype.updateInvalid.apply(this,arguments),this.$el.addClass("pgadmin-datepicker-has-error")},cleanup:function(){this.has_datepicker&&this.$el.find("input").datetimepicker("destroy"),this.$el.empty()}}),_.ColorControl=_.InputControl.extend({defaults:{label:"",extraClasses:[],helpMessage:null,showButtons:!1,showPalette:!0,allowEmpty:!0,colorFormat:"hex",defaultColor:""},template:C.template(['<label class="<%=Backform.controlLabelClassName%>" for="<%=cId%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','  <input id="<%=cId%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" value="<%-value%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),render:function(){this.$picker&&this.$picker.hasOwnProperty("destroy")&&this.$picker("destroy");function e(e,t,i){return C.isFunction(e)?!!e.apply(t,[i]):!!e}var t=C.defaults(this.field.toJSON(),this.defaults),i=this.model.toJSON(),n=t.name.split("."),s=n.shift(),a=n.join("."),l=this.keyPathAccessor(i[s],a),o=C.extend(t,{rawValue:l,value:this.formatter.fromRaw(l,this.model),attributes:i,formatter:this.formatter});return C.extend(o,{disabled:e(o.disabled,o,this.model),visible:e(o.visible,o,this.model),required:e(o.required,o,this.model)}),o.cId=o.cId||C.uniqueId("pgC_"),this.$el.empty(),o.visible||this.$el.addClass(_.hiddenClassname),this.$el.html(this.template(o)).addClass(t.name),this.$picker=this.$el.find("input").spectrum({allowEmpty:o.allowEmpty,preferredFormat:o.colorFormat,disabled:o.disabled,hideAfterPaletteSelect:!0,clickoutFiresChange:!0,showButtons:o.showButtons,showPaletteOnly:o.showPalette,togglePaletteOnly:o.showPalette,togglePaletteMoreText:y("More"),togglePaletteLessText:y("Less"),color:o.value||o.defaultColor,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]]}),this.updateInvalid(),this}});var a=_.KeyCodeControlFormatter=function(){};return C.extend(a.prototype,{fromRaw:function(e){return e.char},toRaw:void 0}),_.KeyCodeControl=_.InputControl.extend({defaults:C.defaults({escapeKeyCodes:[16,17,18,27]},_.InputControl.prototype.defaults),events:{"keydown input":"onkeyDown","keyup input":"preventEvent","focus select":"clearInvalid"},formatter:a,preventEvent:function(e){var t=e.which||e.keyCode;-1==C.defaults(this.field.toJSON(),this.defaults).escapeKeyCodes.indexOf(t)&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation())},template:C.template(['<label class="<%=Backform.controlLabelClassName%> keyboard-shortcut-label"><%=label%></label>','<div class="<%=Backform.controlsClassName%>">','  <input type="<%=type%>" class="<%=Backform.controlClassName%> <%=extraClasses.join(\' \')%>" name="<%=name%>" oncopy="return false; oncut="return false; onpaste="return false;" maxlength="<%=maxlength%>" value="<%-value%>" placeholder="<%-placeholder%>" <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"  <% if (helpMessage && helpMessage.length) { %>",'    <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>',"  <% } %>","</div>"].join("\n")),onkeyDown:function(e){var t,i,n=this,s=this.model,a=this.field.get("name").split(".").shift(),l=e.which||e.keyCode;-1==C.defaults(this.field.toJSON(),this.defaults).escapeKeyCodes.indexOf(l)&&(this.model.errorModel instanceof o.Model&&this.model.errorModel.unset(a),i=y(e.key),32==l&&(i=y("Space")),t={key_code:e.which||e.keyCode,char:i},this.stopListening(this.model,"change:"+a,this.render),s.set(a,t),this.listenTo(this.model,"change:"+a,this.render),setTimeout(function(){n.$el.find("input").val(i)}),e.preventDefault())},keyPathAccessor:function(e,t){var i=e;t=t.split(".");for(var n=0;n<t.length;n++){if(C.isNull(i))return null;C.isEmpty(t[n])||C.isUndefined(i[t[n]])||(i=i[t[n]])}return i}}),_.KeyboardShortcutControl=_.Control.extend({initialize:function(){_.Control.prototype.initialize.apply(this,arguments);var e=this.field.get("fields");if(null==e||null==e)throw new ReferenceError('"fields" not found in keyboard shortcut');this.innerModel=new o.Model,this.controls=[]},cleanup:function(){this.stopListening(this.innerModel,"change",this.onInnerModelChange),C.each(this.controls,function(e){e.remove()}),this.controls.length=0},template:C.template(['<label class="<%=Backform.controlLabelClassName%>"><%=label%></label>','<div class="<%=Backform.controlsClassName%> d-flex flex-row">',"</div>"].join("\n")),onInnerModelChange:function(){var e=this.field.get("name"),t=g.extend(!0,{},this.model.get(e));this.stopListening(this.model,"change:"+e,this.render),this.model.set(e,g.extend(!0,t,this.innerModel.toJSON())),this.listenTo(this.model,"change:"+e,this.render)},render:function(){this.cleanup(),this.$el.empty();var n=this,t={},e=C.defaults(this.field.toJSON(),this.defaults),i=n.model.get(e.name),s=e.fields;this.$el.html(n.template(e)).addClass(e.name);var a=g(n.$el.find(".pgadmin-controls"));return C.each(s,function(e){t[e.name]=i[e.name]}),n.innerModel.set(t),n.listenTo(n.innerModel,"change",n.onInnerModelChange),C.each(s,function(e){var t=new _.Field(C.extend({},{id:e.name,name:e.name,control:"checkbox"==e.type?"checkboxWithBox":e.type,label:e.label})),i=new(t.get("control"))({field:t,model:n.innerModel});(i.render(),"checkbox"==e.type)?(i.$el.find("label.control-label").text().trim().length<=0&&i.$el.find("label.control-label").remove(),"alt"==e.name?a.append(g('<div class="pg-el-sm-3 pg-el-12"></div>').append(i.$el)):a.append(g('<div class="pg-el-sm-2 pg-el-12"></div>').append(i.$el))):a.append(g('<div class="pg-el-sm-5 pg-el-12"></div>').append(i.$el));n.controls.push(i)}),n},remove:function(){this.cleanup(),_.Control.prototype.remove.apply(this,arguments)}}),_.CheckboxWithBoxControl=_.CheckboxControl.extend({events:C.extend({},_.CheckboxControl.prototype.events,{"click button":"onButtonClick"}),template:C.template(['<label class="<%=Backform.controlLabelClassName%>"><%=controlLabel%></label>','<div class="<%=Backform.controlContainerClassName%>">','  <button class="btn btn-secondary btn-checkbox">','    <input type="<%=type%>" class="<%=extraClasses.join(\' \')%>" id="<%=id%>" name="<%=name%>" <%=value ? "checked=\'checked\'" : ""%> <%=disabled ? "disabled" : ""%> <%=required ? "required" : ""%> />',"    <%=label%>","  </button>","</div>"].join("\n")),onButtonClick:function(e){if("BUTTON"===e.target.nodeName){var t=this.$el.find("input[type=checkbox]");t.prop("checked",!t.prop("checked"))}}}),_}.apply(s,t))||(n.exports=i)}).call(this,a(3))},14:function(i,n,s){"use strict";(function(p){var e,t;s(16),s(18),s(236),s(4),s(46),s(8),s(6),e=[s(2),s(47),s(0)],void 0===(t=function(d,r,c){r.defaults.transition="zoom",r.defaults.theme.ok="btn btn-primary fa fa-lg fa-check pg-alertify-button",r.defaults.theme.cancel="btn btn-secondary fa fa-lg fa-times pg-alertify-button",r.defaults.theme.input="form-control",r.defaults.closable=!1,r.pgIframeDialog||r.dialog("pgIframeDialog",function(){var s;return{main:function(e){return this.set({pg_msg:e})},setup:function(){return{options:{padding:!1,overflow:!1,closable:!0}}},build:function(){(s=document.createElement("iframe")).src="",s.frameBorder="no",s.width="100%",s.height="100%",this.elements.content.appendChild(s),this.elements.body.style.minHeight=.5*screen.height+"px"},settings:{pg_msg:void 0},settingUpdated:function(e,t,i){switch(e){case"pg_msg":var n=s.contentWindow||s.contentDocument;n.document&&(n=n.document),n.open(),n.write(i),n.close()}},hooks:{onupdate:function(e,t,i){switch(e){case"resizable":i?(this.elements.content.removeAttribute("style"),s&&s.removeAttribute("style")):(this.elements.content.style.minHeight="inherit",s&&(s.style.minHeight="inherit"))}}}}}),r.pgNotifier=function(e,t,i,n){var s=t.responseText,a=t.getResponseHeader("Content-Type");if(0==t.status)s=d("Connection to the server has been lost."),i=d("Connection Lost");else if(a)try{if(0==a.indexOf("application/json")){var l=JSON.parse(s);if("CRYPTKEY_MISSING"==l.info)return void window.pgAdmin.Browser.set_master_password("",function(){n&&"function"==typeof n&&n("CRYPTKEY_SET")});if(null!=l.result&&(!l.errormsg||""==l.errormsg)&&n&&"function"==typeof n)return n(l.result);s=p.escape(l.result)||p.escape(l.errormsg)||"Unknown error"}if(0==a.indexOf("text/html")){var o=i;return"error"===e&&(o='                  <div class="media text-danger text-14">                    <div class="media-body media-middle">                      <div class="alert-text" role="status">'+i+'</div><br/>                      <div class="alert-text">'+d("Click for details.")+"</div>                    </div>                  </div>"),void r.notify(o,e,0,function(){r.pgIframeDialog().show().set({frameless:!1}).set("pg_msg",s)})}}catch(e){r.alert().show().set("message",e.message).set("title","Error").set("closable",!0)}r.alert().show().set("message",s.replace(new RegExp(/\r?\n/,"g"),"<br />")).set("title",i).set("closable",!0)},r.pgRespErrorNotify=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",n=e.getResponseHeader("Content-Type");try{if(0===e.status)t=d("Connection to the server has been lost.");else{if(n&&0<=n.indexOf("application/json")){var s=JSON.parse(e.responseText);t=p.escape(s.result)||p.escape(s.errormsg)||d("Unknown error")}if(0<=n.indexOf("text/html")){var a='                <div class="media text-danger text-14">                  <div class="media-body media-middle">                    <div class="alert-text" role="status">'+d("INTERNAL SERVER ERROR")+'</div><br/>                    <div class="alert-text">'+d("Click for details.")+"</div>                  </div>                </div>";return void r.notify(a,"error",0,function(){r.pgIframeDialog().show().set({frameless:!1}).set("pg_msg",e.responseText)})}}}catch(e){t=e.message}r.error(i+" "+t)};function n(e){e&&(this.pgResizeRecursion=!1),this.pgResizeTimeout||(this.pgResizeTimeout=setTimeout(function(){var e=c(this.elements.dialog),t=e.width(),i="xs";this.pgResizeTimeout=null,t<480&&(i="xs"),480<=t&&(i="sm"),768<=t&&(i="md"),992<=t&&(i="lg"),1200<=t&&(i="xl"),e.attr("el",i)}.bind(this),100))}r.pgDialogBuild=function(){this.set("onshow",function(){this.elements.dialog.classList.add("pg-el-container"),c(this.elements.commands.close).attr("title",d("Close")),c(this.elements.commands.maximize).attr("title",d("Maximize")),n.apply(this,arguments)}),this.set("onresize",function e(t){var i=this;t&&(i.pgResizeRecursion=!0),setTimeout(function(){n.apply(i),i.pgResizeRecursion&&e.apply(i,[!1])},100)}.bind(this,!0)),this.set("onresized",n.bind(this,!0)),this.set("onmaximized",n),this.set("onrestored",n);for(var e=0;e<this.__internal.buttons.length;e++)p.isUndefined(this.__internal.buttons[e].key)&&(this.__internal.buttons[e].key=null)},r.pgHandleItemError=function(e,t,i,n){var a=window.pgAdmin.Browser;if(e&&a){var s=e.getResponseHeader("Content-Type"),l=s&&0==s.indexOf("application/json")&&JSON.parse(e.responseText);if(l&&(503==e.status?"CONNECTION_LOST"==l.info&&"server"in n.info&&0<=l.data.sid&&l.data.sid==n.info.server._id:428==e.status&&l.errormsg&&l.errormsg==d("Connection to the server has been lost."))){n.preHandleConnectionLost&&"function"==typeof n.preHandleConnectionLost&&n.preHandleConnectionLost.apply(this,arguments);var o=a.Nodes.server,r=function(){var n=function(e,t,i){this.args.info.server._id==e&&(a.Events.off("pgadmin:server:connected",n),a.Events.off("pgadmin:server:connect:cancelled",s),this.resp.data.database&&this.resp.data.database!=i.db&&a.Events.trigger("pgadmin:database:connection:lost",this.args.item,this.resp,!0))}.bind(this),s=function(e,t,i){e==this.args.info.server.id&&(a.Events.off("pgadmin:server:connected",n),a.Events.off("pgadmin:server:connect:cancelled",s),a.Events.trigger("pgadmin:database:connect:cancelled",e,this.resp.data.database||i.db,t,i))}.bind(this);a.Events.on("pgadmin:server:connected",n),a.Events.on("pgadmin:server:connect:cancelled",s),a.Events.trigger("pgadmin:server:connection:lost",this.args.item,this.resp)}.bind({resp:l,xhr:e,args:n});return c.ajax({url:o.generate_url(null,"connect",n.info.server,!0,n.info),dataType:"json"}).done(function(e){e.success&&"connected"in e.data&&e.data.connected?a.Events.trigger("pgadmin:database:connection:lost",n.item,l):r()}).fail(function(){r()}),!0}return l&&"CRYPTKEY_MISSING"==l.info&&e.status,!1}};var e=r.success,t=r.error;return p.extend(r,{orig_success:e,orig_error:t}),p.extend(r,{success:function(e,t,i){var n='<div class="d-flex px-3 py-2">\n        <div class="pr-2">\n          <i class="fa fa-check text-success" aria-hidden="true"></i>\n        </div>\n        <div class="text-body" role="status">'.concat(e,"</div>\n      </div>");return r.orig_success(n,t,i)},error:function(e,t,i){var n='<div class="d-flex px-3 py-2">\n        <div class="pr-2">\n          <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>\n        </div>\n        <div class="text-body" role="status">'.concat(e,"</div>\n      </div>");return r.orig_error(n,t,i)},info:function(e,t){var i='<div class="d-flex px-3 py-2">\n        <div class="mr-3">\n          <i class="fa fa-info text-primary" aria-hidden="true"></i>\n        </div>\n        <div class="text-body" role="status">'.concat(e,"</div>\n      </div>");return r.notify(i,t)}}),r.confirm().set({onshow:function(){c(this.elements.commands.close).attr("title",d("Close")),c(this.elements.commands.maximize).attr("title",d("Maximize")),c(this.elements.content).addClass("ajs-wrap-text")},reverseButtons:!0}),r.prompt().set({reverseButtons:!0}),c("body").off("keyup").on("keyup",function(e){if(13===e.which||27===e.which)for(var t=["select2-selection","select2-search__field"],i=c(e.target),n=0;n<t.length;n++)if(i.hasClass(t[n])){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();break}}),r}.apply(n,e))||(i.exports=t)}).call(this,s(1))},20:function(e,t,i){"use strict";var n,s;i(10),i(16),i(23),i(50),i(30),i(18),i(6),i(31),n=[i(2),i(0),i(1),i(3),i(15),i(47),i(68),i(56),i(152),i(13),i(28),i(80),i(153)],void 0===(s=function(v,b,y,C,e,_,w,x,l){var k=C.Browser=C.Browser||{};return k.Collection||(k.Collection=function(){},y.extend(k.Collection,y.clone(k.Node),{Init:function(){this.node_initialized||(this.node_initialized=!0,C.Browser.add_menus([{name:"refresh",node:this.type,module:this,applies:["object","context"],callback:"refresh",priority:1,label:v("Refresh..."),icon:"fa fa-refresh"}]),C.DataGrid&&C.unsupported_nodes&&-1==y.indexOf(C.unsupported_nodes,this.type)&&C.Browser.add_menus([{name:"show_query_tool",node:this.type,module:this,applies:["context"],callback:"show_query_tool",priority:998,label:v("Query Tool..."),icon:"pg-font-icon icon-query-tool"}]))},hasId:!1,is_collection:!0,collection_node:!0,hasCollectiveStatistics:!0,canDrop:!0,canDropCascade:!0,showProperties:function(n,e,t){var a=this,s=t.$container.find(".obj_properties").first(),i=s.data("obj-view"),l=b("<div></div>").addClass("pg-prop-content col-12 has-pg-prop-btn-group"),o=k.Nodes[a.node],r="",d=this.generate_url(n,"properties",e),c=this.getTreeNodeHierarchy.apply(this,[n]),p=w.generateGridColumnsFromModel(c,o.model,"properties",a.columns),u=function(e,t,i){if(e&&y.isArray(e)&&0<e.length){var n=b('<div class="pg-prop-btn-group"></div>'),s=y.template(['<button tabindex="0" type="<%= type %>" ',"class=\"btn <%=extraClasses.join(' ')%>\"",'<% if (disabled) { %> disabled="disabled"<% } %> title="<%-tooltip%>">','<span class="<%= icon %>"></span><% if (label != "") { %>&nbsp;<%-label%><% } %></button>'].join(" "));return"header"==t?n.appendTo(a.header):n.appendTo(a.footer),i&&n.addClass(i),y.each(e,function(e){e.icon||(e.icon="");var t=b(s(e));n.append(t),e.register(t)}),n}return null}.bind(t);a.collection=new(o.Collection.extend({url:d,model:o.model})),((y.isFunction(a.canDrop)?a.canDrop.apply(a,[e,n]):a.canDrop)||(y.isFunction(a.canDropCascade)?a.canDropCascade.apply(a,[e,n]):a.canDropCascade))&&p.columns.unshift({name:"oid",cell:x.Extension.SelectRowCell.extend({initialize:function(e){this.column=e.column,this.column instanceof x.Column||(this.column=new x.Column(this.column));var t=this.column,i=this.model,n=this.$el;this.listenTo(t,"change:renderable",function(e,t){n.toggleClass("renderable",t)}),x.callByNeed(t.renderable(),t,i)&&n.addClass("renderable width_percent_3"),this.listenTo(i,"backgrid:select",this.toggleCheckbox)},toggleCheckbox:function(e,t){!1===this.checkbox().prop("disabled")&&this.checkbox().prop("checked",t).change()},render:function(){var e=this.model.toJSON();return"canDrop"in e&&!1===e.canDrop?this.$el.empty().append('<input tabindex="-1" type="checkbox" disabled="disabled"/>'):this.$el.empty().append('<input tabindex="-1" type="checkbox" />'),this.delegateEvents(),this}}),headerCell:x.Extension.SelectAllHeaderCell}),a.grid=new x.Grid({emptyText:"No data found",columns:p.columns,collection:a.collection,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});var h={remove:function(){this.grid&&(this.grid.collection&&(this.grid.collection.reset([],{silent:!0}),delete this.grid.collection),delete this.grid,this.grid=null)},grid:a.grid};if(i){if(y.isEqual(b(t).data("node-prop"),d))return;b(t).data("node-prop",d),s.data("obj-view",null)}s.empty(),s.data("obj-view",h),r='<div class="alert alert-info pg-panel-message pg-panel-properties-message">'+v("Retrieving data from the server...")+"</div>",r=b(r).appendTo(s),a.header=b("<div></div>").addClass("pg-prop-header");var f,m=[];m.push({label:"",type:"delete",tooltip:v("Delete/Drop"),extraClasses:["btn-secondary m-1","delete_multiple"],icon:"fa fa-lg fa-trash-o",disabled:y.isFunction(a.canDrop)?!a.canDrop.apply(self,[e,n]):!a.canDrop,register:function(e){e.on("click",function(){g("drop")})}}),m.push({label:"",type:"delete",tooltip:v("Drop Cascade"),extraClasses:["btn-secondary m-1","delete_multiple_cascade"],icon:"pg-font-icon icon-drop-cascade",disabled:y.isFunction(a.canDropCascade)?!a.canDropCascade.apply(self,[e,n]):!a.canDropCascade,register:function(e){e.on("click",function(){g("dropCascade")})}}),u(m,"header","pg-prop-btn-group-above"),l.append('<div class="pg-prop-coll-container"></div>'),l.find(".pg-prop-coll-container").append(a.grid.render().$el);!function i(){b.ajax({url:d,type:"GET",beforeSend:function(e){e.setRequestHeader(C.csrf_token_header,C.csrf_token),f=setTimeout(function(){r.text(v("Retrieving data from the server...")),r.removeClass("d-none"),self.grid&&self.grid.remove()},1e3)}}).done(function(e){clearTimeout(f),y.isUndefined(a.grid)||y.isNull(a.grid)||(a.data=e,0<a.data.length?(r.hasClass("d-none")||r.addClass("d-none"),a.header.appendTo(s),s.append(l),b(".pg-prop-content").on("scroll",a.__loadMoreRows.bind(a)),a.collection.reset(a.data.splice(0,50))):(b(".pg-prop-content").off("scroll",a.__loadMoreRows),r.text(v("No properties are available for the selected object."))))}).fail(function(e,t){k.Events.trigger("pgadmin:node:retrieval:error","properties",e,t.message,n,a),_.pgHandleItemError(e,t.message,{item:n,info:c})||_.pgNotifier(t,e,v("Error retrieving properties - %s",t.message||a.label),function(e){"CRYPTKEY_SET"===e?i():console.warn(arguments)}),r.text(v("Failed to retrieve data from the server."))})}();var g=function(i){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],t=this.grid.getSelectedModels(),n=[],s=k.tree.selected(),a=s?k.tree.itemData(s):null,l=k.Nodes[a._type],o=void 0,r=void 0,d=void 0;if(y.each(t,function(e){n.push(e.id)}),0!==n.length){d="dropCascade"===i?(o=l.generate_url(s,"delete"),r=v("Are you sure you want to drop all the selected objects and all the objects that depend on them?"),v("DROP CASCADE multiple objects?")):(o=l.generate_url(s,"drop"),r=v("Are you sure you want to drop all the selected objects?"),v("DROP multiple objects?"));var c=function(){b.ajax({url:o,type:"DELETE",data:JSON.stringify({ids:n}),contentType:"application/json; charset=utf-8"}).done(function(e){return 0==e.success?k.report_error(e.errormsg,e.info):(b(k.panels.properties.panel).removeData("node-prop"),k.Events.trigger("pgadmin:browser:tree:refresh",s||k.tree.selected(),{success:function(){l.callbacks.selected.apply(l,[s])}})),!0}).fail(function(e,t){_.pgNotifier(t,e,v("Error dropping %s",a._label.toLowerCase()),function(e){"CRYPTKEY_SET"==e?g(i,!1):(b(k.panels.properties.panel).removeData("node-prop"),k.Events.trigger("pgadmin:browser:tree:refresh",s||k.tree.selected(),{success:function(){l.callbacks.selected.apply(l,[s])}}))})})};e?_.confirm(d,r,c,null).show():c()}else _.alert(v("Drop Multiple"),v("Please select at least one object to delete."))}.bind(a)},__loadMoreRows:function(e){var t=e.currentTarget;t.scrollHeight-10<t.scrollTop+t.offsetHeight&&0<this.data.length&&this.collection.add(this.data.splice(0,50))},generate_url:function(e,t){var i={properties:"obj",children:"nodes",drop:"obj"},n=this,s=this.getTreeNodeHierarchy(e),a=t in i?i[t]:t;return l.generate_url(C.Browser.URL,s,a,n.node,function(e,t){return t!=n.type})}})),k.Collection}.apply(t,n))||(e.exports=s)},253:function(e,t,i){"use strict";var n,s;function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i(21),i(26),i(27),i(10),i(16),i(19),i(23),i(95),i(18),i(11),i(12),i(24),i(22),n=[i(1),i(3),i(0),i(25)],void 0===(s=function(y,C,h,n){C.Browser=C.Browser||{};var _=C.Browser.MenuItem=function(e){y.extend(this,{url:"#",target:"_self",enable:!0},y.pick(e,["name","label","priority","module","callback","data","enable","category","target","url","node","checked","menu_items"]))};y.extend(C.Browser.MenuItem.prototype,{$el:null,generate:function(e,t){return this.create_el(e,t),this.context={name:this.label,disabled:this.is_disabled,callback:this.context_menu_callback.bind(this,t)},this.$el},create_el:function(t,i){if(this.menu_items){y.each(this.menu_items,function(e){e.generate(t,i)});var e=C.Browser.MenuGroup({label:this.label,id:this.name},this.menu_items);this.$el=e.$el}else{var n=h("<a></a>",{id:this.name,href:this.url,target:this.target,"data-toggle":"pg-menu",role:"menuitem"}).data("pgMenu",{module:this.module||C.Browser,cb:this.callback,data:this.data}).addClass("dropdown-item");this.is_disabled=this.disabled(t,i),this.icon?n.append(h("<i></i>",{class:this.icon})):y.isUndefined(this.checked)||n.append(h("<i></i>",{class:"fa fa-check "+(this.checked?"":"visibility-hidden")})),n.addClass(this.is_disabled?" disabled":"");var s=h('<span data-test="menu-item-text"></span>').text("  "+this.label);n.append(s),this.$el=h("<li/>").append(n)}},update:function(e,t){this.$el&&!this.$el.find(".dropdown-item").hasClass("disabled")&&this.$el.find(".dropdown-item").addClass("disabled"),this.is_disabled=this.disabled(e,t),this.$el&&!this.is_disabled&&this.$el.find(".dropdown-item").removeClass("disabled"),this.context={name:this.label,disabled:this.is_disabled,callback:this.context_menu_callback.bind(this,t)}},context_menu_callback:function(e){var t,i=this;i.module.callbacks&&i.callback in i.module.callbacks?t=i.module.callbacks[i.callback]:i.callback in i.module&&(t=i.module[i.callback]),t?t.apply(i.module,[i.data,e]):C.Browser.report_error(n.sprintf('Developer Warning: Callback - "%s" not found!',i.cb))},disabled:function(e,t){if(null==this.enable)return!1;if(this.node){if(!e)return!0;if(y.isArray(this.node)?-1==y.indexOf(this.node,e):this.node!=e._type)return!0}return y.isBoolean(this.enable)?!this.enable:y.isFunction(this.enable)?!this.enable.apply(this.module,[e,t,this.data]):this.module&&y.isBoolean(this.module[this.enable])?!this.module[this.enable]:!(!this.module||!y.isFunction(this.module[this.enable]))&&!this.module[this.enable].apply(this.module,[e,t,this.data])},change_checked:function(e){y.isUndefined(this.checked)||(this.checked=e,this.checked?this.$el.find(".fa-check").removeClass("visibility-hidden"):this.$el.find(".fa-check").addClass("visibility-hidden"))}}),C.Browser.MenuGroup=function(e,t,i,n){var s,a=y.template(['<% if (above) { %><li class="dropdown-divider"></li><% } %>','<li class="dropdown-submenu">',' <a href="#" class="dropdown-item">','  <% if (icon) { %><i class="<%= icon %>"></i><% } %>',"  <span><%= label %></span>"," </a>",' <ul class="dropdown-menu">'," </ul>","</li>",'<% if (below) { %><li class="dropdown-divider"></li><% } %>'].join("\n")),l={label:e.label,icon:e.icon,above:e.above&&!i,below:e.below},o=h(a(l)),r=o.find(".dropdown-menu"),d={},c=1;for(var p in n=y.uniqueId(n+"_sub_"),t.sort(function(e,t){return e.label.localeCompare(t.label)}),t.sort(function(e,t){return e.priority-t.priority}),t)s=t[p],r.append(s.$el),s.is_disabled||(d[n+c]=s.context),c++;var u=0==y.size(d);return{$el:o,priority:e.priority||10,label:e.label,above:l.above,below:e.below,is_disabled:u,context:{name:e.label,icon:e.icon,items:d,disabled:u}}},C.Browser.MenuCreator=function(e,t,i,n,s,a){function l(e){if(e instanceof _)e.$el&&(e.$el.remove(),delete e.$el),e.generate(n,s),(r[e.category||"common"]=r[e.category||"common"]||[]).push(e);else for(var t in e)l(e[t])}var o,r={common:[]},d=0,c=y.uniqueId("ctx_"),p=1;for(d in t)l(t[d]);a=a||{},o=r.common,delete r.common;var u=!0;for(var h in r){var f=r[h],m=i[h]||{label:h,single:!1},g=C.Browser.MenuGroup(m,f,u,c);if(f.length<=1&&!m.single)for(d in u=!1,f)o.push(f[d]);else u=f.below,o.push(g)}o.sort(function(e,t){return e.label.localeCompare(t.label)}),o.sort(function(e,t){return e.priority-t.priority});var v=y.size(o);for(d in o){(s=o[d]).priority=s.priority||10,e.append(s.$el);var b=c+"_"+s.priority+"_"+p;1!=p&&s.above&&!s.is_disabled&&(a[b+"_ma"]="----"),s.is_disabled||(a[b+"_ms"]=s.context),c!=v&&s.below&&!s.is_disabled&&(a[b+"_mz"]="----"),p++}return 0<v};function a(e,t){this.$element=h(e),this.options=h.extend({},a.DEFAULTS,t),this.isLoading=!1}function i(n,s){return this.each(function(){var e=h(this),t=e.data("pg.menu"),i="object"==l(n)&&n;t||e.data("pg.menu",t=new a(this,i)),t.toggle(s)})}a.DEFAULTS={},a.prototype.toggle=function(e){if(this.$element.closest(".dropdown-item").hasClass("disabled"))return e.preventDefault(),!1;var t=this.$element.data("pgMenu");if(t.cb){var i=t.module&&t.module.callbacks&&t.module.callbacks[t.cb]||t.module&&t.module[t.cb];i?(i.apply(t.module,[t.data,C.Browser.tree.selected()]),e.preventDefault()):C.Browser.report_error('Developer Warning: Callback - "'+t.cb+'" not found!')}};var e=h.fn.button;return h.fn.pgmenu=i,h.fn.pgmenu.Constructor=a,h.fn.pgmenu.noConflict=function(){return h.fn.pgmenu=e,this},h(document).on("click.pg.menu.data-api",'[data-toggle^="pg-menu"]',function(e){var t=h(e.target);t.hasClass("dropdown-item")||(t=t.closest(".dropdown-item")),i.call(t,"toggle",e)}).on("focus.pg.menu.data-api blur.pg.menu.data-api",'[data-toggle^="pg-menu"]',function(e){h(e.target).closest(".menu").toggleClass("focus",/^focus(in)?$/.test(e.type))}).on("mouseenter",".dropdown-submenu",function(e){h(e.currentTarget).removeClass("dropdown-submenu-visible").addClass("dropdown-submenu-visible"),h(e.currentTarget).find(".dropdown-menu").first().addClass("show")}).on("mouseleave",".dropdown-submenu",function(e){h(e.currentTarget).removeClass("dropdown-submenu-visible"),h(e.currentTarget).find(".dropdown-menu").first().removeClass("show")}).on("hidden.bs.dropdown",function(e){h(e.target).find(".dropdown-submenu.dropdown-submenu-visible").removeClass("dropdown-submenu-visible").find(".dropdown-menu.show").removeClass("show")}),C.Browser.MenuItem}.apply(t,n))||(e.exports=s)},254:function(e,t,i){"use strict";var n,s;i(18),i(11),i(6),n=[i(1),i(3),i(0),i(59)],void 0===(s=function(s,e,a){var l=e.Browser=e.Browser||{},o=window.wcDocker,r=window.wcIFrame;return e.Browser.Frame=function(e){s.extend(this,s.pick(e,["name","title","width","height","showTitle","isCloseable","isPrivate","url","icon","onCreate"]))},s.extend(e.Browser.Frame.prototype,{name:"",title:"",width:300,height:600,showTitle:!0,isClosable:!0,isPrivate:!1,url:"",icon:"",panel:null,frame:null,onCreate:null,load:function(e){var n=this;n.panel||e.registerPanelType(this.name,{title:n.title,isPrivate:n.isPrivate,onCreate:function(i){a(i).data("pgAdminName",n.name),i.initSize(n.width,n.height),0==i.showTitle&&i.title(!1),i.icon(n.icon),i.closeable(!!n.isCloseable);var e=a('<div style="position:absolute;top:0 !important;width:100%;height:100%;display:table;z-index:0;">');i.layout().addItem(e),n.panel=i;var t=new r(e,i);a(i).data("frameInitialized",!1),a(i).data("embeddedFrame",t),""!=n.url&&"about:blank"!=n.url?setTimeout(function(){t.openURL(n.url),a(i).data("frameInitialized",!0),l.Events.trigger("pgadmin-browser:frame:urlloaded:"+n.name,t,n.url,self)},50):(t.openURL("about:blank"),a(i).data("frameInitialized",!0),l.Events.trigger("pgadmin-browser:frame:urlloaded:"+n.name,t,n.url,self)),n.events&&s.isObject(n.events)&&s.each(n.events,function(e,t){e&&s.isFunction(e)&&i.on(t,e)}),s.each([o.EVENT.UPDATED,o.EVENT.VISIBILITY_CHANGED,o.EVENT.BEGIN_DOCK,o.EVENT.END_DOCK,o.EVENT.GAIN_FOCUS,o.EVENT.LOST_FOCUS,o.EVENT.CLOSED,o.EVENT.BUTTON,o.EVENT.ATTACHED,o.EVENT.DETACHED,o.EVENT.MOVE_STARTED,o.EVENT.MOVE_ENDED,o.EVENT.MOVED,o.EVENT.RESIZE_STARTED,o.EVENT.RESIZE_ENDED,o.EVENT.RESIZED,o.EVENT.SCROLLED],function(e){i.on(e,n.eventFunc.bind(i,e))}),n.onCreate&&s.isFunction(n.onCreate)&&n.onCreate.apply(n,[i,t])}})},eventFunc:function(e){var t=a(this).data("pgAdminName");try{l.Events.trigger("pgadmin-browser:frame",e,this,arguments),l.Events.trigger("pgadmin-browser:frame:"+e,this,arguments),t&&(l.Events.trigger("pgadmin-browser:frame-"+t,e,this,arguments),l.Events.trigger("pgadmin-browser:frame-"+t+":"+e,this,arguments))}catch(e){console.warn(e.stack||e)}}}),e.Browser.Frame}.apply(t,n))||(e.exports=s)},256:function(e,t,i){"use strict";var n,s;i(257),i(258),n=[i(2),i(5),i(0),i(1),i(3),i(14)],void 0===(s=function(e,t,i,n,s,a){return(s=s||window.pgAdmin||{}).FileManager||(s.FileManager={init:function(){this.initialized||(this.initialized=!0)},show_dialog:function(e){"create_file"==e.dialog_type?a.createModeDlg(e).resizeTo(s.Browser.stdW.md,s.Browser.stdH.lg):a.fileSelectionDlg(e).resizeTo(s.Browser.stdW.md,s.Browser.stdH.lg)}}),s.FileManager}.apply(t,n))||(e.exports=s)},273:function(e,t,i){"use strict";var n,s;i(10),i(16),i(23),i(117),i(30),i(11),i(79),i(37),i(4),i(8),i(6),i(31),n=[i(2),i(1),i(0),i(15),i(68),i(56),i(47),i(3),i(80),i(106)],void 0===(s=function(t,d,c,i,s,r,e,n,a){var p=r.Row.extend({modelDuplicateClass:"bg-model-duplicate",initialize:function(){r.Row.prototype.initialize.apply(this,arguments);var n=this;n.model.on("change:name",function(){setTimeout(function(){n.columns.each(function(e){if("value"==e.get("name")){n.model.set({value:void 0},{silent:!0});var t=n.columns.indexOf(e),i=new(e.get("cellFunction").apply(e,[n.model]))({column:e,model:n.model});n.cells[t].remove(),n.cells[t]=i,n.render()}})},10)}),n.listenTo(n.model,"pgadmin-session:model:duplicate",n.modelDuplicate),n.listenTo(n.model,"pgadmin-session:model:unique",n.modelUnique)},modelDuplicate:function(){c(this.el).removeClass("new"),c(this.el).addClass(this.modelDuplicateClass)},modelUnique:function(){c(this.el).removeClass(this.modelDuplicateClass)}}),l=a.VariableModel=a.Model.extend({keys:["name"],defaults:{name:void 0,value:void 0,role:null,database:null},schema:[{id:"name",label:t("Name"),type:"text",cellHeaderClasses:"width_percent_30",editable:function(e){return e instanceof i.Collection||e.isNew()},cell:r.Extension.NodeAjaxOptionsCell.extend({initialize:function(){r.Extension.NodeAjaxOptionsCell.prototype.initialize.apply(this,arguments);var e=d.clone(this.optionValues||(d.isFunction(this.column.get("options"))?this.column.get("options")(this):this.column.get("options")));this.column.set("options",e)}}),url:"vopts",select2:{allowClear:!1},transform:function(e,t){var i=[],n={};return d.each(e,function(e){i.push({value:e.name,image:void 0,label:e.name}),n[e.name]=e}),t.column.set("availVariables",n),i}},{id:"value",label:t("Value"),type:"text",editable:!0,cellFunction:function(e){var t=e.get("name"),i={};this.collection.each(function(e){"name"==e.get("name")&&(i=e.get("availVariables"))});var n=t?i[t]:void 0,s=e.get("value");switch(n&&n.vartype){case"bool":return e.set("value",!!e.get("value"),{silent:!0}),r.Extension.SwitchCell;case"enum":e.set({value:s},{silent:!0});var a=[],l=n.enumvals;return d.each(l,function(e){a.push([e,e])}),r.Extension.Select2Cell.extend({optionValues:a});case"integer":return d.isNaN(parseInt(s))?e.set({value:void 0},{silent:!0}):e.set({value:parseInt(s)},{silent:!0}),r.IntegerCell;case"real":return d.isNaN(parseFloat(s))?e.set({value:void 0},{silent:!0}):e.set({value:parseFloat(s)},{silent:!0}),r.NumberCell.extend({decimals:0});case"string":return r.StringCell;default:return e.set({value:void 0},{silent:!0}),r.Cell}},cellHeaderClasses:"width_percent_40"},{id:"database",label:t("Database"),type:"text",editable:!0,node:"database",cell:r.Extension.NodeListByNameCell},{id:"role",label:t("Role"),type:"text",editable:!0,node:"role",cell:r.Extension.NodeListByNameCell}],toJSON:function(){var e=i.Model.prototype.toJSON.apply(this);return(d.isUndefined(e.database)||d.isNull(e.database))&&delete e.database,(d.isUndefined(e.role)||d.isNull(e.role))&&delete e.role,e},validate:function(){var e=null;return d.isUndefined(this.get("name"))||d.isNull(this.get("name"))||""==String(this.get("name")).replace(/^\s+|\s+$/g,"")?(e=t("Please select a parameter name."),this.errorModel.set("name",e)):d.isUndefined(this.get("value"))||d.isNull(this.get("value"))||""==String(this.get("value")).replace(/^\s+|\s+$/g,"")?(e="Please enter a value for the parameter.",this.errorModel.set("value",e),this.errorModel.unset("name")):(this.errorModel.unset("name"),this.errorModel.unset("value")),e}});return s.VariableCollectionControl=s.UniqueColCollectionControl.extend({hasDatabase:!1,hasRole:!1,initialize:function(e){var t=this,i=["name"];t.hasDatabase=e.field.get("hasDatabase"),t.hasRole=e.field.get("hasRole"),t.hasDatabase?i.push("database"):t.hasRole&&i.push("role"),e&&e.field&&(e.field instanceof s.Field?e.field.set({model:a.VariableModel.extend({keys:i})},{silent:!0}):e.field.extend({model:a.VariableModel.extend({keys:i})})),s.UniqueColCollectionControl.prototype.initialize.apply(t,arguments),t.availVariables={};var n=["name","value"];t.hasDatabase&&n.push("database"),t.hasRole&&n.push("role"),t.gridSchema=s.generateGridColumnsFromModel(t.field.get("node_info"),l.extend({keys:i}),"edit",n,t.field.get("schema_node")),t.getVariables()},getVariables:function(){var e=this,t=this.field.get("url"),i=e.model;if(this.field.get("version_compatible")&&t&&!i.isNew()){var n,s=e.field.get("node"),a=e.field.get("node_data"),l=e.field.get("node_info"),o=s.generate_url.apply(s,[null,t,a,!0,l]),r=e.collection.trackChanges;r&&e.collection.stopSession(),i.trigger("pgadmin-view:fetching",i,e.field),c.ajax({async:!1,url:o}).done(function(e){n=e.data}).fail(function(){i.trigger("pgadmin-view:fetch:error",i,e.field)}),i.trigger("pgadmin-view:fetched",i,e.field),n&&d.isArray(n)&&e.collection.reset(n,{silent:!0}),r&&e.collection.startNewSession()}},showGridControl:function(a){var l=this,e=d.template(["<div class='subnode-header'>","<label class='control-label'><%-label%></label>","<button class='btn btn-sm-sq btn-secondary add fa fa-plus' title='"+d("Add new row")+"' <%=canAdd ? '' : 'disabled=\"disabled\"'%>></button>","</div>"].join("\n")),t=c("<div class='pgadmin-control-group backgrid form-group col-12 object subnode'></div>").append(e(a));l.grid&&l.grid.remove();var i=d.clone(this.gridSchema);d.each(i.columns,function(e){"value"==e.name&&(e.availVariables=l.availVariables)}),0==a.disabled&&a.canDelete&&i.columns.unshift({name:"pg-backform-delete width_percent_5",label:"",cell:r.Extension.DeleteCell,editable:!1,cell_priority:-1}),l.collection.each(function(e){var t,i=e.get("name");if(i in l.availVariables)switch(l.availVariables[i].vartype){case"real":t=parseFloat(e.get("value")),e.set("value",isNaN(t)?void 0:t,{silent:!0});break;case"integer":t=parseInt(e.get("value")),e.set("value",isNaN(t)?void 0:t,{silent:!0})}});var o=l.grid=new r.Grid({columns:i.columns,collection:l.collection,row:p,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});return l.$grid=o.render().$el,t.append(l.$grid),a.disabled||0==a.canAdd||t.find("button.add").first().on("click",function(e){if(e.preventDefault(),!d.isFunction(a.canAddRow)||a.canAddRow.apply(l,[l.model])){if(!!!l.field.get("allowMultipleEmptyRows")&&l.collection){var i=!1;if(l.collection.each(function(e){var t=[];d.each(e.attributes,function(e){t.push(e)}),d.some(t,d.identity)||(i=!0)}),i)return!1}c(o.body.$el.find(c("tr.new"))).removeClass("new");var t=new a.model(null,{silent:!0,handler:l.collection,top:l.model.top||l.model,collection:l.collection,node_info:l.model.node_info});l.collection.add(t);var n=l.collection.indexOf(t),s=o.body.rows[n].$el;return s.addClass("new"),c(s).pgMakeVisible("backform-tab"),!1}}),t},addVariable:function(e){e.preventDefault();var t=this,i=new(t.field.get("model"))(t.headerData.toJSON(),{silent:!0,top:t.collection.top,handler:t.collection}),n=t.model.get(t.field.get("name"));n.add(i);var s=n.indexOf(i);if(-1<s){t.$grid.find(".new").removeClass("new");var a=t.grid.body.rows[s].$el;a.addClass("new"),c(a).pgMakeVisible("backform-tab")}return!1}}),l}.apply(t,n))||(e.exports=s)},28:function(n,s,a){"use strict";(function(e,E){var t,i;a(10),a(16),a(19),a(23),a(40),a(95),a(30),a(18),a(341),a(12),a(79),a(37),a(4),a(8),a(65),a(29),a(87),a(22),a(6),a(31),t=[a(2),a(1),a(0),a(15),a(68),a(56),a(47),a(118),a(344),a(25),a(74),a(345),a(144),a(184)],void 0===(i=function(o,f,m,l,r,g,s,i,p,n,d){var c=(window.pgAdmin=window.pgAdmin||{}).Browser;f.extend(g.Column.prototype.defaults,{cellFunction:void 0}),f.extend(g.Cell.prototype.events,{mouseover:function(){var e=m(this.el);0<e.text().length&&!e.attr("title")&&e.innerWidth()+1<e[0].scrollWidth&&e.attr("title",m.trim(e.text()))}}),f.extend(g.InputCellEditor.prototype.events,{keydown:function(e){var t=c.get_preferences_for_module("browser");d.validateShortcutKeys(t.add_grid_row,e)?c.keyboardNavigation.bindAddGridRow():g.InputCellEditor.prototype.saveOrCancel.apply(this,arguments)}}),f.extend(g.Body.prototype,{sort:function(e,t){if(!f.contains(["ascending","descending",null],t))throw new RangeError('direction must be one of "ascending", "descending" or `null`');f.isString(e)&&(e=this.columns.findWhere({name:e}));var i,n=this.collection;i="ascending"===t?-1:"descending"===t?1:null;var s=e.get("cell").prototype.className||"string-cell",a=this.makeComparator(e.get("name"),i,i?e.sortValue():function(e){return 1*e.cid.replace("c","")},s);return l.PageableCollection&&n instanceof l.PageableCollection?(n.setSorting(i&&e.get("name"),i,{sortValue:e.sortValue()}),n.fullCollection?(null==n.fullCollection.comparator&&(n.fullCollection.comparator=a),n.fullCollection.sort(),n.trigger("backgrid:sorted",e,t,n)):n.fetch({reset:!0,success:function(){n.trigger("backgrid:sorted",e,t,n)}})):(n.comparator=a,n.sort(),n.trigger("backgrid:sorted",e,t,n)),e.set("direction",t),this},makeComparator:function(o,r,d,c){return function(e,t){var i,n=d(e,o),s=d(t,o);if(!f.isUndefined(n)&&!f.isUndefined(s)){if(f.include(["number-cell","integer-cell"],c)){var a,l;try{a=new p(n)}catch(e){a=NaN}try{l=new p(s)}catch(e){l=NaN}return 1===r&&(i=a,a=l,l=i),a.eq(l)?0:a.lt(l)?-1:1}return 1===r&&(i=n,n=s,s=i),n===s?0:null===n&&null!=s?-1:null!=n&&null===s?1:n<s?-1:1}}},moveToNextCell:function(e,t,i){var n,s,a,l,o,r=this.collection.indexOf(e),d=this.columns.indexOf(t);if(-1===d)return this;if(this.rows[r].cells[d].exitEditMode(),i.moveUp()||i.moveDown()||i.moveLeft()||i.moveRight()||i.save()){var c=this.columns.length,p=c*this.collection.length;if(i.moveUp()||i.moveDown()){l=r+(i.moveUp()?-1:1);var u=this.rows[l];u?(n=u.cells[d],g.callByNeed(n.column.editable(),n.column,e)&&(n.enterEditMode(),e.trigger("backgrid:next",l,d,!1))):e.trigger("backgrid:next",l,d,!0)}else if(i.moveLeft()||i.moveRight()){for(var h=i.moveRight(),f=r*c+d+(h?1:-1);0<=f&&f<p;h?f++:f--){if(o=f-(l=~~(f/c))*c,n=this.rows[l].cells[o],s=g.callByNeed(n.column.renderable(),n.column,n.model),a=g.callByNeed(n.column.editable(),n.column,e),n&&n.$el.hasClass("edit-cell")&&!n.$el.hasClass("privileges")||n.$el.hasClass("delete-cell")){e.trigger("backgrid:next",l,o,!1),n.$el.hasClass("delete-cell")&&setTimeout(function(){m(n.$el).trigger("focus")},50);break}if(s&&a){n.enterEditMode(),e.trigger("backgrid:next",l,o,!1);break}}f==p&&e.trigger("backgrid:next",~~(f/c),f-l*c,!0)}}return this}}),f.extend(g.Row.prototype,{makeCell:function(e){return new(this.getCell(e))({column:e,model:this.model})},getCell:function(t){var e=t.get("cellFunction");if(!f.isFunction(e))return t.get("cell");var i=e.apply(t,[this.model]);try{return g.resolveNameToClass(i,"Cell")}catch(e){if(e instanceof ReferenceError)return t.get("cell");throw e}}});var e=g.Extension.ObjectCellEditor=g.CellEditor.extend({modalTemplate:f.template(['<div class="subnode-dialog" tabindex="0">','    <div class="subnode-body"></div>',"</div>"].join("\n")),stringTemplate:f.template(['<div class="form-group">','  <label class="control-label col-sm-4"><%=label%></label>','  <div class="col-sm-8">','    <input type="text" class="form-control" name="<%=name%>" value="<%=value%>" placeholder="<%=placeholder%>" />',"  </div>","</div>"].join("\n")),extendWithOptions:function(e){f.extend(this,e)},render:function(){return this},postRender:function(e,t){var i=this.columns_length,n=this.schema.length?this.schema:this.column.get("schema");if(null!=t&&t.get("name")!=this.column.get("name"))return!1;if(!f.isArray(n))throw new TypeError("schema must be an array");var s=this.createDialog(i),a=m('<form class="form-dialog"></form>');s.find("div.subnode-body").append(a);var l=s.find("form.form-dialog");return this.objectView=new r.Dialog({el:l,model:this.model,schema:n,tabPanelClassName:function(){return"sub-node-form col-sm-12"},events:{keydown:function(e){var t=c.get_preferences_for_module("browser");d.validateShortcutKeys(t.add_grid_row,e)&&c.keyboardNavigation.bindAddGridRow()}}}),this.objectView.render(),this},createDialog:function(e){e=e||1;var t=this.$dialog=m(this.modalTemplate({title:""})),i=m('<tr class="nohover editor-row">'),n=m("<td>",{class:"editable sortable renderable",style:"height: auto",colspan:e+2}).appendTo(i);return this.tr=i,n.append(t.css("display","block")),this.el.parent("tr").after(i),t},save:function(){return this.model.trigger("backgrid:edited",this.model,this.column,new g.Command({keyCode:13})),this.tr&&this.tr.remove(),this},remove:function(){return this.objectView.remove(),g.CellEditor.prototype.remove.apply(this,arguments),this.tr&&this.tr.remove(),this}});g.Extension.PGSelectCell=g.SelectCell.extend({optionValues:function(){var t=[],e=f.result(this.column.attributes,"options");return f.each(e,function(e){t.push([e.label,e.value])}),t}}),g.Extension.ObjectCell=g.Cell.extend({editorOptionDefaults:{schema:[]},className:"edit-cell",editor:e,initialize:function(i){g.Cell.prototype.initialize.apply(this,arguments);var n=this,s={};f.each(this.editorOptionDefaults,function(e,t){n[t]||(n[t]=e),i&&i[t]&&(n[t]=i[t]),s[t]=n[t]}),s.el=m(this.el),s.columns_length=this.column.collection.length,s.el.attr("tabindex",0),this.listenTo(this.model,"backgrid:edit",function(e,t,i,n){t.get("name")==this.column.get("name")&&n.extendWithOptions(s)}),this.$el.on("keydown",function(e){32==e.keyCode&&m(this).click()})},enterEditMode:function(){if(!f.isUndefined(this.column.get("canEditRow"))&&f.isFunction(this.column.get("canEditRow"))&&!g.callByNeed(this.column.get("canEditRow"),this.column,this.model))s.alert(o("This object is not user editable."),function(){return!0});else if(this.model.trigger("enteringEditMode",[this]),g.Cell.prototype.enterEditMode.apply(this,arguments),this.delegateEvents(),g.callByNeed(this.column.editable(),this.column,this.model)){this.$el.html("<i class='fa fa-pencil-square subnode-edit-in-process' title='"+f("Edit row")+"'></i>");var e=m(this.$el).parents()[1],t=m(e).find(".tab-content:first > .tab-pane.active:first");n.findAndSetFocus(t),c.keyboardNavigation.getDialogTabNavigator(m(e).find(".subnode-dialog")),this.model.trigger("pg-sub-node:opened",this.model,this)}},render:function(){return this.$el.empty(),this.$el.html("<i class='fa fa-pencil-square-o' title='"+f("Edit row")+"'></i>"),this.delegateEvents(),this.grabFocus&&this.$el.trigger("focus"),this},exitEditMode:function(){if(!f.isUndefined(this.currentEditor)||!f.isEmpty(this.currentEditor)){var e=m(this.currentEditor.objectView.el).find('.nav-tabs > .active > a[data-toggle="tab"]').first().data("tabIndex");g.Cell.prototype.exitEditMode.apply(this,arguments),this.model.trigger("pg-sub-node:closed",this,e),this.grabFocus=!0}},events:{click:function(e){this.$el.find("i").first().hasClass("subnode-edit-in-process")?(this.undelegateEvents(),this.currentEditor.save()):this.enterEditMode.call(this,[]),e.preventDefault()},keydown:function(e){var t=this.model,i=this.column,n=new g.Command(e);n.moveLeft()&&setTimeout(function(){t.trigger("backgrid:edited",t,i,n)},20)}}}),g.Extension.DeleteCell=g.Cell.extend({defaults:f.defaults({defaultDeleteMsg:o("Are you sure you wish to delete this row?"),defaultDeleteTitle:o("Delete Row")},g.Cell.prototype.defaults),className:"delete-cell",events:{click:"deleteRow"},deleteRow:function(e){e.preventDefault();var i=this;if(!(!f.isUndefined(this.column.get("canDeleteRow"))&&f.isFunction(this.column.get("canDeleteRow")))||g.callByNeed(this.column.get("canDeleteRow"),this.column,this.model)){var t=f.isUndefined(this.column.get("customDeleteMsg"))?i.defaults.defaultDeleteMsg:this.column.get("customDeleteMsg"),n=f.isUndefined(this.column.get("customDeleteTitle"))?i.defaults.defaultDeleteTitle:this.column.get("customDeleteTitle");s.confirm(n,t,function(){var e=m(i.el).parents("tbody").eq(0);i.model.collection.remove(i.model);var t=m(e).find("tr");0<t.length?t.first().children()[0].focus():m(e).parents(".subnode").eq(0).find(".add").focus()},function(){return!0})}else s.alert(o("This object cannot be deleted."),function(){return!0})},exitEditMode:function(){this.$el.removeClass("editor")},initialize:function(){g.Cell.prototype.initialize.apply(this,arguments)},render:function(){var n=this;return this.$el.empty(),m(this.$el).attr("tabindex",0),this.$el.html("<i class='fa fa-trash' title='"+f("Delete row")+"'></i>"),this.$el.on("keydown",function(e){var t;if(32==e.keyCode&&n.$el.click(),9!=e.keyCode&&16!=e.keyCode||(t=e.shiftKey?n.$el.prev():n.$el.next()),t){var i=new g.Command({key:"Tab",keyCode:9,which:9,shiftKey:e.shiftKey});setTimeout(function(){t.hasClass("editable")&&(e.preventDefault(),e.stopPropagation()),n.model.trigger("backgrid:edited",n.model,n.column,i)},20)}}),this.delegateEvents(),this}}),g.Extension.CustomHeaderCell=g.HeaderCell.extend({initialize:function(){g.HeaderCell.prototype.initialize.apply(this,arguments);var e=this.column.get("cellHeaderClasses");e&&this.$el.addClass(e)}}),E&&E.fn.bootstrapToggle&&(m.fn.bootstrapToggle=E.fn.bootstrapToggle),g.Extension.SwitchCell=g.BooleanCell.extend({defaults:{options:f.defaults({onText:o("Yes"),offText:o("No"),onColor:"success",offColor:"primary",size:"mini",width:null,height:null},m.fn.bootstrapToggle.defaults)},className:"switch-cell",initialize:function(){g.BooleanCell.prototype.initialize.apply(this,arguments),this.onChange=this.onChange.bind(this)},enterEditMode:function(){this.$el.addClass("editor"),m(this.$el.find("input[type=checkbox]")).trigger("focus")},exitEditMode:function(){this.$el.removeClass("editor")},events:{"change input":"onChange",keyup:"toggleSwitch","blur input":"exitEditMode",keydown:"onKeyDown"},toggleSwitch:function(e){32==e.keyCode&&(this.$el.find("input[type=checkbox]").bootstrapToggle("toggle"),e.preventDefault())},onKeyDown:function(e){var t=c.get_preferences_for_module("browser");d.validateShortcutKeys(t.add_grid_row,e)&&c.keyboardNavigation.bindAddGridRow()},onChange:function(){var e=this.model,t=this.column,i=this.formatter.toRaw(this.$input.prop("checked"),e);this.enterEditMode(),e.set(t.get("name"),i)},render:function(){var n=this,e=f.defaults(this.column.toJSON(),this.defaults),t=this.model,i=this.column,s=this.formatter.fromRaw(t.get(i.get("name")),t),a=g.callByNeed(e.editable,i,t),l=f.defaults({},e.options,this.defaults.options);return this.undelegateEvents(),this.$el.empty(),this.$el.append(m("<input>",{tabIndex:0,type:"checkbox"}).prop("checked",s).prop("disabled",!a).attr("data-toggle","toggle").attr("data-size",l.size).attr("data-on",l.onText).attr("data-off",l.offText).attr("data-width",l.width).attr("data-height",l.height).attr("data-onstyle",l.onColor).attr("data-offstyle",l.offColor)),this.$input=this.$el.find("input[type=checkbox]").first(),this.$input.bootstrapToggle(),this.$el.on("keydown",function(e){var t;if(9==e.keyCode&&(t=e.shiftKey?n.$el.prev():n.$el.next()),t){var i=new g.Command({key:"Tab",keyCode:9,which:9,shiftKey:e.shiftKey});setTimeout(function(){t.hasClass("editable")&&t.hasClass("edit-cell")?(e.preventDefault(),e.stopPropagation(),t.trigger("focus")):t.hasClass("editable")?(e.preventDefault(),e.stopPropagation(),setTimeout(function(){n.model.trigger("backgrid:edited",n.model,n.column,i)},10),t.trigger("focus")):setTimeout(function(){n.model.trigger("backgrid:edited",n.model,n.column,i)},10)},20)}}),this.delegateEvents(),this}}),g.Extension.Select2Cell=g.SelectCell.extend({className:"select2-cell",editor:null,defaults:f.defaults({select2:{},opt:{label:null,value:null,selected:!1}},g.SelectCell.prototype.defaults),enterEditMode:function(){this.$el.hasClass("editor")||this.$el.addClass("editor"),this.$select.select2("focus"),this.$select.select2("open"),this.$select.on("blur",this.exitEditMode)},exitEditMode:function(){this.$select.off("blur",this.exitEditMode),this.$select.select2("close"),this.$el.removeClass("editor")},saveOrCancel:function(e){var t,i=this,n=new g.Command(e),s="blur"===e.type;if((n.moveUp()||n.moveDown()||n.moveLeft()||n.moveRight()||n.save()||s)&&(t=e.shiftKey?i.$el.prev():i.$el.next())){var a=new g.Command({key:"Tab",keyCode:9,which:9,shiftKey:e.shiftKey});setTimeout(function(){t.hasClass("editable")&&(e.preventDefault(),e.stopPropagation()),i.model.trigger("backgrid:edited",i.model,i.column,a)},20)}},events:{"select2:open":"enterEditMode","select2:close":"exitEditMode",change:"onSave","select2:unselect":"onSave",blur:"saveOrCancel",keydown:"saveOrCancel"},template:f.template(['<option value="<%- value %>" ','<%= selected ? \'selected="selected"\' : "" %>>',"<%- label %></option>"].join(""),null,{variable:null}),initialize:function(){g.SelectCell.prototype.initialize.apply(this,arguments),this.onSave=this.onSave.bind(this),this.enterEditMode=this.enterEditMode.bind(this),this.exitEditMode=this.exitEditMode.bind(this)},render:function(){var e=f.defaults(this.column.toJSON(),this.defaults),t=this.model,i=this.column,n=g.callByNeed(e.editable,i,t),s=f.clone(this.optionValues||(f.isFunction(this.column.get("options"))?this.column.get("options")(this):this.column.get("options")));if(this.undelegateEvents(),this.$select&&(this.$select.data("select2")&&this.$select.select2("destroy"),delete this.$select,this.$select=null),this.$el.empty(),!f.isArray(s))throw new TypeError("optionValues must be an array");s.unshift(this.defaults.opt);for(var a=null,l=null,o=this,r=t.get(this.column.get("name")),d=f.extend({openOnEnter:!1,multiple:!1},o.defaults.select2,e.select2||{}),c=f.template('<select <%=multiple ? "multiple" : "" %>></select>'),p=o.$select=m(c({multiple:d.multiple})).appendTo(o.$el),u=0;u<s.length;u++){var h=s[u];f.isArray(h)?(a=h[0],l=h[1],p.append(o.template({label:a,value:l,selected:r==l||d.multiple&&-1<f.indexOf(r,l)}))):(h=f.defaults({},h,{selected:r==h.value||d.multiple&&-1<f.indexOf(r,h.value)},o.defaults.opt),p.append(o.template(h)))}if(e&&f.has(e.disabled)){f.extend(d,{disabled:function(){var e=[];Array.prototype.push.apply(e,arguments);var t=e.shift();return"function"==typeof t?t.apply(o,e):t}(e.disabled,e,t)})}else f.extend(d,{disabled:!n});return this.delegateEvents(),n&&"properties"!==e.mode||(d.placeholder=""),this.$sel=this.$select.select2(d),this.$sel&&this.$sel.data("select2").on("keypress",function(e){9===e.which&&this.isOpen()&&(this.trigger("results:select",{}),e.preventDefault())}),this},onSave:function(){var e=this.model,t=this.column;e.set(t.get("name"),this.$select.val())},remove:function(){this.$select.off("change",this.onSave),this.$select.data("select2")&&this.$select.select2("destroy"),this.$el.empty(),g.SelectCell.prototype.remove.apply(this,arguments)}});var t=g.TextareaCellEditor=g.InputCellEditor.extend({tagName:"textarea",events:{blur:"saveOrCancel",keydown:""}});g.Extension.TextareaCell=g.Cell.extend({className:"textarea-cell",editor:t}),g.Extension.CustomHeaderIconCell=g.HeaderCell.extend({className:"header-icon-cell",events:{click:"addHeaderIcon"},addHeaderIcon:function(e){this.collection.add(new this.collection.model),e.preventDefault()},render:function(){return this.$el.empty(),this.$el.html("<label><a><span style='font-weight:normal;'>Array Values</a></span></label> <button class='btn-sm btn-secondary add'>Add</button>"),this.delegateEvents(),this}});var a=l.Model.extend({defaults:{value:null}}),u=g.Extension.InputArrayCellEditor=g.CellEditor.extend({tagName:"div",events:{blur:"lostFocus"},render:function(){var e=this.model.get(this.column.get("name")),t="string";switch(this.model.get("type").replace("[]","")){case"boolean":t="boolean";break;case"integer":case"smallint":case"bigint":case"serial":case"smallserial":case"bigserial":case"oid":case"cid":case"xid":case"tid":t="integer";break;case"real":case"numeric":case"double precision":case"decimal":t="number";break;case"date":t="date"}var i=[{name:"value",label:o("Array Values"),type:"text",cell:t,headerCell:g.Extension.CustomHeaderIconCell,cellHeaderClasses:"width_percent_100"}],n=m("<div class='pgadmin-control-group backgrid form-group col-12 object subnode'></div>");this.$el.attr("tabindex","1"),i.unshift({name:"pg-backform-delete",label:"",cell:g.Extension.DeleteCell,editable:!1,cell_priority:-1}),this.$el.empty();var s,a,l=this.grid=new g.Grid({columns:i,collection:e});return this.grid.listenTo(e,"backgrid:error",(s=this,function(e){s.model.trigger("backgrid:error",s.model,s.column,new g.Command(e))})),this.grid.listenTo(e,"backgrid:edited",(a=this,function(e){a.model.trigger("backgrid:edited",a.model,a.column,new g.Command(e))})),l.render(),n.append(l.$el),this.$el.html(n),m(this.$el).pgMakeVisible("backform-tab"),this.delegateEvents(),this},lostFocus:function(i){var n=this;setTimeout(function(){if(n.$el[0]!=document.activeElement&&!function(e,t){for(var i=t.parentNode;null!=i;){if(i==e)return!0;i=i.parentNode}return!1}(n.$el[0],document.activeElement)){var e=n.model,t=n.column;e.trigger("backgrid:edited",e,t,new g.Command(i)),setTimeout(function(){n.grid&&(n.grid.remove(),n.grid=null)},10)}},10)}}),h=g.Extension.InputStringArrayCellFormatter=function(){};f.extend(h.prototype,{fromRaw:function(e){var i=[];return e.each(function(e){var t=e.get("value");f.isUndefined(t)?i.push("null"):i.push(e.get("value"))}),i.toString()},toRaw:function(e){return e}});var v=g.Extension.InputIntegerArrayCellFormatter=function(){};f.extend(v.prototype,{fromRaw:function(e){var i=[];return e.each(function(e){var t=e.get("value");f.isUndefined(t)||f.isNull(t)?i.push("NULL"):i.push(e.get("value"))}),i.toString()},toRaw:function(e){return e.each(function(e){e.set("value",parseInt(e.get("value")),{silent:!0})}),e}});var b=g.Extension.InputNumberArrayCellFormatter=function(){};f.extend(b.prototype,{fromRaw:function(e){var i=[];return e.each(function(e){var t=e.get("value");f.isUndefined(t)||f.isNull(t)?i.push("NULL"):i.push(e.get("value"))}),i.toString()},toRaw:function(e){return e.each(function(e){e.set("value",parseFloat(e.get("value")),{silent:!0})}),e}}),g.Extension.InputStringArrayCell=g.Cell.extend({className:"width_percent_25",formatter:h,editor:u,initialize:function(e){g.Cell.prototype.initialize.apply(this,arguments);var t=e.model;f.isUndefined(this.collection)&&(this.collection=new(l.Collection.extend({model:a}))(t.get("value"))),this.model.set(this.column.get("name"),this.collection),this.listenTo(this.collection,"remove",this.render)}}),g.Extension.InputIntegerArrayCell=g.IntegerCell.extend({className:"width_percent_25",formatter:v,editor:u,initialize:function(e){g.IntegerCell.prototype.initialize.apply(this,arguments);var t=e.model;f.each(t.get("value"),function(e){"NULL"===e.value&&(e.value=null)}),f.isUndefined(this.collection)&&(this.collection=new(l.Collection.extend({model:a}))(t.get("value"))),this.model.set(this.column.get("name"),this.collection),this.listenTo(this.collection,"remove",this.render)}}),g.Extension.InputNumberArrayCell=g.NumberCell.extend({className:"width_percent_25",formatter:b,editor:u,initialize:function(e){g.NumberCell.prototype.initialize.apply(this,arguments);var t=e.model;f.each(t.get("value"),function(e){"NULL"===e.value&&(e.value=null)}),f.isUndefined(this.collection)&&(this.collection=new(l.Collection.extend({model:a}))(t.get("value"))),this.model.set(this.column.get("name"),this.collection),this.listenTo(this.collection,"remove",this.render)}}),g.Extension.InputBooleanArrayCell=g.BooleanCell.extend({className:"width_percent_25",editor:u,initialize:function(e){g.BooleanCell.prototype.initialize.apply(this,arguments);var t=e.model;f.isUndefined(this.collection)&&(this.collection=new(l.Collection.extend({model:a}))(t.get("value"))),this.model.set(this.column.get("name"),this.collection),this.listenTo(this.collection,"remove",this.render)}});var y=g.Extension.DependentCell=function(){};f.extend(y.prototype,{initialize:function(){var e=this.column.get("deps"),i=this;e&&f.isArray(e)&&f.each(e,function(e){var t=e.split(".").shift();i.listenTo(i.model,"change:"+t,i.dependentChanged)})},remove:function(){var i=this,e=i.column.get("deps");e&&f.isArray(e)&&f.each(e,function(e){var t=e.split(".").shift();i.stopListening(i.model,"change:"+t,i.dependentChanged)})}});var C=g.PasswordFormatter=function(){};C.prototype=new g.CellFormatter,f.extend(C.prototype,{fromRaw:function(e){if(f.isUndefined(e)||f.isNull(e))return"";for(var t="",i=0;i<e.length;i++)t+="*";return t}}),g.Extension.PasswordCell=g.StringCell.extend({formatter:C,editor:g.InputCellEditor.extend({attributes:{type:"password",autocomplete:"new-password"},render:function(){var e=this.model;return this.$el.val(e.get(this.column.get("name"))),this}})}),f.extend(g.NumberFormatter.prototype,{fromRaw:function(e){if(f.isNull(e)||f.isUndefined(e))return"";var t=(e=parseFloat(e).toFixed(~~this.decimals)).split("."),i=t[0],n=t[1]?(this.decimalSeparator||".")+t[1]:"";return i.replace(this.HUMANIZED_NUM_RE,"$1"+this.orderSeparator)+n}});var _=g.Extension.JSONBCellFormatter=function(){};f.extend(_.prototype,{fromRaw:function(e){if(f.isArray(e)){return"{"+f.map(e,function(e){return JSON.stringify(JSON.stringify(e))}).join()+"}"}return f.isObject(e)?JSON.stringify(e):e},toRaw:function(e){return e}}),g.Extension.JSONBCell=g.StringCell.extend({className:"jsonb-cell",formatter:_}),g.Extension.DatepickerCell=g.Cell.extend({editor:w});var w=g.InputCellEditor.extend({events:{},initialize:function(){g.InputCellEditor.prototype.initialize.apply(this,arguments);var i=this;m(this.el).prop("readonly",!0),m(this.el).datepicker({onClose:function(e){var t=new g.Command({});i.model.set(i.column.get("name"),e),i.model.trigger("backgrid:edited",i.model,i.column,t),t=i=null}})}}),x=g.Extension.MomentFormatter=function(e){f.extend(this,this.defaults,e)};x.prototype=new g.CellFormatter,f.extend(x.prototype,{defaults:{modelInUnixOffset:!1,modelInUnixTimestamp:!1,modelInUTC:!0,modelLang:i.locale(),modelFormat:i.defaultFormat,displayInUnixOffset:!1,displayInUnixTimestamp:!1,displayInUTC:!0,displayLang:i.locale(),displayFormat:i.defaultFormat,allowEmpty:!1},fromRaw:function(e){if(null==e)return"";var t=this.modelInUnixOffset?i(e):this.modelInUnixTimestamp?i.unix(e):this.modelInUTC?i.utc(e,this.modelFormat,this.modelLang):i(e,this.modelFormat,this.modelLang);return this.displayInUnixOffset?+t:this.displayInUnixTimestamp?t.unix():(this.displayLang&&t.locale(this.displayLang),this.displayInUTC?t.utc():t.local(),this.displayFormat!=i.defaultFormat?t.format(this.displayFormat):t.format())},toRaw:function(e){var t=this.displayInUnixOffset?i(+e):this.displayInUnixTimestamp?i.unix(+e):this.displayInUTC?i.utc(e,this.displayFormat,this.displayLang):i(e,this.displayFormat,this.displayLang);return t&&t.isValid()?this.modelInUnixOffset?+t:this.modelInUnixTimestamp?t.unix():(this.modelLang&&t.locale(this.modelLang),this.modelInUTC?t.utc():t.local(),this.modelFormat!=i.defaultFormat?t.format(this.modelFormat):t.format()):this.allowEmpty&&""===e?null:void 0}});var k=g.Extension.MomentCell=g.Cell.extend({editor:g.InputCellEditor,className:"datetime-cell",formatter:x,initialize:function(e){k.__super__.initialize.apply(this,arguments);var t=x.prototype.defaults,i=f.keys(t),n=f.pick(this,i),s=f.pick(e,i),a=f.pick(this.column.toJSON(),i);f.extend(this.formatter,t,n,s,a),this.editor=this.editor.extend({attributes:f.extend({},this.editor.prototype.attributes||this.editor.attributes||{},{placeholder:this.formatter.displayFormat}),options:this.column.get("options")})}});g.Extension.DatetimePickerEditor=g.InputCellEditor.extend({postRender:function(){var i=this,e=f.extend({format:"YYYY-MM-DD HH:mm:ss Z",icons:{clear:"fa fa-trash"},buttons:{showToday:!0},toolbarPlacement:"top",keepOpen:!1},function(){var e=[];Array.prototype.push.apply(e,arguments);var t=e.shift();return"function"==typeof t?t.apply(i,e):t}(this.column.get("options")),{keyBinds:{"shift tab":function(e){e&&setTimeout(function(){i.closeIt({keyCode:9,shiftKey:!0})},10)},tab:function(e){e&&setTimeout(function(){i.closeIt({keyCode:9})},10)}}});this.tabKeyPress=!1,this.$el.datetimepicker(e),this.$el.datetimepicker("show"),this.picker=this.$el.data("DateTimePicker")},events:{"hide.datetimepicker":"closeIt",focusout:"closeIt",keydown:"keydownHandler"},keydownHandler:function(e){9===e.keyCode&&this.el===e.target&&this.closeIt(e,!0)},closeIt:function(e,t){if(!this.is_closing&&!this.tabKeyPress){this.is_closing=!0,this.tabKeyPress=t;var i=this.formatter,n=this.model,s=this.column,a=this.$el.val(),l=i.toRaw(a,n);if(this.$el.datetimepicker("destroy"),this.is_closing=!1,f.isUndefined(l))n.trigger("backgrid:error",n,s,a);else{n.set(s.get("name"),l);var o=new g.Command(e);setTimeout(function(){n.trigger("backgrid:edited",n,s,o)},20)}}}}),f.extend(k.prototype,x.prototype.defaults),g.Extension.StringDepCell=g.StringCell.extend({initialize:function(){g.StringCell.prototype.initialize.apply(this,arguments),g.Extension.DependentCell.prototype.initialize.apply(this,arguments)},dependentChanged:function(){this.$el.empty();var e=this,t=this.model,i=this.column,n=this.column.get("editable");this.render();var s=f.isFunction(n)?!!n.apply(i,[t]):!!n;return setTimeout(function(){e.$el.removeClass("editor"),s?e.$el.addClass("editable"):e.$el.removeClass("editable")},10),this.delegateEvents(),this},remove:g.Extension.DependentCell.prototype.remove}),g.Extension.Select2DepCell=g.Extension.Select2Cell.extend({initialize:function(){g.Extension.Select2Cell.prototype.initialize.apply(this,arguments),g.Extension.DependentCell.prototype.initialize.apply(this,arguments)},dependentChanged:function(){var e=this.model,t=this.column,i=this.column.get("editable");return this.render(),(f.isFunction(i)?i.apply(t,[e]):i)?this.$el.addClass("editable"):this.$el.removeClass("editable"),this.delegateEvents(),this},remove:g.Extension.DependentCell.prototype.remove}),g.Extension.ClientSideFilter=g.Extension.ClientSideFilter.extend({$customSearchBox:null,searchBox:function(){return this.$customSearchBox?this.$customSearchBox:this.$el.find("input[type=search]")},setCustomSearchBox:function(e){this.$customSearchBox=e,this.$customSearchBox.attr("type","search"),this.$customSearchBox.on("keydown",this.search.bind(this))},unsetCustomSearchBox:function(){this.$customSearchBox.off("keydown",this.search.bind(this)),this.$customSearchBox=null}});var N=g.BooleanCellFormatter=function(){};return f.extend(N.prototype,{fromRaw:function(e){return!f.isUndefined(e)&&!f.isNull(e)&&("1"===e||"True"===e||"0"!==e&&"False"!==e&&e)},toRaw:function(e){return e}}),g}.apply(s,t))||(n.exports=i)}).call(this,a(3),a(0))},387:function(e,t,i){"use strict";var n,s;i(18),i(11),i(6),n=[i(1),i(3),i(0),i(59)],void 0===(s=function(a,i,l){var n=i.Browser=i.Browser||{},o=window.wcDocker;return i.Browser.Panel=function(e){a.extend(this,a.pick(e,["name","title","width","height","showTitle","isCloseable","isPrivate","isLayoutMember","content","icon","events","onCreate","elContainer","canHide","limit","extraClasses"]))},a.extend(i.Browser.Panel.prototype,{name:"",title:"",width:300,height:600,showTitle:!0,isCloseable:!0,isPrivate:!1,isLayoutMember:!0,content:"",icon:"",panel:null,onCreate:null,elContainer:!1,limit:null,extraClasses:null,load:function(e,n){var s=this;s.panel||e.registerPanelType(s.name,{title:s.title,isPrivate:s.isPrivate,limit:s.limit,isLayoutMember:s.isLayoutMember,onCreate:function(i){if(l(i).data("pgAdminName",s.name),i.initSize(s.width,s.height),s.showTitle){var e='<a href="#" tabindex="-1" class="panel-link-heading">'+(n||s.title)+"</a>";i.title(e),""!=s.icon&&i.icon(s.icon)}else i.title(!1);var t=l("<div>",{class:"pg-panel-content"}).append(l(s.content));a.isNull("extraClasses")||t.addClass(s.extraClasses),i.closeable(!!s.isCloseable),i.layout().addItem(t),s.panel=i,s.events&&a.isObject(s.events)&&a.each(s.events,function(e,t){e&&a.isFunction(e)&&i.on(t,e)}),a.each([o.EVENT.UPDATED,o.EVENT.VISIBILITY_CHANGED,o.EVENT.BEGIN_DOCK,o.EVENT.END_DOCK,o.EVENT.GAIN_FOCUS,o.EVENT.LOST_FOCUS,o.EVENT.CLOSED,o.EVENT.BUTTON,o.EVENT.ATTACHED,o.EVENT.DETACHED,o.EVENT.MOVE_STARTED,o.EVENT.MOVE_ENDED,o.EVENT.MOVED,o.EVENT.RESIZE_STARTED,o.EVENT.RESIZE_ENDED,o.EVENT.RESIZED,o.EVENT.SCROLLED],function(e){i.on(e,s.eventFunc.bind(i,e))}),s.onCreate&&a.isFunction(s.onCreate)&&s.onCreate.apply(s,[i,t]),s.elContainer&&((i.pgElContainer=t).addClass("pg-el-container"),a.each([o.EVENT.RESIZED,o.EVENT.ATTACHED,o.EVENT.DETACHED,o.EVENT.VISIBILITY_CHANGED],function(e){i.on(e,s.resizedContainer.bind(i))}),s.resizedContainer.apply(i)),s.canHide&&a.each([o.EVENT.CLOSED,o.EVENT.VISIBILITY_CHANGED],function(e){i.on(e,s.handleVisibility.bind(i,e))})}})},eventFunc:function(e){var t=l(this).data("pgAdminName");try{n.Events.trigger("pgadmin-browser:panel",e,this,arguments),n.Events.trigger("pgadmin-browser:panel:"+e,this,arguments),t&&(n.Events.trigger("pgadmin-browser:panel-"+t,e,this,arguments),n.Events.trigger("pgadmin-browser:panel-"+t+":"+e,this,arguments))}catch(e){console.warn(e.stack||e)}},resizedContainer:function(){var i=this;if(i.pgElContainer&&!i.pgResizeTimeout){if(!i.isVisible())return clearTimeout(i.pgResizeTimeout),void(i.pgResizeTimeout=null);i.pgResizeTimeout=setTimeout(function(){var e=i.width(),t="xs";i.pgResizeTimeout=null,e<480&&(t="xs"),480<=e&&(t="sm"),768<=e&&(t="md"),992<=e&&(t="lg"),1200<=e&&(t="xl"),i.pgElContainer.attr("el",t)},100)}},handleVisibility:function(e){if("dashboard"==this._type&&!a.isUndefined(i.Dashboard))if("panelClosed"==e)i.Dashboard.toggleVisibility(!1,!0);else if("panelVisibilityChanged"==e&&n.tree){var t=n.tree.selected();a.isUndefined(i.Dashboard)||i.Dashboard.toggleVisibility(n.panels.dashboard.panel.isVisible()),t.length&&n.Events.trigger("pgadmin-browser:tree:selected",t,n.tree.itemData(t),n.Node)}}}),i.Browser.Panel}.apply(t,n))||(e.exports=s)},388:function(e,t,i){"use strict";var n,s;n=[i(2),i(1),i(47),i(3)],void 0===(s=function(s,a,l,e){return e.Browser=e.Browser||{},a.extend(e.Browser,{report_error:function(e,t,i){e=a.escape(e),t=a.escape(t),i=a.escape(i);var n='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">           <div class="panel panel-default">           <div class="panel-heading" role="tab" id="headingOne">           <h4 class="panel-title">           <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">           '+s("Error message")+'</a>        </h4>        </div>        <div id="collapseOne" class="panel-collapse collapse show" role="tabpanel" aria-labelledby="headingOne">        <div class="panel-body" style="overflow: auto;">'+t+"</div>        </div>        </div>";null!=i&&""!=i&&(n+='<div class="panel panel-default">            <div class="panel-heading" role="tab" id="headingTwo">            <h4 class="panel-title">            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">            '+s("Additional info")+'</a>          </h4>          </div>          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">          <div class="panel-body" style="overflow: auto;">'+i+"</div>          </div>          </div>          </div>"),n+="</div>",l.alert(e,n).set("closable",!0)}}),e.Browser.report_error}.apply(t,n))||(e.exports=s)},389:function(e,t,i){"use strict";var n,s;function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i(21),i(26),i(27),i(122),i(19),i(117),i(50),i(30),i(11),i(48),i(12),i(236),i(4),i(46),i(24),i(8),i(22),i(6),i(31),n=[i(1),i(3),i(0),i(15),i(25)],void 0===(s=function(d,a,e,c,l){var o=a.Browser=a.Browser||{};return o.DataModel=c.Model.extend({on_server:!1,parse:function(s){var a=this;s&&d.isObject(s)&&"node"in s&&s.node&&(a.tnode=d.extend({},s.node),delete s.node);return function n(e){e&&d.isArray(e)&&d.each(e,function(e){var t,i;switch(e.type){case"collection":t=a.get(e.id),i=s[e.id],d.isArray(i)||d.isObject(i)?t&&t instanceof c.Collection?t.reset(i,{silent:!0,parse:!0,on_server:!0}):(t=new o.Node.Collection(i,{model:d.isString(e.model)&&e.model in o.Nodes?o.Nodes[e.model].model:e.model,top:a.top||a,handler:a,parse:!0,silent:!0,attrName:e.id}),a.set(e.id,t,{silent:!0,parse:!0,on_server:!0})):t=null,a.set(e.id,t,{silent:!0}),s[e.id]=t;break;case"model":t=a.get(e.id),i=s[e.id],d.isUndefined(i)||d.isNull(i)?t=null:(t&&t instanceof c.Model||(t=d.isString(e.model)&&e.model in o.Nodes[e.model]?new o.Nodes[e.model].Model(t,{silent:!0,top:a.top||a,handler:a,attrName:e.id}):new e.model(t,{silent:!0,top:a.top||a,handler:a,attrName:e.id})),t.set(i,{parse:!0,silent:!0})),s[e.id]=t;break;case"nested":n(e.schema)}})}(a.schema),s},isNew:function(){return this.has(this.idAttribute)?!this.has(this.idAttribute):!this.on_server},primary_key:function(){if(this.keys&&d.isArray(this.keys)){var t={},i=this;return d.each(i.keys,function(e){t[e]=i.attributes[e]}),JSON.stringify(t)}return this.cid},initialize:function(e,t){var n,s=this;s._previous_key_values={},!d.isUndefined(t)&&"on_server"in t&&t.on_server&&(s.on_server=!0),c.Model.prototype.initialize.apply(s,arguments),(d.isUndefined(t)||d.isNull(t))&&(t=e||{},e=null),s.sessAttrs={},s.fieldData={},s.origSessAttrs={},s.objects=[],s.arrays=[],s.attrName=t.attrName,s.top=t.top||s.collection&&s.collection.top||s.collection||s,s.handler=t.handler||s.collection&&s.collection.handler,s.trackChanges=!1,s.errorModel=new c.Model,s.node_info=t.node_info;return function i(e){e&&d.isArray(e)&&d.each(e,function(e){switch(e.type){case"int":case"numeric":s.fieldData[e.id]={id:e.id,label:e.label,type:e.type,min:d.isUndefined(e.min)?void 0:e.min,max:d.isUndefined(e.max)?void 0:e.max};break;default:s.fieldData[e.id]={id:e.id,label:e.label,type:e.type}}switch(e.type){case"array":s.arrays.push(e.id);break;case"collection":if(!((n=s.get(e.id))&&n instanceof o.Node.Collection))if(d.isString(e.model)&&e.model in o.Nodes){var t=o.Nodes[e.model];n=new t.Collection(n,{model:t.model,top:s.top||s,handler:s,attrName:e.id})}else n=new o.Node.Collection(n,{model:e.model,top:s.top||s,handler:s,attrName:e.id});n.name=e.id,s.objects.push(e.id),s.set(e.id,n,{silent:!0});break;case"model":(n=s.get(e.id))&&n instanceof c.Model||(n=d.isString(e.model)&&e.model in o.Nodes[e.model]?new o.Nodes[e.model].Model(n,{top:s.top||s,handler:s,attrName:e.id}):new e.model(n,{top:s.top||s,handler:s,attrName:e.id})),n.name=e.id,s.objects.push(e.id),s.set(e.id,n,{silent:!0});break;case"nested":i(e.schema);break;default:return}})}(s.schema),s.handler&&s.handler.trackChanges&&s.startNewSession(),"keys"in s&&d.isArray(s.keys)&&d.each(s.keys,function(t){s.on("change:"+t,function(e){s._previous_key_values[t]=e.previous(t)})}),s},reset:function(t){var i,e=!(!t||!t.reindex);if(t&&t.stop&&this.stopSession(),e){for(var n in this.objects)(i=this.get(n))&&(i instanceof o.DataModel?i.reset(t):i instanceof c.Model?i.clear(t):i instanceof o.DataCollection?i.reset([],t):i instanceof c.Collection&&(i.each(function(e){e instanceof c.DataModel&&(i.reset(),i.clear(t))}),c.Collection.prototype.reset.call(i,[],t)));c.Collection.prototype.reset.apply(this,arguments)}},sessChanged:function(){var i=this;return 0<d.size(i.sessAttrs)||d.some(i.objects,function(e){var t=i.get(e);return!d.isNull(t)&&!d.isUndefined(t)&&t.sessChanged()})},sessValid:function(){var e=this;return!("default_validate"in e&&"function"==typeof e.default_validate&&d.isString(e.default_validate()))&&!("validate"in e&&d.isFunction(e.validate)&&d.isString(e.validate.apply(e)))},set:function(e,t,i){var n=d.isObject(e)?t:i;this._changing=!0,this._previousAttributes=d.clone(this.attributes),this.changed={};var s=c.Model.prototype.set.call(this,e,t,i);if(this._changing=!1,n&&n.internal||!this.trackChanges)return!0;if(null!=e&&s){var a,l={},o=this,r=function(e,t){t in o.objects||(l[t]=e,d.isEqual(o.origSessAttrs[t],e)?delete o.sessAttrs[t]:o.sessAttrs[t]=e)};return"object"===p(e)?d.each(e,r):r(t,e),o.trigger("pgadmin-session:set",o,l),i&&i.silent||o.trigger("change",o,i),"default_validate"in o&&"function"==typeof o.default_validate&&(a=o.default_validate()),"validate"in o&&"function"==typeof o.validate&&(a=a||o.validate(d.keys(l))),0==d.size(o.errorModel.attributes)?o.collection||o.handler?(o.collection||o.handler).trigger("pgadmin-session:model:valid",o,o.collection||o.handler):o.trigger("pgadmin-session:valid",o.sessChanged(),o):(a=a||d.values(o.errorModel.attributes)[0],o.collection||o.handler?(o.collection||o.handler).trigger("pgadmin-session:model:invalid",a,o,o.collection||o.handler):o.trigger("pgadmin-session:invalid",a,o)),s}return s},toJSON:function(i,n){var s,a=this,l=a.isNew();return s=!(i=void 0!==i&&1==i)||l?c.Model.prototype.toJSON.call(this,arguments):((s={})[a.idAttribute||"_id"]=a.get(a.idAttribute||"_id"),d.extend(s,a.sessAttrs)),d.each(a.objects,function(e){var t=a.get(e);i?s[e]instanceof Array?s[e]=JSON.stringify(s[e]):t&&t.sessChanged&&t.sessChanged()||l?(s[e]=t&&t.toJSON(!l),t&&n&&"GET"==n&&(s[e]=JSON.stringify(s[e]))):delete s[e]:s[e]instanceof Array||(s[e]=t&&t.toJSON())}),i&&d.each(a.arrays,function(e){s[e]&&s[e]instanceof Array&&(s[e]=JSON.stringify(s[e]))}),s},startNewSession:function(){var i=this;i.trackChanges&&(i.trigger("pgadmin-session:stop",i),i.off("pgadmin-session:model:invalid",i.onChildInvalid),i.off("pgadmin-session:model:valid",i.onChildValid),i.off("pgadmin-session:changed",i.onChildChanged),i.off("pgadmin-session:added",i.onChildChanged),i.off("pgadmin-session:removed",i.onChildChanged)),i.trackChanges=!0,i.sessAttrs={},i.origSessAttrs=d.clone(i.attributes),d.each(i.objects,function(e){var t=i.get(e);d.isUndefined(t)||d.isNull(t)||(delete i.origSessAttrs[e],t&&"startNewSession"in t&&d.isFunction(t.startNewSession)&&t.startNewSession())}),i.trigger("pgadmin-session:start",i),i.on("pgadmin-session:model:invalid",i.onChildInvalid),i.on("pgadmin-session:model:valid",i.onChildValid),i.on("pgadmin-session:changed",i.onChildChanged),i.on("pgadmin-session:added",i.onChildChanged),i.on("pgadmin-session:removed",i.onChildChanged)},onChildInvalid:function(e,t){var i=this;if(i.trackChanges&&t){var n=t.attrName;if(!n){var s=t.primary_key&&"function"==typeof t.primary_key,a=s?t.primary_key():t.cid,l=s?function(e){var t=i.get("k");return!(!t||t.primary_key()!==a)&&(n=e,!0)}:function(e){return i.get(e).cid===a&&(n=e,!0)};d.findIndex(i.objects,l)}n&&(i.errorModel.set(n,e),i.handler?i.handler.trigger("pgadmin-session:model:invalid",e,i,i.handler):i.trigger("pgadmin-session:invalid",e,i))}return this},onChildValid:function(e){var i=this;if(i.trackChanges&&e){var n=e.attrName;if(!n){var t=e.primary_key&&"function"==typeof e.primary_key,s=t?e.primary_key():e.cid,a=t?function(e){var t=i.get("k");return!(!t||t.primary_key()!==s)&&(n=e,!0)}:function(e){var t=i.get("k");return!(!t||t.cid!==s)&&(n=e,!0)};d.findIndex(i.objects,a)}var l=null,o=function(e,t){return"default_validate"in e&&"function"==typeof e.default_validate&&(l=e.default_validate(),d.isString(l))?l:"validate"in e&&"function"==typeof e.validate?l=e.validate(t):null};if(e instanceof c.Collection){for(var r in e.models)if(o(e.models[r]))break}else e instanceof c.Model&&o(e);n&&i.errorModel.has(n)&&(l?i.errorModel.set(n,l):i.errorModel.unset(n)),0!=d.size(i.errorModel.attributes)||o(i,n&&[n])?(l=l||d.values(i.errorModel.attributes)[0],i.handler?i.handler.trigger("pgadmin-session:model:invalid",l,i,i.handler):i.trigger("pgadmin-session:invalid",l,i)):i.handler?i.handler.trigger("pgadmin-session:model:valid",i,i.handler):i.trigger("pgadmin-session:valid",i.sessChanged(),i)}},onChildChanged:function(){this.trackChanges&&this.collection&&this.collection.trigger("change",this)},stopSession:function(){var i=this;i.trackChanges&&(i.off("pgadmin-session:model:invalid",i.onChildInvalid),i.off("pgadmin-session:model:valid",i.onChildValid),i.off("pgadmin-session:changed",i.onChildChanged),i.off("pgadmin-session:added",i.onChildChanged),i.off("pgadmin-session:removed",i.onChildChanged)),i.trackChanges=!1,i.sessAttrs={},i.origSessAttrs={},d.each(i.objects,function(e){var t=i.get(e);d.isUndefined(t)||d.isNull(t)||(i.origSessAttrs[e]=null,delete i.origSessAttrs[e],t&&"stopSession"in t&&d.isFunction(t.stopSession)&&t.stopSession())}),i.trigger("pgadmin-session:stop")},default_validate:function(){for(var e,t,i,n,s=0,a=d.keys(this.attributes),l=a.length;s<l;s++)if(i=this.attributes[a[s]],t=this.fieldData[a[s]],e=null,d.isUndefined(i)||d.isNull(i)||""==String(i).replace(/^\s+|\s+$/g,""))t&&this.errorModel.unset(t.id);else{if(!t)continue;if(!(n=t.type||void 0))continue;switch(n){case"int":e=this.integer_validate(i,t);break;case"numeric":e=this.number_validate(i,t)}if(e)return this.errorModel.set(t.id,e),e;this.errorModel.unset(t.id)}return null},check_min_max:function(e,t){var i=t.label,n=t.min,s=t.max;return!d.isUndefined(n)&&e<n?l.sprintf(a.Browser.messages.MUST_GR_EQ,i,n):!d.isUndefined(s)&&s<e?l.sprintf(a.Browser.messages.MUST_LESS_EQ,i,s):null},number_validate:function(e,t){return new RegExp("^-?[0-9]+(.?[0-9]*)?$").test(e)?this.check_min_max(e,t):l.sprintf(a.Browser.messages.MUST_BE_NUM,t.label)},integer_validate:function(e,t){return new RegExp("^-?[0-9]*$").test(e)?this.check_min_max(e,t):l.sprintf(a.Browser.messages.MUST_BE_INT,t.label)}}),o.DataCollection=c.Collection.extend({initialize:function(e,t){var i=this;return t=t||{},i.sessAttrs={changed:[],added:[],deleted:[],invalid:[]},i.top=t.top||i,i.attrName=t.attrName,i.handler=t.handler,i.trackChanges=!1,i.on("add",i.onModelAdd),i.on("remove",i.onModelRemove),i.on("change",i.onModelChange),i.handler&&i.handler.trackChanges&&i.startNewSession(),i},startNewSession:function(){var t,i=this;i.trackChanges&&(i.trigger("pgadmin-session:stop",i),i.off("pgadmin-session:model:invalid",i.onModelInvalid),i.off("pgadmin-session:model:valid",i.onModelValid)),i.trackChanges=!0,i.sessAttrs={changed:[],added:[],deleted:[],invalid:[]},d.each(i.models,function(e){"startNewSession"in e&&d.isFunction(e.startNewSession)&&e.startNewSession(),"default_validate"in e&&"function"==typeof e.default_validate&&(t=e.default_validate()),d.isString(t)?i.sessAttrs.invalid[e.cid]=t:"validate"in e&&"function"==typeof e.validate&&(t=e.validate())&&(i.sessAttrs.invalid[e.cid]=t)}),i.trigger("pgadmin-session:start",i),i.on("pgadmin-session:model:invalid",i.onModelInvalid),i.on("pgadmin-session:model:valid",i.onModelValid)},onModelInvalid:function(e,t){var i=this,n=i.sessAttrs.invalid;return i.trackChanges&&(n[t.cid]=e,i.handler?i.handler.trigger("pgadmin-session:model:invalid",e,i,i.handler):i.trigger("pgadmin-session:invalid",e,i)),!0},onModelValid:function(e){var t=this.sessAttrs.invalid;if(this.trackChanges){var i=this.checkDuplicateWithModel(e);i&&e.cid in t&&delete t[e.cid],i&&this.triggerValidationEvent.apply(this)}return!0},stopSession:function(){this.trackChanges=!1,this.sessAttrs={changed:[],added:[],deleted:[],invalid:[]},d.each(this.models,function(e){"stopSession"in e&&d.isFunction(e.stopSession)&&e.stopSession()})},sessChanged:function(){return 0<this.sessAttrs.changed.length||0<this.sessAttrs.added.length||0<this.sessAttrs.deleted.length},toJSON:function(e){if(e=void 0!==e&&1==e){var t={added:[]};return d.each(this.sessAttrs.added,function(e){t.added.push(e.toJSON())}),0==t.added.length&&delete t.added,t.changed=[],d.each(this.sessAttrs.changed,function(e){t.changed.push(e.toJSON(!0))}),0==t.changed.length&&delete t.changed,t.deleted=[],d.each(this.sessAttrs.deleted,function(e){t.deleted.push(e.toJSON())}),0==t.deleted.length&&delete t.deleted,0==d.size(t)?null:t}return c.Collection.prototype.toJSON.call(this)},reset:function(e,t){t&&t.stop&&this.stopSession(),this.each(function(e){e&&(e instanceof o.DataModel?e.reset(t):e.clear(t))}),c.Collection.prototype.reset.apply(this,arguments)},objFindInSession:function(e,t){var i=e.primary_key&&"function"==typeof e.primary_key,n=i?e.primary_key():e.cid,s=i?function(e){return e.primary_key()===n}:function(e){return e.cid===n};return d.findIndex(this.sessAttrs[t],s)},onModelAdd:function(e){if(!this.trackChanges)return!0;var t,i=this,n=i.objFindInSession(e,"deleted");if(0<=n){var s=i.sessAttrs.deleted[n];e.origSessAttrs=d.clone(s.origSessAttrs),e.attributes=d.extend(e.attributes,s.attributes),e.sessAttrs=d.clone(s.sessAttrs),i.sessAttrs.deleted.splice(n,1),"sessChanged"in e&&!e.sessChanged()||i.sessAttrs.changed.push(e),(i.handler||i).trigger("pgadmin-session:added",i,e),"default_validate"in e&&"function"==typeof e.default_validate&&(t=e.default_validate()),d.isString(t)?i.sessAttrs.invalid[e.cid]=t:"validate"in e&&"function"==typeof e.validate&&(t=e.validate())&&(i.sessAttrs.invalid[e.cid]=t)}else"default_validate"in e&&"function"==typeof e.default_validate&&(t=e.default_validate()),d.isString(t)?i.sessAttrs.invalid[e.cid]=t:"validate"in e&&"function"==typeof e.validate&&(t=e.validate())&&(i.sessAttrs.invalid[e.cid]=t),i.sessAttrs.added.push(e),(i.handler||i).trigger("pgadmin-session:added",i,e);return this.triggerValidationEvent.apply(this),!0},onModelRemove:function(e){if(!this.trackChanges)return!0;e.errorModel.clear();var t=this,i=t.sessAttrs.invalid,n=d.clone(e),s=t.objFindInSession(e,"added");return e.cid in i&&delete i[e.cid],0<=s?(t.sessAttrs.added.splice(s,1),(t.handler||t).trigger("pgadmin-session:removed",t,n),t.checkDuplicateWithModel(n)):(0<=(s=t.objFindInSession(e,"changed"))&&t.sessAttrs.changed.splice(s,1),(t.handler||t).trigger("pgadmin-session:removed",t,n),t.sessAttrs.deleted.push(e),t.checkDuplicateWithModel(e)),this.triggerValidationEvent.apply(this),!0},triggerValidationEvent:function(){var e=this,t=null,i=e.sessAttrs.invalid,n=[];for(var s in i){if(t=i[s])break;n.push(s)}for(s in n)delete i[n[s]];t?e.handler?e.handler.trigger("pgadmin-session:model:invalid",t,e,e.handler):e.trigger("pgadmin-session:invalid",t,e):e.handler?e.handler.trigger("pgadmin-session:model:valid",e,e.handler):e.trigger("pgadmin-session:valid",e.sessChanged(),e)},onModelChange:function(e){var t=this;if(!(this.trackChanges&&e instanceof o.Node.Model))return!0;var i=t.objFindInSession(e,"added");return 0<=i?((t.handler||t).trigger("pgadmin-session:changed",t,e),!0):(i=t.objFindInSession(e,"changed"),"sessChanged"in e?(0<=i?(e.sessChanged()||t.sessAttrs.changed.splice(i,1),(t.handler||t).trigger("pgadmin-session:changed",t,e)):e.sessChanged()&&(t.sessAttrs.changed.push(e),(t.handler||t).trigger("pgadmin-session:changed",t,e)),!0):((t.handler||t).trigger("pgadmin-session:changed",t,e),0<=i||t.sessAttrs.changed.push(e),!0))},checkDuplicateWithModel:function(t){if(!("keys"in t)||d.isEmpty(t.keys))return!0;var i=this,n={},s={};d.each(t.keys,function(e){n[e]=t.get(e),e in t._previous_key_values?s[e]=t._previous_key_values[e]:s[e]=t.previous(e)}),t._previous_key_values={};var e=i.where(s);if(1==e.length){var a=e[0];i.clearInvalidSessionIfModelValid(a)}var l=i.where(n);if(0==l.length)i.clearInvalidSessionIfModelValid(t);else{if(1!=l.length){var o="Duplicate rows.";return setTimeout(function(){d.each(l,function(e){i.trigger("pgadmin-session:model:invalid",o,e,i.handler),e.trigger("pgadmin-session:model:duplicate",e,o)})},10),!1}i.clearInvalidSessionIfModelValid(t),i.clearInvalidSessionIfModelValid(l[0])}return!0},clearInvalidSessionIfModelValid:function(e){var t=e.errorModel.attributes,i=this.sessAttrs.invalid;e.trigger("pgadmin-session:model:unique",e),0==d.size(t)?delete i[e.cid]:i[e.cid]=t[Object.keys(t)[0]]}}),o.Events=d.extend({},c.Events),o}.apply(t,n))||(e.exports=s)},54:function(e,t,i){"use strict";var n,s;i(53),i(10),i(23),i(30),i(18),i(11),i(6),i(31),n=[i(2),i(1),i(0),i(15),i(68),i(56),i(47),i(80),i(106)],void 0===(s=function(v,o,b,s,e,l,t,r){var d=r.Model.extend({idAttribute:"privilege_type",defaults:{privilege_type:void 0,privilege:!1,with_grant:!1},validate:function(){return null}}),i=r.PrivilegeRoleModel=r.Model.extend({idAttribute:"grantee",defaults:{grantee:void 0,grantor:void 0,privileges:void 0},keys:["grantee","grantor"],privileges:[],schema:[{id:"grantee",label:v("Grantee"),type:"text",group:null,editable:!0,cellHeaderClasses:"width_percent_40",node:"role",options_cached:!1,disabled:function(e){return e instanceof s.Model&&!(e.top&&e.top.node_info&&e.top.node_info.server.user.name==e.get("grantor"))},transform:function(){var e=l.Extension.NodeListByNameCell.prototype.defaults.transform.apply(this,arguments);return e.unshift({label:"PUBLIC",value:"PUBLIC"}),e},cell:l.Extension.NodeListByNameCell.extend({initialize:function(e){var t=this,i=!0;e&&e.column&&e.column instanceof s.Model&&e.column.get("options_cached")&&(i=!1),l.Extension.NodeListByNameCell.prototype.initialize.apply(t,arguments),i&&(e=t.column.get("options"),t.column.set("options",t.omit_selected_roles.bind(t,e)));var n=function(e){var t=this;"grantee"in e.changed&&this.model.cid!=e.cid&&setTimeout(function(){t.render()},50)}.bind(this);this.listenTo(t.model.collection,"change",n,this),this.listenTo(t.model.collection,"remove",n,this)},omit_selected_roles:function(e,t){var i=e(t),n={},s=t.model,a=s.cid,l=(o.has(s.top,"node_info")&&!o.isUndefined(s.top.node_info)?s.top.node_info:s.handler.top.node_info).server.user.name;return s.collection.each(function(e){var t=e.get("grantee");e.cid==a||o.isUndefined(t)||l!=e.get("grantor")||(n[t]=e.cid)}),i=o.filter(i,function(e){return!(e.value in n)})}})},{id:"privileges",label:v("Privileges"),type:"collection",model:d,group:null,cell:"privilege",control:"text",cellHeaderClasses:"width_percent_40",disabled:function(e){return!(e instanceof s.Collection)&&!(this.node_info&&this.node_info.server.user.name==e.get("grantor")||this.attributes.node_info.server.user.name==e.get("grantor"))}},{id:"grantor",label:v("Grantor"),type:"text",disabled:!0,cell:"node-list-by-name",node:"role"}],initialize:function(e,t){r.Model.prototype.initialize.apply(this,arguments),o.isNull(e)&&this.set("grantor",t&&t.top&&t.top.node_info&&t.top.node_info.server.user.name,{silent:!0});var i=this,n=i.get("privileges"),s=this.get("privileges")||{};o.isArray(s)&&(s=new r.Collection(n,{model:d,top:this.top||this,handler:this,silent:!0,parse:!1}),this.set("privileges",s,{silent:!0}));var a={};return o.each(i.privileges,function(e){a[e]={privilege_type:e,privilege:!1,with_grant:!1}}),s.each(function(e){delete a[e.get("privilege_type")]}),o.each(a,function(e){s.add(e,{silent:!0})}),i.on("change:grantee",i.granteeChanged),s.on("change",function(){i.trigger("change:privileges",i)}),i},granteeChanged:function(){var e=this.get("privileges");"PUBLIC"==this.get("grantee")&&e.each(function(e){e.set("with_grant",!1,{silent:!0})})},toJSON:function(){var t=[];return this.attributes&&!this.attributes.privileges?null:(this.attributes.privileges.each(function(e){e.get("privilege")&&t.push(e.toJSON())}),{grantee:this.get("grantee"),grantor:this.get("grantor"),privileges:t})},validate:function(){var e,t=null;if(o.isUndefined(this.get("grantee"))?(e=v("A grantee must be selected."),this.errorModel.set("grantee",e),t=e):this.errorModel.unset("grantee"),this.attributes&&this.attributes.privileges){var i=!1;this.attributes.privileges.each(function(e){e.get("privilege")&&(i=!0)}),i?this.errorModel.unset("privileges"):(e=v("At least one privilege should be selected."),this.errorModel.set("privileges",e),t=t||e)}return t}}),n=l.Extension.PrivilegeCellEditor=l.CellEditor.extend({tagName:"div",Labels:{C:"CREATE",T:"TEMPORARY",c:"CONNECT",a:"INSERT",r:"SELECT",w:"UPDATE",d:"DELETE",D:"TRUNCATE",x:"REFERENCES",t:"TRIGGER",U:"USAGE",X:"EXECUTE"},template:o.template(['<tr class="<%= header ? "header" : "" %>">',' <td class="renderable">','  <label class="privilege_label">','   <input type="checkbox" tabindex="1" name="privilege" privilege="<%- privilege_type %>" target="<%- target %>" <%= privilege ? \'checked\' : "" %>></input>',"   <%- privilege_label %>","  </label>"," </td>",' <td class="renderable">','  <label class="privilege_label">','   <input type="checkbox" tabindex="1" name="with_grant" privilege="<%- privilege_type %>" target="<%- target %>" <%= with_grant ? \'checked\' : "" %> <%= enable_with_grant ? "" : \'disabled\'%>></input>',"   WITH GRANT OPTION","  </label>"," </td>","</tr>"].join(" "),null,{variable:null}),events:{change:"privilegeChanged",blur:"lostFocus",keydown:"lostFocus"},render:function(){this.$el.empty(),this.$el.attr("tabindex","1"),this.$el.attr("target",this.elId);var e=this.model.get(this.column.get("name")),i=b("<table></table>").appendTo(this.$el),n=this,s=!0,a=!0;return e.each(function(e){var t=e.toJSON();s=s&&t.privilege,a=a&&s&&t.with_grant,o.extend(t,{target:n.cid,header:!1,privilege_label:n.Labels[t.privilege_type],with_grant:"PUBLIC"!=n.model.get("grantee")&&t.with_grant,enable_with_grant:"PUBLIC"!=n.model.get("grantee")&&t.privilege}),s=s&&t.privilege,a=a&&s&&t.with_grant,i.append(n.template(t))}),1<e.length&&i.prepend(n.template({target:n.cid,privilege_label:"ALL",privilege_type:"ALL",privilege:s,with_grant:"PUBLIC"!=n.model.get("grantee")&&a,enable_with_grant:"PUBLIC"!=n.model.get("grantee")&&s,header:!0})),n.$el.find("input[type=checkbox]").first().trigger("focus"),b(n.$el.find("input[type=checkbox]")).on("blur",function(){n.$el.trigger("blur")}),b(n.$el).pgMakeVisible("backform-tab"),n.delegateEvents(),this},privilegeChanged:function(e){if(e&&e.target){var t,i,n,s=b(e.target),a=s.attr("privilege"),l=s.attr("name"),o=s.prop("checked"),r=s.closest("tr"),d=r.closest("table"),c=this.model.get("privileges"),p=this.model.get("grantee");if(this.undelegateEvents(),"ALL"==a){var u,h;n=r.find("input[name=with_grant]"),i=d.find("input[name=privilege][privilege!='ALL']"),t=d.find("input[name=with_grant][privilege!='ALL']"),"privilege"==l?(h=!1,(u=o)?(i.prop("checked",!0),"PUBLIC"==p?(t.prop("disabled",!0),n.prop("disabled",!0)):(t.prop("disabled",!1),n.prop("disabled",!1))):(i.prop("checked",!1),n.prop("checked",!1),t.prop("checked",!1),n.prop("disabled",!0),t.prop("disabled",!0))):(u=!0,h=o,t.prop("checked",o)),c.each(function(e){e.set({privilege:u,with_grant:h},{silent:!0})})}else{var f={};i=(d=r.closest("table")).find("input[name=privilege][privilege='ALL']"),t=d.find("input[name=with_grant][privilege='ALL']"),f[l]=o,"privilege"==l?(n=s.closest("tr").find("input[name=with_grant]"),o?"PUBLIC"!=p&&n.prop("disabled",!1):(f.with_grant=!1,n.prop("checked",!1).prop("disabled",!0),i.prop("checked",!1),t.prop("disabled",!0),t.prop("checked",!1))):o||t.prop("checked",!1),c.get(a).set(f,{silent:!0}),o&&1<(i=d.find("input[name=privilege][privilege!='ALL']:checked")).length&&i.length==c.models.length&&(i.prop("checked",!0),"with_grant"==l?(t=d.find("input[name=with_grant][privilege!='ALL']:checked")).length==c.models.length&&(t.prop("disabled",!1),t.prop("checked",!0)):"PUBLIC"!=p&&t.prop("disabled",!1))}this.model.trigger("change",this.model);var m=!1,g=null;c.each(function(e){m=m||e.get("privilege")}),m?(this.model.errorModel.unset("privileges"),this.model.errorModel.has("grantee")&&(g=this.model.errorModel.get("grantee"))):(this.model.errorModel.set("privileges",v("At least one privilege should be selected.")),g=v("At least one privilege should be selected.")),g?this.model.collection.trigger("pgadmin-session:model:invalid",g,this.model):this.model.collection.trigger("pgadmin-session:model:valid",this.model)}this.delegateEvents()},lostFocus:function(t){var i=this,e=this.model,n=this.column,s=new l.Command(t),a=this.model.get(this.column.get("name"));if(s.moveUp()||s.moveDown()||s.save())return t.preventDefault(),t.stopPropagation(),void e.trigger("backgrid:edited",e,n,s);if(s.cancel())return t.stopPropagation(),void e.trigger("backgrid:edited",e,n,s);if(s.moveRight()){if(a.last().get("privilege_type")===b(t.target).attr("privilege")&&("privilege"===t.target.name&&!t.target.checked||"with_grant"===b(t.target).attr("name")))return t.stopPropagation(),void e.trigger("backgrid:edited",e,n,s)}else if(s.moveLeft()&&"privilege"===t.target.name&&"ALL"===b(t.target).attr("privilege"))return t.stopPropagation(),void e.trigger("backgrid:edited",e,n,s);setTimeout(function(){if(("DIV"==document.activeElement.tagName||"BUTTON"==document.activeElement.tagName)&&i.$el[0]!=document.activeElement&&!function(e,t){for(var i=t.parentNode;null!=i;){if(i==e)return!0;i=i.parentNode}return!1}(i.$el[0],document.activeElement)){var e=i.model;e.trigger("backgrid:edited",e,i.column,new l.Command(t))}},10)}}),a=l.Extension.PrivilegeCellFormatter=function(){};return o.extend(a.prototype,{notation:{CREATE:"C",TEMPORARY:"T",CONNECT:"c",INSERT:"a",SELECT:"r",UPDATE:"w",DELETE:"d",TRUNCATE:"D",REFERENCES:"x",TRIGGER:"t",USAGE:"U",EXECUTE:"X"},fromRaw:function(e){var t="";return e instanceof s.Collection&&e.each(function(e){e.get("privilege")&&(t+=e.get("privilege_type"),e.get("with_grant")&&(t+="*"))}),t}}),l.Extension.PrivilegeCell=l.Cell.extend({className:"edit-cell",formatter:a,editor:n,initialize:function(){var e=this;l.Cell.prototype.initialize.apply(this,arguments),e.model.on("change:grantee",function(){e.$el.hasClass("editor")||setTimeout(function(){e.render()},10)})},events:{click:"enterEditMode",keydown:"saveOrCancel"},saveOrCancel:function(e){var t=this.model,i=this.column,n=new l.Command(e);n.moveUp()||n.moveDown()||n.moveLeft()||n.moveRight()||n.save()?(e.preventDefault(),e.stopPropagation(),t.trigger("backgrid:edited",t,i,n)):n.cancel()&&(e.stopPropagation(),t.trigger("backgrid:edited",t,i,n))}}),i}.apply(t,n))||(e.exports=s)},80:function(e,t,i){"use strict";var n,s;i(10),i(16),i(19),i(23),i(193),i(30),i(33),i(18),i(12),i(4),i(29),i(22),i(6),i(31),n=[i(57),i(5),i(2),i(0),i(1),i(3),i(253),i(15),i(14),i(389),i(68),i(152),i(147),i(25),i(124),i(13)],void 0===(s=function(e,t,E,T,S,D,i,n,I,M,y,u,A,$){var O=window.wcDocker,B=13,R=27,j=112;return M.Node?M.Node:(M.Nodes=M.Nodes||{},M.Node=function(){},M.Node.extend=function(e,t){var i,n=this;if(i=function(){return n.apply(this,arguments)},S.extend(i,n,S.omit(e,"callbacks")),i.callbacks=S.extend({},n.callbacks,e.callbacks),!1===t)return i;for(var s,a=S.keys(i.callbacks),l=0;l<a.length;l++)s=a[l],"function"==typeof i.callbacks[s]&&(i.callbacks[s]=i.callbacks[s].bind(i));return i.Init.apply(i),this.Init.apply(i),i},S.extend(D.Browser.Node,n.Events,{type:void 0,label:"",sqlAlterHelp:"",sqlCreateHelp:"",dialogHelp:"",title:function(e,t){return e.label+(t?" - "+t.label:"")},hasId:!0,Init:function(){var i=this;i.node_initialized||(i.node_initialized=!0,D.Browser.add_menus([{name:"refresh",node:i.type,module:i,applies:["object","context"],callback:"refresh",priority:1,label:E("Refresh..."),icon:"fa fa-refresh"}]),i.canEdit&&D.Browser.add_menus([{name:"show_obj_properties",node:i.type,module:i,applies:["object","context"],callback:"show_obj_properties",priority:999,label:E("Properties..."),data:{action:"edit"},icon:"fa fa-pencil-square-o"}]),i.canDrop&&(D.Browser.add_menus([{name:"delete_object",node:i.type,module:i,applies:["object","context"],callback:"delete_obj",priority:i.dropPriority,label:i.dropAsRemove?E("Remove %s",i.label):E("Delete/Drop"),data:{url:"drop"},icon:"fa fa-trash",enable:S.isFunction(i.canDrop)?function(){return!!i.canDrop.apply(i,arguments)}:!!i.canDrop}]),i.canDropCascade&&D.Browser.add_menus([{name:"delete_object_cascade",node:i.type,module:i,applies:["object","context"],callback:"delete_obj",priority:3,label:E("Drop Cascade"),data:{url:"delete"},icon:"fa fa-trash",enable:S.isFunction(i.canDropCascade)?function(){return i.canDropCascade.apply(i,arguments)}:!!i.canDropCascade}])),-1==S.indexOf(D.unsupported_nodes,i.type)&&D.Browser.add_menus([{name:"show_query_tool",node:i.type,module:i,applies:["context"],callback:"show_query_tool",priority:998,label:E("Query Tool..."),icon:"pg-font-icon icon-query-tool",enable:function(e){return!("database"!=e._type||!e.allowConn)||"database"!=e._type}}]),i.hasScriptTypes&&S.isArray(i.hasScriptTypes)&&0<i.hasScriptTypes.length&&S.each(i.hasScriptTypes,function(e){var t=E("%s Script",e.toUpperCase());e=e.toLowerCase(),D.Browser.add_menus([{name:"show_script_"+e,node:i.type,module:i,applies:["object","context"],callback:"show_script",priority:4,label:t,category:"Scripts",data:{script:e},icon:"fa fa-pencil",enable:i.check_user_permission}])}))},check_user_permission:function(e,t,i){if("server_group"==e._type||"server"==e._type)return!1;if("database"==e._type&&!e.allowConn)return!1;var n=M.Nodes[e._type].getTreeNodeHierarchy(t);return-1==S.indexOf(["create","insert","update","delete"],i.script)||(!("role"!=e.type||!n.server.user.can_create_role)||!!(n.server&&(n.server.user.is_superuser||n.server.user.can_create_db)||n.schema&&n.schema.can_create))},getView:function(a,e,t,i,n,s,l,o){var r=this;if(!this.type||""==this.type)return null;if(this.model){var d=this.generate_url(a,e,i,!1);if(!d)return null;var c={};"create"!==e&&(c[this.model.idAttribute||this.model.prototype.idAttribute||"id"]=i._id);var p=this.getTreeNodeHierarchy.apply(this,[a]),u=new(this.model.extend({urlRoot:d}))(c,{node_info:p}),h=y.generateViewSchema(p,u,e,this,i);if("create"==e||"edit"==e){(s=s&&l?s.bind(l):function(){console.warn("Broke something!!! Why we don't have the callback or the context???")})(!1,!1),u.on("pgadmin-session:valid",function(e){S.isUndefined(r.statusBar)||r.statusBar.empty().css("visibility","hidden"),s(!1,e)}),u.on("pgadmin-session:invalid",function(e){var t='\n            <div class="error-in-footer">\n              <div class="d-flex px-2 py-1">\n                <div class="pr-2">\n                  <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>\n                </div>\n                <div class="alert-text">'.concat(e,'</div>\n                <div class="ml-auto close-error-bar">\n                  <a class="close-error fa fa-times text-danger"></a>\n                </div>\n              </div>\n            </div>');S.isUndefined(r.statusBar)||(r.statusBar.html(t).css("visibility","visible"),r.statusBar.find("a.close-error").bind("click",function(){this.empty().css("visibility","hidden")}.bind(r.statusBar)));var i=!1;return this.sessChanged&&this.sessChanged()&&(i=!0),s(!0,i),!0})}if(S.size(h)){var f;f="fieldset"==n?new y.Accordian({el:t,model:u,schema:h}):new y.Dialog({el:t,model:u,schema:h});var m=function(){var e=T(t).find(".tab-content:first > .tab-pane.active:first");$.findAndSetFocus(e)};if(u.isNew())f.render(),m(),u.startNewSession();else{var g='<div class="alert alert-info pg-panel-message pg-panel-properties-message">'+E("Retrieving data from the server...")+"</div>",v=T(g),b=setTimeout(function(e){S.isUndefined(e)||v.appendTo(e)},1e3,l);!function s(){u.fetch({success:function(){clearTimeout(b),v.addClass("d-none"),f.render(),m(),u.startNewSession()},error:function(e,t,i){var n=r&&a?r.getTreeNodeHierarchy(a)[r.type].label:"";M.Events.trigger("pgadmin:node:retrieval:error","properties",t,i.textStatus,i.errorThrown,a),I.pgHandleItemError(t,i.textStatus,i.errorThrown,{item:a,info:p})||I.pgNotifier(i.textStatus,t,E("Error retrieving properties - %s",i.errorThrown||n),function(e){"CRYPTKEY_SET"===e?s():console.warn(arguments)}),o&&o()}})}()}}return f}return null},register_node_panel:function(){var e=M.docker.findPanels("node_props");if(!e||1!=e.length){var t={};t[O.EVENT.RESIZE_ENDED]=function(){var e=this.$container.find(".obj_properties").first(),t=e.data("obj-view");t&&t.model&&t.model&&t.model.trigger("pg-browser-resized",{view:t,panel:this,container:e})},(e=new M.Panel({name:"node_props",showTitle:!0,isCloseable:!0,isPrivate:!0,isLayoutMember:!1,elContainer:!0,content:'<div class="obj_properties container-fluid"><div class="alert alert-info pg-panel-message">'+E("Please wait while we fetch information about the node from the server...")+"</div></div>",onCreate:function(e,t){t.addClass("pg-no-overflow")},events:t})).load(M.docker)}},hasScriptTypes:["create"],canEdit:!0,canDrop:!1,canDropCascade:!1,dropAsRemove:!1,dropPriority:2,callbacks:{show_obj_properties:function(e,t){var i=M.tree,n=e&&e.item||t||i.selected(),s=n&&1==n.length?i.itemData(n):void 0,a=this,l=a.title.apply(this,[s]);if(M.Node.register_node_panel(),s){var r=this,o=S.isArray(this.parent_type)?function(e){return-1!=S.indexOf(r.parent_type,e._type)}:function(e){return r.parent_type==e._type},d=function(){var e,t,i,n,s=window.document,a=s.body,l=s.createElement("div");s.body.insertBefore(l,s.body.firstChild),e=screen.width<800?D.toPx(l,"95%","width",!0):(e=D.toPx(l,r.width||M.stdW.default+"px","width",!0))<=M.stdW.sm?M.stdW.sm:e<=M.stdW.md?M.stdW.md:M.stdW.lg,t=screen.height<600?D.toPx(l,"95%","height",!0):(t=D.toPx(l,r.height||M.stdH.default+"px","height",!0))<=M.stdH.sm?M.stdH.sm:t<=M.stdH.md?M.stdH.md:M.stdH.lg,i=(a.offsetWidth-e)/2,n=(a.offsetHeight-t)/4;var o=M.docker.addPanel("node_props",O.DOCK.FLOAT,void 0,{w:e+"px",h:t+"px",x:i+"px",y:n+"px"});return a.removeChild(l),o};if("create"==e.action){if(r.parent_type&&!o(s))for(;n&&i.hasParent(n);){n=i.parent(n);var c=i.itemData(n);if(o(c)){s=c;break}}if(!s||null!=this.parent_type&&!o(s))return;if(!s)return;l=E("Create - %s",this.label),p=d(),setTimeout(function(){a.showProperties(n,s,p,e.action)},10)}else if(M.Node.panels&&M.Node.panels[s.id]&&M.Node.panels[s.id].$container){var p=M.Node.panels[s.id];if(p.$container.attr("action-mode")){var u=E('Are you sure want to stop editing the properties of %s "%s"?');"edit"==e.action&&(u=E('Are you sure want to reset the current changes and re-open the panel for %s "%s"?')),I.confirm(E("Edit in progress?"),$.sprintf(u,a.label.toLowerCase(),s.label),function(){setTimeout(function(){a.showProperties(n,s,p,e.action)},10)},null).show()}else setTimeout(function(){a.showProperties(n,s,p,e.action)},10)}else M.Node.panels=M.Node.panels||{},p=M.Node.panels[s.id]=d(),setTimeout(function(){a.showProperties(n,s,p,e.action)},10);p.title(l),p.icon("icon-"+this.type),p.focus()}},delete_obj:function(e,t){var i=e||{url:"drop"},n=this,s=M.tree,a=i.item||t||s.selected(),l=a&&1==a.length?s.itemData(a):void 0;if(l){n=M.Nodes[l._type];var o,r,d,c=l.label;if(d=n.dropAsRemove?"Remove":"Drop","delete"==i.url){if(o=E('Are you sure you want to drop %s "%s" and all the objects that depend on it?',n.label.toLowerCase(),l.label),r=E("DROP CASCADE %s?",n.label),!(S.isFunction(n.canDropCascade)?n.canDropCascade.apply(n,[l,a]):n.canDropCascade))return void I.error(E('The %s "%s" cannot be dropped.',n.label,l.label),10)}else if(o=E('Are you sure you want to %s %s "%s"?',d.toLowerCase(),n.label.toLowerCase(),l.label),r=E("%s %s?",d,n.label),!(S.isFunction(n.canDrop)?n.canDrop.apply(n,[l,a]):n.canDrop))return void I.error(E('The %s "%s" cannot be dropped/removed.',n.label,l.label),10);I.confirm(r,o,function(){T.ajax({url:n.generate_url(a,i.url,l,!0),type:"DELETE"}).done(function(e){return 0==e.success?M.report_error(e.errormsg,e.info):M.removeTreeNode(a,!0),!0}).fail(function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}M.report_error(E('Error dropping/removing %s: "%s"',n.label,c),t)})},null).show()}},show_script:function(e,t){var i,n=e.script,s=this,a=M.tree,l=t||a.selected(),o=l&&1==l.length?a.itemData(l):void 0;o&&(s=M.Nodes[o._type],i="insert"==n?"insert_sql":"update"==n?"update_sql":"delete"==n?"delete_sql":"select"==n?"select_sql":"exec"==n?"exec_sql":"sql",D.DataGrid.show_query_tool(s.generate_url(l,i,o,!0),l,n))},show_query_tool:function(e,t){var i=M.tree,n=t||i.selected();(n&&1==n.length?i.itemData(n):void 0)&&D.DataGrid.show_query_tool("",n)},change_server_background:function(e,t){if(e&&t&&t&&t._type&&"server"==t._type){var i=T(e).find("span.aciTreeItem").first()||null,n=t.icon.split(" ")[1]||null,s=t.icon.split(" ")[2]||"";if(n){var a,l=i.parents()[3]||null,o="pga_server_"+t._id+"_bgcolor";a="<style id="+o+" type='text/css'> \n",a+="."+o+" .aciTreeItem {",a+=" border-radius: 3px; margin-bottom: 2px;",a+=" background: "+n+"} \n",s&&(a+="."+o+" .aciTreeText {",a+=" color: "+s+";} \n"),a+="</style>",T("#"+o).remove(),T(a).appendTo("head"),l&&T(l).addClass(o)}}},added:function(e,t,i){var n=(i||M).tree,s=n.parent(e),a=s&&n.itemData(s),l=a&&M.Nodes[a._type];l&&l.is_collection&&("collection_count"in a||(a.collection_count=0),a.collection_count++,n.setLabel(s,{label:S.escape(a._label)+" <span>("+a.collection_count+")</span>"})),M.Events.trigger("pgadmin:browser:tree:expand-from-previous-tree-state",e),M.Node.callbacks.change_server_background(e,t)},selected:function(e,t,i){var n=i||M,s=n.tree,a=t||s.itemData(e);return D.Browser.enable_disable_menus.apply(n,[e]),a&&n&&"properties"in n.panels&&n.panels.properties&&n.panels.properties.panel&&n.panels.properties.panel.isVisible()&&this.showProperties(e,a,n.panels.properties.panel),M.Events.trigger("pgadmin:browser:tree:update-tree-state",e),!0},removed:function(e){var t=this,i=M.tree,n=i.parent(e),s=n&&i.itemData(n),a=s&&M.Nodes[s._type];a&&a.is_collection&&"collection_count"in s&&(s.collection_count--,i.setLabel(n,{label:S.escape(s._label)+" <span>("+s.collection_count+")</span>"})),setTimeout(function(){t.clear_cache.apply(t,e)},0)},unloaded:function(e){var t=M.tree,i=e&&t.itemData(e);this.is_collection&&"collection_count"in i&&(delete i.collection_count,t.setLabel(e,{label:S.escape(i._label)}))},refresh:function(e,t){var i=this,n=M.tree,s=t&&n.itemData(t);T(M.panels.properties.panel).removeData("node-prop"),M.Events.trigger("pgadmin:browser:tree:refresh",t||M.tree.selected(),{success:function(){i.callbacks.selected.apply(i,[t,s,M])}})},opened:function(e){var t=M.tree,i=M.get_preference("browser","auto_expand_sole_children");M.Events.trigger("pgadmin:browser:tree:update-tree-state",e),i&&1==i.value&&1==t.children(e).length&&t.open(t.first(e))},closed:function(e){M.Events.trigger("pgadmin:browser:tree:remove-from-tree-state",e)}},showProperties:function(s,a,n,e){var l=this,o=D.Browser.tree,r=n.$container.find(".obj_properties").first(),d=r.data("obj-view"),c=T('<div tabindex="1"></div>').addClass("pg-prop-content col-12"),p=!0,t=function(e,t){if(!n||"node_props"===n._type)switch(e.which){case R:C(!0);break;case B:if(e.target!==t)return;if(d&&d.model&&d.model.sessChanged()){var i=T(e.target).closest(".obj_properties").find(".pg-prop-btn-group").find("button.btn-primary");b.call(this,d,i)}break;case j:m()}}.bind(n);setTimeout(function(){n.$container.find(".backform-tab").on("keydown",function(e){t(e,this)})},200);var i=function(e){var t=T('<div role="status"></div>').addClass("pg-prop-status-bar").appendTo(r);return t.css("visibility","hidden"),"header"==e?t.appendTo(l.header):t.prependTo(l.footer),l.statusBar=t}.bind(n),u=function(e,t,i){if(e&&S.isArray(e)&&0<e.length){var n=T('<div class="pg-prop-btn-group"></div>'),s=S.template(['<button tabindex="0" type="<%= type %>" ',"class=\"btn <%=extraClasses.join(' ')%>\"",'<% if (disabled) { %> disabled="disabled"<% } %> title="<%-tooltip%>"','<% if (label != "") {} else { %> aria-label="<%-tooltip%>"<% } %> >','<span class="<%= icon %>"></span><% if (label != "") { %>&nbsp;<%-label%><% } %></button>'].join(" "));return"header"==t?n.appendTo(l.header):n.appendTo(l.footer),i&&n.addClass(i),S.each(e,function(e){e.icon||(e.icon="");var t=T(s(e));n.append(t),e.register(t)}),n}return null}.bind(n),h=function(){var e=o.selected(),t=e&&o.itemData(e),i=(e&&t&&M.Nodes[t._type]).getTreeNodeHierarchy(e);if(!S.isEqual(T(this).data("node-prop"),i)){if(T(this).data("node-prop",i),c.hasClass("has-pg-prop-btn-group")||c.addClass("has-pg-prop-btn-group"),d&&(d.remove({data:!0,internal:!0,silent:!0}),d=null,r.data("obj-view",null)),r.empty(),l.header=T("<div></div>").addClass("pg-prop-header").appendTo(r),l.footer=T("<div></div>").addClass("pg-prop-footer").appendTo(r),d=l.getView(s,"properties",c,a,"fieldset",void 0,r)){r.data("obj-view",d);var n=[];n.push({label:E("Edit"),type:"edit",tooltip:E("Edit"),extraClasses:["btn","btn-primary","pull-right","m-1"],icon:"fa fa-sm fa-pencil",disabled:!l.canEdit,register:function(e){e.on("click",function(){k()})}}),n.push({label:"",type:"help",tooltip:E("SQL help for this object type."),extraClasses:["btn-secondary","btn-secondary","m-1"],icon:"fa fa-lg fa-info",disabled:""==l.sqlAlterHelp&&""==l.sqlCreateHelp,register:function(e){e.on("click",function(){f()})}}),u(n,"header","pg-prop-btn-group-above")}r.append(c)}}.bind(n),f=function(){var e=l.getTreeNodeHierarchy(s).server,t=M.utils.pg_help_path;"ppas"==e.server_type&&(t=M.utils.edbas_help_path);var i="";i=""==l.sqlCreateHelp&&""!=l.sqlAlterHelp?A.getHelpUrl(t,l.sqlAlterHelp,e.version):""!=l.sqlCreateHelp&&""==l.sqlAlterHelp?A.getHelpUrl(t,l.sqlCreateHelp,e.version):d.model.isNew()?A.getHelpUrl(t,l.sqlCreateHelp,e.version):A.getHelpUrl(t,l.sqlAlterHelp,e.version),window.open(i,"postgres_help")}.bind(n),m=function(){window.open(l.dialogHelp,"pgadmin_help")}.bind(n),g=function(e,t){var i=this.$container.find(".obj_properties").first(),n=i&&i.data("obj-view"),s=this;return M.get_preferences_for_module("browser").confirm_on_properties_close&&p&&n&&n.model?!n.model.sessChanged()||void I.confirm(E("Warning"),e,function(){return setTimeout(function(){t()}.bind(s),50),!0},function(){return!0}).set("labels",{ok:E("Yes"),cancel:E("No")}).show():(t(),!0)}.bind(n),v=function(e){var t,i=this.$container.find(".obj_properties").first(),n=i&&i.data("obj-view"),s=this;return!n||!n.model||S.isUndefined(n.model.warn_text)||S.isNull(n.model.warn_text)?(e(),!0):(t=E(n.model.warn_text),!n.model.sessChanged()||void I.confirm(E("Warning"),t,function(){return setTimeout(function(){e()}.bind(s),50),!0},function(){return!0}).set("labels",{ok:E("Yes"),cancel:E("No")}).show())}.bind(n),b=function(e,i){var t=e.model,n=t.toJSON(!0),a=setTimeout(function(){T(".obj_properties").addClass("show_progress")},1e3);i&&T(i).prop("disabled",!0),n&&!S.isEmpty(n)&&t.save({},{attrs:n,validate:!1,cache:!1,wait:!0,success:function(){x.call(),T(".obj_properties").removeClass("show_progress"),clearTimeout(a);var e=M.docker.findPanels("properties")[0],t=M.docker.findPanels("sql")[0],i=M.docker.findPanels("statistics")[0],n=M.docker.findPanels("dependencies")[0],s=M.docker.findPanels("dependents")[0];e&&T(e).removeData("node-prop"),t&&T(t).removeData("node-prop"),i&&T(i).removeData("node-prop"),n&&T(n).removeData("node-prop"),s&&T(s).removeData("node-prop")},error:function(e,t){I.pgNotifier("error",t,E("Error saving properties")),T(".obj_properties").removeClass("show_progress"),clearTimeout(a),i&&T(i).prop("disabled",!1)}})}.bind(n),y=function(){var t=this;e&&"properties"==e&&(e="edit"),t.$container.attr("action-mode",e),d&&(d.remove({data:!0,internal:!0,silent:!0}),d=null,r.data("obj-view",null)),r.empty(),l.header=T("<div></div>").addClass("pg-prop-header").appendTo(r),l.footer=T("<div></div>").addClass("pg-prop-footer").appendTo(r);(d=l.getView(s,e,c,a,"dialog",function(e,t){var i=this.find(".pg-prop-btn-group"),n=i.find("button.btn-primary"),s=i.find('button.btn-secondary[type="reset"]');e||!t?(n.prop("disabled",!0),n.attr("disabled","disabled")):(n.prop("disabled",!1),n.removeAttr("disabled")),t?(s.prop("disabled",!1),s.removeAttr("disabled")):(s.prop("disabled",!0),s.attr("disabled","disabled"))},r,w))&&(r.data("obj-view",d),t.icon(S.isFunction(l.node_image)?l.node_image.apply(l,[a,d.model]):l.node_image||"icon-"+l.type),u([{label:"",type:"help",tooltip:E("SQL help for this object type."),extraClasses:["btn-secondary","pull-left","mx-1"],icon:"fa fa-lg fa-info",disabled:""==l.sqlAlterHelp&&""==l.sqlCreateHelp,register:function(e){e.on("click",function(){f()})}},{label:"",type:"help",tooltip:E("Help for this dialog."),extraClasses:["btn-secondary","pull-left","mx-1"],icon:"fa fa-lg fa-question",disabled:""==l.dialogHelp,register:function(e){e.on("click",function(){m()})}},{label:E("Cancel"),type:"cancel",tooltip:E("Cancel changes to this object."),extraClasses:["btn-secondary","mx-1"],icon:"fa fa-close pg-alertify-button",disabled:!1,register:function(e){e.on("click",function(){t.$container.removeAttr("action-mode"),w.call(!0)})}},{label:E("Reset"),type:"reset",tooltip:E("Reset the fields on this dialog."),extraClasses:["btn-secondary","mx-1"],icon:"fa fa-recycle pg-alertify-button",disabled:!0,register:function(e){e.on("click",function(){g.call(t,E("Changes will be lost. Are you sure you want to reset?"),function(){setTimeout(function(){y.call()},0)})})}},{label:E("Save"),type:"save",tooltip:E("Save this object."),extraClasses:["btn-primary","mx-1"],icon:"fa fa-save pg-alertify-button",disabled:!0,register:function(e){e.on("click",function(){v.call(t,function(){setTimeout(function(){b.call(this,d,e)},0)})})}}],"footer","pg-prop-btn-group-below").on("keydown","button",function(e){if(9==e.keyCode&&0==T(this).nextAll("button:not([disabled])").length)return $.findAndSetFocus(d.$el.find(".tab-content div.active")),!1}),setTimeout(function(){M.keyboardNavigation.getDialogTabNavigator(t.pgElContainer)},200));i("footer"),c.addClass("pg-prop-has-btn-group-below"),r.prepend(c)}.bind(n),C=function(e){S.isUndefined(e)||(p=e),this.close()}.bind(n),_=function(e){var t=this.$container.find(".obj_properties").first().data("obj-view");setTimeout(function(){e.clear_cache.apply(e,s)},0);try{M.Events.trigger("pgadmin:browser:tree:add",S.clone(t.model.tnode),S.clone(t.model.node_info))}catch(e){console.warn(e.stack||e)}C(!1)}.bind(n,l),w=C,x=function(e){var t=a,i=S.clone(d.model.tnode),n=S.clone(d.model.node_info);setTimeout(function(){e.clear_cache.apply(e,s)},0),M.Events.trigger("pgadmin:browser:tree:update",t,i,n,{success:function(e,t,i){M.Events.trigger("pgadmin:browser:node:updated",e,t,i),M.Events.trigger("pgadmin:browser:node:"+t._type+":updated",e,t,i)}}),C(!1)}.bind(n,l),k=y.bind(n);if(e?("create"==e&&(w=C,x=_),"properties"!=e?y():h()):(h(),k=function(){setTimeout(function(){l.callbacks.show_obj_properties.apply(l,[{action:"edit",item:s}])},0)}.bind(n)),n.closeable()){n.on(O.EVENT.CLOSING,g.bind(n,E("Changes will be lost. Are you sure you want to close the dialog?"),function(){n.off(O.EVENT.CLOSING),n.close()}));var N=function(){var e=this.$container.find(".obj_properties").first(),t=e&&e.data("obj-view");t&&t.remove({data:!0,internal:!0,silent:!0})}.bind(n);n.on(O.EVENT.CLOSED,N)}},_find_parent_node:function(e,t,i){if(this.parent_type)if(i=i||e.itemData(t),S.isString(this.parent_type)){if(this.parent_type==i._type)return t;for(;e.hasParent(t);)if(t=e.parent(t),i=e.itemData(t),this.parent_type==i._type)return t}else{if(0<=S.indexOf(this.parent_type,i._type))return t;for(;e.hasParent(t);)if(t=e.parent(t),i=e.itemData(t),0<=S.indexOf(this.parent_type,i._type))return t}return null},generate_url:function(e,t,i,n,s){var a={create:"obj",drop:"obj",edit:"obj",properties:"obj",statistics:"stats"},l=this,o=-1/0,r=S.isUndefined(e)||S.isNull(e)?s||{}:this.getTreeNodeHierarchy(e),d=t in a?a[t]:t,c=n&&i._type==l.type?encodeURIComponent(i._id):"";if(l.parent_type)if(S.isString(l.parent_type)){var p=r[l.parent_type];p&&(o=p.priority)}else S.each(l.parent_type,function(e){var t=r[e];t&&o<t.priority&&(o=t.priority)});return u.generate_url(M.URL,r,d,l.type,function(e){return e.priority<=o},c)},Collection:M.DataCollection,Model:M.DataModel,getTreeNodeHierarchy:e.getTreeNodeHierarchyFromIdentifier.bind(M),cache:function(e,t,i,n){var s=this.cached=this.cached||{},a=e,l=t&&t[i]&&t[i].priority||0;if(t&&S.each(S.sortBy(S.values(S.pick(t,function(e){return e.priority<=l})),function(e){return e.priority}),function(e){a=$.sprintf("%s/%s",a,encodeURI(e._id))}),S.isUndefined(n)){var o=s[a];return!S.isUndefined(o)&&3e5<o.at-Date.now()&&(o=void 0),o}return o=s[a]={data:n,at:Date.now(),level:i}},clear_cache:function(e){this.cached={};M.Events.trigger("pgadmin:browser:node:"+this.type+":cache_cleared",e,this)},cache_level:function(e,t){if(e){if(t&&this.type in e)return this.type;if(S.isArray(this.parent_type)){for(var i in this.parent_type)if(i in e)return i;return this.type}return this.parent_type}}}),D.Browser.Node)}.apply(t,n))||(e.exports=s)},9:function(i,n,s){"use strict";(function(x){var e,t;function k(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function N(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}s(21),s(53),s(10),s(58),s(16),s(95),s(50),s(18),s(11),s(75),s(7),s(32),s(76),s(48),s(37),s(4),s(62),s(65),s(63),s(6),e=[s(119),s(2),s(5),s,s(0),s(1),s(146),s(3),s(14),s(84),s(187),s(121),s(147),s(103),s(25),s(41),s(124),s(59),s(382),s(383),s(384),s(190),s(191),s(253),s(387),s(192),s(388),s(254),s(80),s(20),s(242),s(194),s(154)],void 0===(t=function(e,u,r,t,h,f,i,m,g,n,d,a,o,s,c,l){x=window.$=h;var p=window.wcDocker;h=h||x||window.$,i=i||window.Bootstrap;var v=n.default,b=m.Browser=m.Browser||{},y=u("Please select an object in the tree view.");s.setPGCSRFToken(m.csrf_token_header,m.csrf_token);var C={};C[p.EVENT.VISIBILITY_CHANGED]=function(){if(this.isVisible()){var e=m.Browser,t=e.tree?e.tree.selected():void 0,i=t&&1==t.length?e.tree.itemData(t):void 0;if(i&&e.Nodes[i._type].callbacks.selected&&f.isFunction(e.Nodes[i._type].callbacks.selected))return e.Nodes[i._type].callbacks.selected.apply(e.Nodes[i._type],[t,i,e])}};function _(e){var t=JSON.parse(e).data;return t.length&&"column"!==t[0]._type&&"catalog_object_column"!==t[0]._type&&(t=t.sort(function(e,t){return m.natural_sort(e.label,t.label)})),f.each(t,function(e){e._label=e.label,e.label=f.escape(e.label)}),t}var w=m.Browser.initializeBrowserTree=function(o){h("#tree").aciTree({ajax:{url:r("browser.nodes"),converters:{"text json":_}},ajaxHook:function(e,t){if(null!=e){var i=this.itemData(e),n=o.Nodes[i._type];n&&(t.url=n.generate_url(e,"children",i,!0))}},loaderDelay:100,show:{duration:75},hide:{duration:75},view:{duration:75},animateRoot:!0,unanimated:!1}),o.tree=h("#tree").aciTree("api"),o.treeMenu.register(h("#tree")),o.treeMenu.registerDraggableType({"collation domain domain_constraints fts_configuration fts_dictionary fts_parser fts_template synonym table partition type sequence package view mview foreign_table edbvar":function(e,t){return c.fully_qualify(o,e,t)},"schema column database cast event_trigger extension language foreign_data_wrapper foreign_server user_mapping compound_trigger index index_constraint primary_key unique_constraint check_constraint exclusion_constraint foreign_key rule":function(e){return c.quote_ident(e._label)},"trigger trigger_function":function(e){return e._label},"edbfunc function edbproc procedure":function(e,t){var i,n=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?k(i,!0).forEach(function(e){N(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}({},e),s="",a={from:0,to:0};if(i=c.parseFuncParams(n._label),n._label=i.func_name,s=c.fully_qualify(o,n,t),0<i.params.length){s+="(",a.from=s.length,s+=i.params[0][0],a.to=s.length;for(var l=1;l<i.params.length;l++)s=s+", "+i.params[l][0];s+=")"}else s+="()",a.from=a.to=s.length+1;return{text:s,cur:a}}})};return f.extend(m.Browser,{URL:r("browser.index"),docker:null,editor:null,tree:null,treeMenu:new e.Tree,scripts:{},stdW:{sm:500,md:700,lg:900,default:500},stdH:{sm:200,md:400,lg:550,default:550},panels:{browser:new m.Browser.Panel({name:"browser",title:u("Browser"),showTitle:!0,isCloseable:!1,isPrivate:!0,icon:"",content:'<div id="tree" class="aciTree"></div>',onCreate:function(e){a.initializeToolbar(e,p)}}),properties:new m.Browser.Panel({name:"properties",title:u("Properties"),icon:"",width:500,isCloseable:!1,isPrivate:!0,elContainer:!0,content:'<div class="obj_properties container-fluid"><div class="alert alert-info pg-panel-message">'+y+"</div></div>",events:C,onCreate:function(e,t){t.addClass("pg-no-overflow")}}),statistics:new m.Browser.Panel({name:"statistics",title:u("Statistics"),icon:"",width:500,isCloseable:!1,isPrivate:!0,content:'<div class="negative-space p-2"><div class="alert alert-info pg-panel-message pg-panel-statistics-message">'+y+'</div><div class="pg-panel-statistics-container d-none"></div></div>',events:C}),sql:new m.Browser.Panel({name:"sql",title:u("SQL"),icon:"",width:500,isCloseable:!1,isPrivate:!0,content:'<div class="sql_textarea"><textarea id="sql-textarea" name="sql-textarea" title="'+u("SQL Code")+'"></textarea></div>'}),dependencies:new m.Browser.Panel({name:"dependencies",title:u("Dependencies"),icon:"",width:500,isCloseable:!1,isPrivate:!0,content:'<div class="negative-space p-2"><div class="alert alert-info pg-panel-message pg-panel-depends-message">'+y+'</div><div class="pg-panel-dependencies-container d-none"></div></div>',events:C}),dependents:new m.Browser.Panel({name:"dependents",title:u("Dependents"),icon:"",width:500,isCloseable:!1,isPrivate:!0,content:'<div class="negative-space p-2"><div class="alert alert-info pg-panel-message pg-panel-depends-message">'+y+'</div><div class="pg-panel-dependents-container d-none"></div></div>',events:C})},frames:{},menus:{context:{},file:{},edit:{},object:{},management:{},tools:{},help:{}},add_panels:function(){var e=JSON.parse(b.panels_items);f.each(e,function(e){e.isIframe?b.frames[e.name]=new b.Frame({name:e.name,title:e.title,icon:e.icon,width:e.width,height:e.height,showTitle:e.showTitle,isCloseable:e.isCloseable,isPrivate:e.isPrivate,url:e.content}):b.panels[e.name]=new b.Panel({name:e.name,title:e.title,icon:e.icon,width:e.width,height:e.height,showTitle:e.showTitle,isCloseable:e.isCloseable,isPrivate:e.isPrivate,content:e.content?e.content:"",events:e.events?e.events:"",canHide:e.canHide?e.canHide:""})})},menu_categories:{create:{label:u("Create"),priority:1,above:!1,below:!0,single:!0}},register_script:function(e,t,i){var n=this.scripts;n[e]=f.isArray(n[e])?n[e]:[],n[e].push({name:t,path:i,loaded:!1})},masterpass_callback_queue:[],enable_disable_menus:function(n){var t=this,e=h("#navbar-menu > ul").first().find("li#mnu_obj .dropdown-menu").first(),s=t.tree.itemData(n);if(a.enable(u("View Data"),!1),a.enable(u("Filtered Rows"),!1),e.empty(),f.each([{m:"file",id:"#mnu_file"},{m:"management",id:"#mnu_management"},{m:"tools",id:"#mnu_tools"},{m:"help",id:"#mnu_help"}],function(e){f.each(t.menus[e.m],function(e){!function e(t){if(t instanceof m.Browser.MenuItem)t.update(s,n);else for(var i in t)e(t[i])}(e)})}),n&&t.menus.object&&t.menus.object[s._type])m.Browser.MenuCreator(e,t.menus.object[s._type],t.menu_categories,s,n);else{var i=m.Browser.MenuGroup(t.menu_categories.create,[{$el:h('<li><a class="dropdown-item disabled" href="#">'+u("No object selected")+"</a></li>"),priority:1,category:"create",update:function(){}}],!1);e.append(i.$el)}},init:function(){var o=this;if(!o.initialized){if(o.initialized=!0,o.cache_preferences(),o.add_panels(),o.docker=new p("#dockerContainer",{allowContextMenu:!0,allowCollapse:!1,loadingClass:"pg-sp-icon",themePath:r("static",{filename:"css"}),theme:"webcabin.overrides.css"}),o.docker){f.each(o.panels,function(e,t){o.panels[t].load(o.docker)}),f.each(o.frames,function(e,t){o.frames[t].load(o.docker)});var e=b.utils.layout;o.restore_layout(o.docker,e,o.buildDefaultLayout.bind(o)),o.docker.on(p.EVENT.LAYOUT_CHANGED,function(){o.save_current_layout("Browser/Layout",o.docker)})}o.editor=v.fromTextArea(document.getElementById("sql-textarea"),{lineNumbers:!0,mode:"text/x-pgsql",readOnly:!0,extraKeys:m.Browser.editor_shortcut_keys});var t=setInterval(function(){o.get_preferences_for_module("sqleditor")&&(clearInterval(t),o.reflectPreferences("sqleditor"))},500);o.onPreferencesChange("sqleditor",function(){o.reflectPreferences("sqleditor")}),setTimeout(function(){o.editor.setValue("-- "+y),o.editor.refresh()},10),w(o),h("#tree").contextMenu({selector:".aciTreeLine",autoHide:!1,build:function(e){var t=o.tree.itemFrom(e),i=o.tree.itemData(t),n=o.menus.context[i._type],s=h("<div></div>"),a={};return m.Browser.MenuCreator(s,n,o.menu_categories,i,t,a),{autoHide:!1,items:a}},events:{hide:function(){o.keyboardNavigation.bindLeftTree()}}}),h("#tree").on("acitree",function(e,t,i,n,s){var a,l=i?o.tree.itemData(i):null;if(l&&o.Nodes[l._type]){if(a=o.Nodes[l._type],f.isObject(a.callbacks)&&n in a.callbacks&&"function"==typeof a.callbacks[n]&&!a.callbacks[n].apply(a,[i,l,o,s,n]))return!1;try{a.trigger("browser-node."+n,a,i,l)}catch(e){console.warn(e.stack||e)}}try{o.Events.trigger("pgadmin-browser:tree",n,i,l),o.Events.trigger("pgadmin-browser:tree:"+n,i,l,a)}catch(e){console.warn(e.stack||e)}return!0}),b.utils.registerScripts(this),b.utils.addMenus(o);var i={};i[m.csrf_token_header]=m.csrf_token,setInterval(function(){h.ajax({url:r("misc.cleanup"),type:"POST",headers:i}).done(function(){}).fail(function(){})},3e5),o.set_master_password(""),o.Events.on("pgadmin:browser:tree:add",o.onAddTreeNode,o),o.Events.on("pgadmin:browser:tree:update",o.onUpdateTreeNode,o),o.Events.on("pgadmin:browser:tree:refresh",o.onRefreshTreeNode,o),o.Events.on("pgadmin-browser:tree:loadfail",o.onLoadFailNode,o),o.bind_beforeunload()}},init_master_password:function(){var i=this;g.dlgMasterPass||g.dialog("dlgMasterPass",function(){return{main:function(e,t,i){this.set("title",e),this.message=t,this.reset=i},build:function(){g.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",className:"btn btn-secondary pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:u("Master password"),url:r("help.static",{filename:"master_password.html"})}},{text:u("Reset Master Password"),className:"btn btn-secondary fa fa-trash-o pg-alertify-button pull-left"},{text:u("Cancel"),className:"btn btn-secondary fa fa-times pg-alertify-button",key:27},{text:u("OK"),key:13,className:"btn btn-primary fa fa-check pg-alertify-button"}],focus:{element:"#password",select:!0},options:{modal:!0,resizable:!1,maximizable:!1,pinnable:!1}}},prepare:function(){var e=this;e.setContent(e.message),e.reset?h(e.__internal.buttons[1].element).removeClass("d-none"):h(e.__internal.buttons[1].element).addClass("d-none")},callback:function(e){var t=this;if(3==e.index)i.set_master_password(h("#frmMasterPassword #password").val(),!0,t.set_callback);else if(2==e.index)i.masterpass_callback_queue=[];else if(1==e.index)e.cancel=!0,g.confirm(u("Reset Master Password"),u("This will remove all the saved passwords. This will also remove established connections to the server and you may need to reconnect again. Do you wish to continue ?"),function(){return i.reset_master_password(),t.close(),!0},function(){return!0}).set("labels",{ok:u("Yes"),cancel:u("No")});else if(0==e.index)return e.cancel=!0,void i.showHelp(e.button.element.name,e.button.element.getAttribute("url"),null,null)}}})},check_master_password:function(t){h.ajax({url:r("browser.check_master_password"),type:"GET",contentType:"application/json"}).done(function(e){t&&(e.data?t(!0):t(!1))}).fail(function(e,t,i){g.pgRespErrorNotify(e,i)})},reset_master_password:function(){var t=this;h.ajax({url:r("browser.set_master_password"),type:"DELETE",contentType:"application/json"}).done(function(e){e.data||t.set_master_password("")}).fail(function(e,t,i){g.pgRespErrorNotify(e,i)})},set_master_password:function(e,t,i){var n=0<arguments.length&&void 0!==e?e:"",s=1<arguments.length&&void 0!==t&&t,a=2<arguments.length&&void 0!==i?i:function(){},l=null,o=this;null==n&&""==n||(l=JSON.stringify({password:n,button_click:s})),o.masterpass_callback_queue.push(a),h.ajax({url:r("browser.set_master_password"),type:"POST",data:l,dataType:"json",contentType:"application/json"}).done(function(e){e.data.present?setTimeout(function(){for(;0<o.masterpass_callback_queue.length;){o.masterpass_callback_queue.shift()()}},500):(o.init_master_password(),g.dlgMasterPass(e.data.title,e.data.content,e.data.reset))}).fail(function(e,t,i){g.pgRespErrorNotify(e,i)})},bind_beforeunload:function(){h(window).on("beforeunload",function(e){var t=l.default.pgAdmin.Browser,i=b.get_preference("browser","browser_tree_state_save_interval"),n=t.get_preference("browser","confirm_on_refresh_close");if(f.isUndefined(i)||-1===i.value||m.Browser.browserTreeState.save_state(),!f.isUndefined(n)&&n.value){var s=u("Are you sure you want to close the %s browser?",b.utils.app_name);return e.originalEvent.returnValue=s}})},add_menu_category:function(e,t,i,n,s,a,l){this.menu_categories[e]={label:t,priority:i,icon:n,above:!0===s,below:!0===a,single:l}},add_menus:function(e){var l=this,o=this.menus,r=m.Browser.MenuItem;f.each(e,function(a){f.each(a.applies,function(e){if(0<=h.inArray(e,["context","file","edit","object","management","tools","help"])){var t;if(!d(l,a.node))return;if(f.has(a,"module")&&!f.isUndefined(a.module)&&!d(l,a.module.type))return;o[e]=o[e]||{},t=f.isString(a.node)?o[e][a.node]=o[e][a.node]||{}:f.isString(a.category)?o[e][a.category]=o[e][a.category]||{}:o[e];var i=function(e){return new r({name:e.name,label:e.label,module:e.module,category:e.category,callback:e.callback,priority:e.priority,data:e.data,url:e.url||"#",target:e.target,icon:e.icon,enable:""==e.enable||(!f.isString(e.enable)||"false"!=e.enable.toLowerCase())&&e.enable,node:e.node,checked:e.checked})};if(!f.has(t,a.name)&&(t[a.name]=i(a),a.menu_items)){for(var n=[],s=0;s<a.menu_items.length;s++)n.push(i(a.menu_items[s]));t[a.name].menu_items=n}}else console.warn("Developer warning: Category '"+e+"' is not supported!\nSupported categories are: context, file, edit, object, tools, management, help")})})},create_menus:function(){var n=h("#navbar-menu > ul").first(),s=this;f.each([{menu:"file",id:"#mnu_file"},{menu:"management",id:"#mnu_management"},{menu:"tools",id:"#mnu_tools"},{menu:"help",id:"#mnu_help"}],function(e){var t=n.children(e.id).first(),i=t.children(".dropdown-menu").first();i.empty(),m.Browser.MenuCreator(i,s.menus[e.menu],s.menu_categories)&&t.removeClass("d-none")}),n.children("#mnu_obj").removeClass("d-none"),s.enable_disable_menus()},showHelp:function(e,t,i,n){if("object_help"==e){var s=i.getTreeNodeHierarchy(n).server,a=b.utils.pg_help_path;"ppas"==s.server_type&&(a=b.utils.edbas_help_path);var l=o.getHelpUrl(a,t,s.version);window.open(l,"postgres_help")}else"dialog_help"==e&&window.open(t,"pgadmin_help")},_findTreeChildNode:function(l,o,r){function e(){for(var e,t,i,n=r.t.children(l),s=0,a=n.length;s<a;s++)if(e=n.eq(s),(t=r.t.itemData(e))._type===o._type){if(!r.hasId||t._id==o._id)return r.i=e,r.d=o,r.pathOfTreeItems.push({coll:!1,item:e,d:o}),void r.success()}else if((i=r.b.Nodes[t._type])&&i.collection_node&&t.nodes&&-1!=f.indexOf(t.nodes,o._type))return r.i=e,r.d=null,r.pathOfTreeItems.push({coll:!0,item:e,d:t}),r.t.isInode(e)||(r.load=!1),void r.b._findTreeChildNode(e,o,r);r.notFound&&"function"==typeof r.notFound&&r.notFound(o)}var t=r.t.wasLoad(l);!t&&r.load?r.t.open(l,{success:e,unanimated:!0,fail:function(){var e=r&&r.o&&r.o.fail;e&&"function"==typeof e&&e.apply(r.t,[])}}):t?e():r.notFound&&"function"==typeof r.notFound&&r.notFound(o)},onAddTreeNode:function(r,e,t){var i={b:this,d:null,hasId:!0,i:null,p:f.toArray(e||{}).sort(function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}),pathOfTreeItems:[],t:this.tree,o:t},n=function(){var e,t=this;return t.success=n,t.p.length&&(e=t.p.shift(),t.p.length||(e._id=r._pid,t.success=s),t.b._findTreeChildNode(t.i,e,t),r._pid||s.apply(t,arguments)),!0}.bind(i),s=function(){var e=this,t=(e.i||this.t.wasLoad(e.i))&&this.t.first(e.i),i=function(e,t){var i=this;i.success=e,i.notFound=t,i.b._findTreeChildNode(i.i,r,i)}.bind(e),n=function(){this.t.openPath(this.i),this.t.select(this.i),e.o&&e.o.success&&"function"==typeof e.o.success&&e.o.success.apply(e.t,[e.i,r])}.bind(e),s=function(){var n,s=this,a=s.t.children(s.i),l=0,o=a.length-1;if(function(){for(var e,t,i;22<o-l;){if(n=a.eq(l),e=s.t.itemData(n),-1!=m.natural_sort(e._label,r._label))return!0;if(n=a.eq(o),e=s.t.itemData(n),1!=m.natural_sort(e._label,r._label))return!0;if(t=l+Math.round((o-l)/2),n=a.eq(t),e=s.t.itemData(n),0==(i=m.natural_sort(e._label,r._label)))return!0;-1==i?(l=t+1,o--):(l++,o=t-1)}return function(){for(;l<=o;){n=a.eq(l);var e=s.t.itemData(n);if(1==m.natural_sort(e._label,r._label))return!0;l++}return o!=a.length-1?(n=a.eq(o),!0):(n=null,!1)}()}())s.t.before(n,{itemData:r,success:function(){s.o&&s.o.success&&"function"==typeof s.o.success&&s.o.success.apply(s.t,[n,r])},fail:function(){console.warn("Failed to add before...",arguments),s.o&&s.o.fail&&"function"==typeof s.o.fail&&s.o.fail.apply(s.t,[n,r])}});else{var e=function(){var n=this,s=n.t.wasLoad(n.i),a=n.t.itemData(n.i);n.t.append(n.i,{itemData:r,success:function(e,t){var i=h(t.items[0]);s&&a&&-1<a._type.search(r._type)?(n.t.openPath(i),n.t.select(i)):a&&n.t.unload(n.i,{success:function(e){n.t.open(e)}}),n.o&&n.o.success&&"function"==typeof n.o.success&&n.o.success.apply(n.t,[i,r])},fail:function(){console.warn("Failed to append...",arguments),n.o&&n.o.fail&&"function"==typeof n.o.fail&&n.o.fail.apply(n.t,[n.i,r])}})}.bind(s);s.i&&!s.t.isInode(s.i)?s.t.setInode(s.i,{success:e}):e()}}.bind(e);t||!e.t.wasLoad(e.i)?i(n,s):e.t.unload(e.i,{success:function(){i(n,function(){var e=this&&this.o;e&&e.fail&&"function"==typeof e.fail&&e.fail.apply(this.t,[this.i,r])}.bind(this))}.bind(this),fail:function(){var e=this&&this.o;e&&e.fail&&"function"==typeof e.fail&&e.fail.apply(this.t,[this.i,r])}.bind(this)})}.bind(i);i.t.wasInit()&&r&&(r._label=r.label,r.label=f.escape(r.label),n())},onUpdateTreeNode:function(r,d,e,t){var n={b:this,d:null,i:null,hasId:!0,p:f.toArray(e||{}).sort(function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}),pathOfTreeItems:[],t:this.tree,o:t,load:!0,old:r,new:d,op:null},c=function(){var e=this.o&&this.o.fail;e&&"function"==typeof e&&e.apply(this.t,[this.i,d,r])}.bind(n),i=function(){var s=this,t=this.pathOfTreeItems,a=function(){if(t.length){t.pop();var e=t.length;this.i=e&&t[e-1].item||null,this.d=e&&t[e-1].d||null,e&&t[e-1].coll&&(t.pop(),e=t.length,this.i=e&&t[e-1].item||null,this.d=e&&t[e-1].d||null)}else this.i=null,this.d=null}.bind(this),l=this.i&&this.t.hasParent(this.i)&&this.t.parent(this.i)||null,o=l?this.t.hasParent(l)&&this.t.parent(l):null;if(this.i&&this.d&&this.old._id==this.d._id&&this.old._type==this.d._type){var e=this.t.parent(this.i)||null;if(0==e.length&&"UPDATE"==n.op)p();else{var i=function(){if(!l||o){var e=this.d;return a(),void(this.i?(this.load=!0,this.success=function(){u()}.bind(this),this.notFound=c,this.b._findTreeChildNode(this.i,{_id:this.new._pid,_type:e._type},this)):u())}var i=null,t=this.t.siblings(this.i)||[];if(t.push(this.i[0]),f.each(t,function(e){var t=s.t.itemData(h(e));t._id==s.new._pid&&(i=e,s.pathOfTreeItems.push({coll:!0,item:i,d:t}))}),i){this.load=!0,this.success=function(){u()}.bind(this),this.notFound=c,i=h(i);var n=function(){s.i=i,s.pathOfTreeItems.push({coll:!1,item:i,d:s.d}),s.success()};!this.t.wasLoad(i)&&s.load?s.t.open(i,{success:n,unanimated:!0,fail:function(){var e=s&&s.o&&s.o.fail;e&&"function"==typeof e&&e.apply(s.t,[])}}):n()}}.bind(this);this.t.remove(this.i,{success:function(){return a(),l&&!o&&e&&0==s.t.children(e).length?s.t.setInode(e,{success:function(){s.t.unload(e,{success:function(){setTimeout(i)}})}}):setTimeout(i),!0}})}}c()}.bind(n),s=function(e){var t=function(){var e=this.pathOfTreeItems;if(e.length){e.pop();var t=e.length;this.i=t&&e[t-1].item||null,this.d=t&&e[t-1].d||null,t&&e[t-1].coll&&(e.pop(),t=e.length,this.i=t&&e[t-1].item||null,this.d=t&&e[t-1].d||null)}else this.i=null,this.d=null}.bind(this);this.i?(this.load=!0,this.success=function(){u()}.bind(this),e._type==this.old._type&&(t(),e=this.d,t()),e=this.new._pid,this.notFound=c,this.b._findTreeChildNode(this.i,e,this)):u()}.bind(n),p=function(){if(this.i&&this.d&&this.new._type==this.d._type){var e=this,t=this.d._id;if(this.new._id!=this.d._id)this.t.itemData(n.i)._id=t=this.new._id;this.new._id==t&&(f.extend(this.d,{_id:this.new._id,_label:this.new._label,label:this.new.label}),this.t.setLabel(n.i,{label:this.new.label}),this.t.addIcon(n.i,{icon:this.new.icon}),this.t.setId(n.i,{id:this.new.id}),this.t.openPath(this.i),this.t.deselect(this.i),setTimeout(function(){e.t.select(e.i)},10))}var i=this.o&&this.o.success;i&&"function"==typeof i&&i.apply(this.t,[this.i,r,d])}.bind(n),a=function(){var e,t=this;return t.success=a,t.p.length?(e=t.p.shift(),t.p.length||("RECREATE"==t.op?(t.load=!1,t.success=i,t.notFound=s):(t.success=p,t.notFound=c)),t.b._findTreeChildNode(t.i,e,t)):1==t.p.length&&(t.notFound=s),!0}.bind(n),u=function(){var e=this,t=(e.i||this.t.wasLoad(e.i))&&this.t.first(e.i),i=function(e,t){var i=this;i.success=e,i.notFound=t,i.b._findTreeChildNode(i.i,d,i)}.bind(e),n=function(){this.t.openPath(this.i),this.t.select(this.i),e.o&&e.o.success&&"function"==typeof e.o.success&&e.o.success.apply(e.t,[e.i,d])}.bind(e),s=function(){var n,s=this,a=s.t.children(s.i),l=0,o=a.length-1;if(function(){for(;22<o-l;){n=a.eq(l);var e=s.t.itemData(n);if(-1!=m.natural_sort(e._label,d._label))return!0;if(n=a.eq(o),e=s.t.itemData(n),1!=m.natural_sort(e._label,d._label))return!0;var t=l+Math.round((o-l)/2);n=a.eq(t),e=s.t.itemData(n);var i=m.natural_sort(e._label,d._label);if(0==i)return!0;-1==i?(l=t+1,o--):(l++,o=t-1)}return function(){for(;l<=o;){n=a.eq(l);var e=s.t.itemData(n);if(1==m.natural_sort(e._label,d._label))return!0;l++}return o!=a.length-1?(n=a.eq(o),!0):(n=null,!1)}()}())s.t.before(n,{itemData:d,success:function(e,t){var i=h(t.items[0]);s.t.openPath(i),s.t.select(i),s.o&&s.o.success&&"function"==typeof s.o.success&&s.o.success.apply(s.t,[n,r,d])},fail:function(){console.warn("Failed to add before..",arguments),s.o&&s.o.fail&&"function"==typeof s.o.fail&&s.o.fail.apply(s.t,[n,r,d])}});else{var e=function(){s.t.append(s.i,{itemData:d,success:function(e,t){var i=h(t.items[0]);s.t.openPath(i),s.t.select(i),s.o&&s.o.success&&"function"==typeof s.o.success&&s.o.success.apply(s.t,[s.i,r,d])},fail:function(){console.warn("Failed to append...",arguments),s.o&&s.o.fail&&"function"==typeof s.o.fail&&s.o.fail.apply(s.t,[s.i,r,d])}})};s.i&&!s.t.isInode(s.i)?s.t.setInode(s.i,{success:e}):e()}}.bind(e);t||!e.t.wasLoad(e.i)?i(n,s):e.t.unload(e.i,{success:function(){i(n,function(){var e=this&&this.o;e&&e.fail&&"function"==typeof e.fail&&e.fail.apply(this.t,[this.i,r,d])}.bind(this))}.bind(this),fail:function(){var e=this&&this.o;e&&e.fail&&"function"==typeof e.fail&&e.fail.apply(this.t,[this.i,r,d])}.bind(this)})}.bind(n);n.t.wasInit()&&d&&r&&(n.pathOfTreeItems.push(r),d._label=d.label,d.label=f.escape(d.label),n.b.Nodes[d._type].is_collection&&"collection_count"in r&&0<r.collection_count&&(d.label=f.escape(d._label)+" <span>("+r.collection_count+")</span>"),"server"!=r._type||"server"!=d._type||r._pid==d._pid&&r._label==d._label&&r.icon==d.icon?r._pid!=d._pid||r._label!=d._label?n.op="RECREATE":n.op="UPDATE":n.op="RECREATE",a())},onRefreshTreeNode:function(e,t){var i,n=e&&this.tree.itemData(e),s=n&&n._type&&this.Nodes[n._type],c={b:this,d:n,i:e,p:null,pathOfTreeItems:[],t:this.tree,o:t},a=-1;if(this.Events.trigger("pgadmin-browser:tree:refreshing",e,n,s),s?i=this.tree.isInode(e)&&this.tree.isOpen(e):(e=null,c.i=null,c.d=null),c.branch=c.t.serialize(e,{},function(e,t,i){if(!++a||i.inode&&i.open)return{_id:i._id,_type:i._type,branch:i.branch,open:i.open}}),s){var p=function(l,o,r){var d=r.getTreeNodeHierarchy(l),e=r.generate_url(l,"nodes",o,!0);h.ajax({url:e,type:"GET",cache:!1,dataType:"json"}).done(function(e){var t=e.result||e.data;t._label=t.label,t.label=f.escape(t.label),c.t.setLabel(c.i,{label:t.label}),c.t.addIcon(c.i,{icon:t.icon}),c.t.setId(c.i,{id:t.id}),t.inode&&c.t.setInode(c.i,{inode:!0});var i=c.t.itemData(c.i);if(f.extend(i,t),!r.can_expand||"function"!=typeof r.can_expand||r.can_expand(i)){c.b._refreshNode(c,c.branch);var n=c.o&&c.o.success||c.success;n&&"function"==typeof n&&n()}else c.t.unload(c.i)}).fail(function(e,t,i){if(!g.pgHandleItemError(e,t,i,{item:l,info:d})){var n=e.getResponseHeader("Content-Type"),s=n&&0==n.indexOf("application/json")&&JSON.parse(e.responseText)||{};if(410==e.status&&0==s.success){var a=c.t.parent(c.i);c.t.remove(c.i,{success:function(){if(a)try{b.Events.trigger("pgadmin:browser:tree:refresh",a)}catch(e){console.warn(e.stack||e)}}})}g.pgNotifier(t,e,u("Error retrieving details for the node."),function(e){"CRYPTKEY_SET"==e?p(l,o,r):console.warn(arguments)})}})}.bind(this);if(s&&s.collection_node){var l=c.i=this.tree.parent(e),o=function(){this.tree.unload(e,{success:function(){e=l,n=c.d=c.t.itemData(c.i),s=c.b.Nodes[n._type],p(e=l,n,s)},fail:function(){console.warn(arguments)}})}.bind(this);this.tree.isInode(e)?o():this.tree.setInode(e,{success:o})}else i?this.tree.unload(e,{success:p.bind(this,e,n,s),fail:function(){console.warn(arguments)}}):!this.tree.isInode(e)&&n.inode?this.tree.setInode(e,{success:p.bind(this,e,n,s),fail:function(){console.warn(arguments)}}):p(e,n,s)}else c.t.destroy({success:function(){w(c.b),c.t=c.b.tree,c.i=null,c.b._refreshNode(c,c.branch)},error:function(){var e=t.o&&t.o.fail||t.fail;"function"==typeof e&&e()}})},onLoadFailNode:function(t){var i=this,n=i.tree.isSelected(t);i.check_master_password(function(e){e||i.set_master_password("",function(){n&&i.tree.select(t),i.tree.open(t)})})},removeChildTreeNodesById:function(e,t,i){var n=b.tree;if(e&&t){var s,a,l=n.children(e),o=0,r=l.length;for(e=null;o<r;o++)if(s=l.eq(o),(a=n.itemData(s))._type==t){e=s;break}}if(e){for(o=0,r=(l=n.children(e)).length;o<r;o++)s=l.eq(o),a=n.itemData(s),-1!=i.indexOf(a._id)&&b.removeTreeNode(s,!1,e);return!0}return!1},removeTreeNode:function(e,t,i){var n=b.tree,s=null;return!!e&&(t&&((s=n.next(e))&&s.length||(s=n.prev(e))&&s.length||(s=i||n.parent(e)),s&&n.select(s)),n.remove(e),!0)},findSiblingTreeNode:function(e,t){for(var i,n,s=b.tree,a=s.parent(e),l=s.children(a),o=0;o<l.length;o++)if(n=l.eq(o),(i=s.itemData(n))&&i._id==t)return n;return null},findParentTreeNodeByType:function(e,t){var i,n=b.tree,s=e;do{if((i=n.itemData(s))&&i._type==t)return s;s=n.hasParent(s)?n.parent(s):null}while(s);return null},findChildCollectionTreeNode:function(e,t){var i,n=b.tree,s=0,a=e,l=e&&n.children(e);if(!l||!l.length)return null;for(;s<l.length;s++)if(a=l.eq(s),(i=n.itemData(a))&&i._type==t)return a;return null},addChildTreeNodes:function(t,e,i,a,n){var l=i in b.Nodes&&b.Nodes[i],o=a.length&&f.extend({},f.mapObject(t,function(e){return e.priority-=1,e})),r=[];l?b.tree.wasLoad(e)||b.tree.isLeaf(e)?function n(s){if(a.length){var e,t={_id:a.pop(),_type:i,priority:0};o[i]=t,e=l.generate_url(null,"nodes",t,!0,o),h.ajax({url:e,dataType:"json"}).done(function(e){e.success&&r.push(e.data),n(s)}).fail(function(e,t,i){g.pgRespErrorNotify(e,i),n(s)})}else s&&s()}(function(){f.each(r,function(e){b.Events.trigger("pgadmin:browser:tree:add",e,t)}),n&&n()}):n&&n():console.warn("Developer: Couldn't find the module for the given child: ",f.clone(arguments))},_refreshNode:function(e,t){var i=function(e){for(var t,i,n=this,s=0,a=e.branch&&e.branch.length||0,l=function(e,t,i){setTimeout(function(){i.b._findTreeChildNode(e,t,i)},0)};s<a;s++){i=e.branch[s];var o=n.b.Nodes[i._type];(t={b:n.b,t:n.t,pathOfTreeItems:[],i:n.i,d:i,select:n.select,hasId:o&&!o.collection_node,o:n.o,load:!0}).success=function(){this.b._refreshNode.call(this.b,this,this.d)}.bind(t),l(n.i,i,t)}}.bind(e,t);t&&t.open&&(e.t.isOpen(e.i)?i():e.t.open(e.i,{unanimated:!0,success:i,fail:function(){}}))},editor_shortcut_keys:{"Ctrl-Space":"autocomplete","Cmd-Space":"autocomplete","Ctrl-A":"selectAll","Cmd-A":"selectAll","Ctrl-Y":"redo","Cmd-Y":"redo","Ctrl-Z":"undo","Cmd-Z":"undo","Ctrl-D":"deleteLine","Cmd-D":"deleteLine","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Alt-Left":"goGroupLeft","Cmd-Alt-Left":"goGroupLeft","Ctrl-Alt-Right":"goGroupRight","Cmd-Alt-Right":"goGroupRight","Shift-Tab":"indentLess"},editor_options:{tabSize:parseInt(b.utils.tabSize),wrapCode:b.utils.wrapCode,insert_pair_brackets:b.utils.insertPairBrackets,brace_matching:b.utils.braceMatching,indent_with_tabs:b.utils.is_indent_with_tabs},get_browser:function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===i[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:e[0],version:e[1]}:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),{name:i[0],version:i[1]})}}),delete v.keyMap.emacsy["Ctrl-V"],"True"==b.utils.useSpaces&&(m.Browser.editor_shortcut_keys.Tab="insertSoftTab"),m.Browser}.apply(n,e))||(i.exports=t)}).call(this,s(0))}}]);